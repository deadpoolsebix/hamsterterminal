<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Hamster Terminal v6.0 - Enterprise Trading Engine | 16 Modules</title>
  <meta name="description" content="Professional crypto trading terminal with 16 AI/ML modules. LSTM, Transformer, Black-Litterman portfolio optimization, VaR risk engine, real order execution.">
  <meta name="keywords" content="crypto trading, bitcoin, trading bot, AI trading, portfolio optimization, risk management">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --orange: #ff8c00;
      --burgundy: #800020;
      --black: #000000;
      --panel: #0a0a0a;
      --border: #1a1a1a;
      --green: #00ff41;
      --red: #ff0033;
      --yellow: #ffff00;
      --cyan: #00d4ff;
      --gray: #bdbdbd;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Roboto Mono', monospace;
      background: var(--black);
      color: #ffffff;
      line-height: 1.4;
      padding-bottom: 40px;
    }

    /* BLOOMBERG HEADER */
    .header {
      background: var(--orange);
      color: #000000;
      padding: 14px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 700;
      letter-spacing: 1px;
      font-size: 1.1em;
    }
    .header-time { font-size: 1em; font-weight: 600; }

    /* NAV WRAPPER + HAMBURGER */
    .nav-wrapper { border-bottom: 1px solid var(--border); }
    .hamburger-btn {
      display: none;
      align-items: center;
      gap: 10px;
      padding: 10px 24px;
      width: 100%;
      background: #0d0d0d;
      border: 1px solid var(--border);
      border-left: 2px solid #1a1a1a;
      color: #ffffff;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .hamburger-btn span {
      display: block;
      width: 20px;
      height: 2px;
      background: #ffffff;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }
    .hamburger-icon { display: grid; gap: 4px; }
    .hamburger-label { font-size: 0.9em; color: var(--gray); }
    .hamburger-btn.open .line1 { transform: translateY(6px) rotate(45deg); }
    .hamburger-btn.open .line2 { opacity: 0; }
    .hamburger-btn.open .line3 { transform: translateY(-6px) rotate(-45deg); }

    /* ANALYTICS HAMBURGER */
    .analytics-btn {
      display: none;
      align-items: center;
      gap: 10px;
      padding: 10px 24px;
      width: 100%;
      background: #0d0d0d;
      border: 1px solid var(--border);
      border-left: 2px solid #1a1a1a;
      color: #ffffff;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 0.5px;
      margin-top: 8px;
      position: relative;
    }
    .analytics-icon { display: grid; gap: 4px; }
    .analytics-icon span { width: 20px; height: 2px; background: #ffffff; transition: transform 0.2s ease, opacity 0.2s ease; }
    .analytics-btn.open .line1 { transform: translateY(6px) rotate(45deg); }
    .analytics-btn.open .line2 { opacity: 0; }
    .analytics-btn.open .line3 { transform: translateY(-6px) rotate(-45deg); }

    /* GENIUS AI HAMBURGER - Mobile App Style */
    .genius-hamburger-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      background: rgba(255, 140, 0, 0.15);
      border: 2px solid var(--orange);
      border-radius: 8px;
      color: var(--orange);
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
      position: relative;
      z-index: 10001;
      min-width: 100px;
      min-height: 50px;
      justify-content: center;
    }
    .genius-hamburger-btn:hover {
      background: rgba(255, 140, 0, 0.25);
    }
    .genius-hamburger-btn:active {
      transform: scale(0.95);
    }
    .genius-hamburger-icon { display: grid; gap: 5px; width: 24px; }
    .genius-hamburger-icon span {
      width: 24px;
      height: 3px;
      background: var(--orange);
      transition: transform 0.3s ease, opacity 0.3s ease, width 0.3s ease;
      border-radius: 2px;
    }
    .genius-hamburger-btn.open .line1 { transform: translateY(8px) rotate(45deg); }
    .genius-hamburger-btn.open .line2 { opacity: 0; width: 0; }
    .genius-hamburger-btn.open .line3 { transform: translateY(-8px) rotate(-45deg); }
    
    /* Mobile: Make Genius hamburger bigger and centered */
    @media (max-width: 768px) {
      .genius-hamburger-btn {
        padding: 14px 24px;
        min-width: 130px;
        min-height: 55px;
        font-size: 0.95em;
        margin: 8px auto !important;
      }
      .genius-hamburger-icon span {
        width: 28px;
        height: 4px;
      }
    }

    /* MOBILE APP STYLE FULLSCREEN MENU */
    .genius-menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      opacity: 0;
      visibility: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 9998;
    }
    .genius-menu-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .genius-menu-panel {
      position: fixed;
      top: 0;
      left: -100%;
      width: 100%;
      max-width: 380px;
      height: 100vh;
      background: linear-gradient(180deg, #0a0a0a 0%, #111111 100%);
      border-right: 2px solid var(--orange);
      box-shadow: 5px 0 40px rgba(255, 140, 0, 0.2);
      z-index: 9999;
      transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
      overflow-x: hidden;
    }
    .genius-menu-panel.show {
      left: 0;
    }

    .genius-menu-header {
      background: linear-gradient(135deg, var(--orange), #cc6600);
      padding: 40px 24px 24px 24px;
      position: relative;
    }
    .genius-menu-header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--orange), transparent);
    }
    .genius-menu-logo {
      font-size: 1.8em;
      font-weight: 900;
      color: #000000;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    .genius-menu-subtitle {
      color: rgba(0, 0, 0, 0.7);
      font-size: 0.85em;
      font-weight: 600;
      letter-spacing: 1px;
    }
    .genius-menu-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 40px;
      height: 40px;
      background: rgba(0, 0, 0, 0.3);
      border: none;
      border-radius: 50%;
      color: #000000;
      font-size: 1.5em;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    .genius-menu-close:hover {
      background: rgba(0, 0, 0, 0.5);
      transform: rotate(90deg);
    }

    .genius-menu-grid {
      display: flex;
      flex-direction: column;
      padding: 20px 16px;
      gap: 8px;
    }
    .genius-menu-item {
      display: flex;
      align-items: center;
      gap: 16px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-left: 3px solid transparent;
      padding: 18px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: left;
    }
    .genius-menu-item:hover {
      background: rgba(255, 140, 0, 0.1);
      border-left-color: var(--orange);
      transform: translateX(8px);
    }
    .genius-menu-item:active {
      transform: translateX(8px) scale(0.98);
    }
    .genius-menu-item-icon {
      font-size: 1.8em;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 140, 0, 0.1);
      border-radius: 12px;
      flex-shrink: 0;
    }
    .genius-menu-item-content {
      flex: 1;
    }
    .genius-menu-item-label {
      color: #ffffff;
      font-weight: 700;
      font-size: 1em;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }
    .genius-menu-item-desc {
      color: var(--gray);
      font-size: 0.8em;
      line-height: 1.4;
    }
    .genius-menu-item-arrow {
      color: var(--gray);
      font-size: 1.2em;
      opacity: 0;
      transform: translateX(-10px);
      transition: all 0.3s ease;
    }
    .genius-menu-item:hover .genius-menu-item-arrow {
      opacity: 1;
      transform: translateX(0);
      color: var(--orange);
    }

    .genius-menu-divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255, 140, 0, 0.3), transparent);
      margin: 12px 20px;
    }

    .genius-menu-footer {
      padding: 20px 24px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      margin-top: auto;
    }
    .genius-menu-footer-text {
      color: var(--gray);
      font-size: 0.75em;
      text-align: center;
      letter-spacing: 1px;
    }

    /* Mobile responsiveness */
    @media (max-width: 480px) {
      .genius-menu-panel {
        max-width: 100%;
      }
      .genius-menu-item {
        padding: 16px;
      }
      .genius-menu-item-icon {
        width: 44px;
        height: 44px;
        font-size: 1.5em;
      }
    }

    /* SLIDE-OUT PANELS */
    .genius-panel {
      position: fixed;
      top: 0;
      right: -440px;
      width: 420px;
      height: 100vh;
      background: rgba(10, 10, 10, 0.98);
      backdrop-filter: blur(10px);
      border-left: 2px solid var(--orange);
      box-shadow: -5px 0 20px rgba(0, 0, 0, 0.5);
      z-index: 9999;
      transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
    }
    .genius-panel.show {
      right: 0;
    }
    .genius-panel-header {
      background: linear-gradient(135deg, rgba(255, 140, 0, 0.2), rgba(255, 140, 0, 0.05));
      padding: 20px 24px;
      border-bottom: 1px solid var(--orange);
      position: sticky;
      top: 0;
      z-index: 1;
      backdrop-filter: blur(10px);
    }
    .genius-panel-title {
      color: #ffffff;
      font-size: 1.3em;
      font-weight: 700;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .genius-panel-close {
      position: absolute;
      top: 20px;
      right: 24px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #ffffff;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      transition: all 0.2s;
    }
    .genius-panel-close:hover {
      background: var(--red);
      border-color: var(--red);
    }
    .genius-panel-content {
      padding: 24px;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ANALYTICS PANEL */
    .analytics-panel {
      display: none;
      background: #0a0a0a;
      border: 1px solid var(--border);
      border-top: none;
      padding: 12px;
      max-height: 500px;
      overflow-y: auto;
    }
    .analytics-panel.open { display: block; }
    .radar-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .radar-card { background: #0d0d0d; border: 1px solid var(--border); border-left: 2px solid #1a1a1a; padding: 10px; }
    .radar-title { color: #ffffff; font-weight: 700; font-size: 0.9em; margin-bottom: 6px; }
    .radar-data { color: var(--gray); font-size: 0.85em; line-height: 1.5; }
    .radar-hot { color: var(--red); font-weight: 700; }
    .radar-cool { color: var(--green); font-weight: 700; }
    .radar-neutral { color: var(--cyan); font-weight: 700; }

    /* BURGUNDY MENU BAR - Hidden by default, shown via hamburger */
    .menu-bar {
      display: none;
      gap: 8px;
      padding: 10px 24px;
      background: var(--burgundy);
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
    }
    .menu-bar.open {
      display: flex;
    }
    .menu-item {
      background: transparent;
      border: 1px solid transparent;
      color: #ffffff;
      padding: 8px 14px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s, border-color 0.2s;
      font-size: 0.95em;
    }
    .menu-item.active { background: #b0303c; border-color: #d44a5c; }
    .menu-item:hover { opacity: 0.9; }

    /* NEWS TICKER BAR (TOP HEADER) - MARKET TICKER */
    .news-ticker-bar {
      width: 100%;
      height: 96px; /* 20% larger than Sniper ticker */
      background: #000000;
      border-top: 1px solid #333333;
      border-bottom: 1px solid #333333;
      overflow: hidden;
      position: relative;
      display: flex;
      align-items: center;
    }
    .news-ticker-content {
      display: flex;
      align-items: center;
      white-space: nowrap;
      animation: ticker-scroll 45s linear infinite;
      gap: 72px;
      padding: 0 48px;
    }
    .news-ticker-item {
      display: flex;
      align-items: center;
      gap: 20px;
      font-size: 1.08em;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .news-ticker-label {
      color: #ffffff;
      font-size: 2.64em;
      text-shadow: none;
    }
    .news-ticker-text {
      color: #cccccc;
      min-width: 192px;
      font-size: 1em;
    }
    .news-ticker-time {
      min-width: 144px;
      font-size: 1.02em;
      color: #999999;
    }
    .news-ticker-time.up {
      color: #aaaaaa;
    }
    .news-ticker-time.down {
      color: #888888;
    }

    /* TICKER BAR (BELOW RADAR, ABOVE BURGUNDY MENU) */
    .ticker-bar {
      width: 100%;
      height: 80px; /* 2x size (100% increase from 40px) */
      background: #000000;
      border-top: 1px solid #333333;
      border-bottom: 1px solid #333333;
      overflow: hidden;
      position: relative;
      display: flex;
      align-items: center;
    }
    .ticker-content {
      display: flex;
      align-items: center;
      white-space: nowrap;
      animation: ticker-scroll 45s linear infinite;
      gap: 60px; /* 2x spacing */
      padding: 0 40px; /* 2x padding */
    }
    .ticker-item {
      display: flex;
      align-items: center;
      gap: 16px; /* 2x gap */
      font-size: 0.9em;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .ticker-symbol {
      color: #ffffff;
      font-size: 2.2em; /* Large headers only */
      text-shadow: none;
    }
    .ticker-price {
      color: #cccccc;
      min-width: 160px; /* 2x width */
    }
    .ticker-change {
      min-width: 120px; /* 2x width */
      font-size: 0.85em;
      color: #999999;
    }
    .ticker-change.up {
      color: #aaaaaa;
    }
    .ticker-change.down {
      color: #888888;
    }
    /* Fear & Greed Index Colors */
    .ticker-price.extreme-greed { color: #00ff41; font-weight: 700; }
    .ticker-price.greed { color: #7fff00; }
    .ticker-price.neutral { color: #ffcc00; }
    .ticker-price.fear { color: #ff6600; }
    .ticker-price.extreme-fear { color: #ff3333; font-weight: 700; }
    @keyframes ticker-scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* DROP-DOWN PANELS UNDER MENU - SLIDE DOWN FROM TOP */
    .menu-panels { 
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 999;
      padding: 0;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease-out, padding 0.3s ease;
      background: #0a0a0a;
      border-bottom: 2px solid var(--border);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
    }
    .menu-panels.open {
      max-height: 80vh;
      padding: 10px 24px 20px 24px;
      overflow-y: auto;
    }
    .menu-panel {
      display: none;
      background: var(--panel);
      border: 1px solid var(--border);
      border-left: 3px solid var(--orange);
      padding: 14px;
      color: #ffffff;
      animation: slideDown 0.3s ease-out;
    }
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .menu-panel.active { display: block; }
    .menu-panels-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 12px;
    }
    .menu-panels-title {
      color: var(--orange);
      font-weight: 700;
      font-size: 1.1em;
      letter-spacing: 1px;
    }
    .menu-panels-close {
      background: none;
      border: 1px solid var(--red);
      color: var(--red);
      width: 36px;
      height: 36px;
      font-size: 1.4em;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .menu-panels-close:hover {
      background: var(--red);
      color: #000;
    }
    .panel-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px; }
    .panel-card { background: #0d0d0d; border: 1px solid var(--border); padding: 12px; }
    .panel-title { font-weight: 700; margin-bottom: 6px; letter-spacing: 0.5px; font-size: 0.95em; }
    .panel-text { color: var(--gray); font-size: 0.9em; line-height: 1.5; }
    .panel-text-strong { color: #f5f5f5; font-size: 0.96em; line-height: 1.6; }
    .panel-text-xl { color: #ffffff; font-size: 1.05em; line-height: 1.7; font-weight: 600; letter-spacing: 0.3px; }
    .panel-bullets { margin: 4px 0 0 16px; padding: 0; list-style: square; color: #f5f5f5; font-size: 0.96em; line-height: 1.6; }
    .panel-bullets li { margin-bottom: 4px; }
    .text-buy { color: var(--green); font-weight: 700; }
    .text-sell { color: var(--red); font-weight: 700; }
    .signal-tag { display: inline-block; padding: 4px 8px; border: 1px solid var(--border); background: #111; color: #fff; font-weight: 700; font-size: 0.8em; letter-spacing: 0.5px; margin-right: 6px; }
    .sparkline { width: 100%; height: 80px; background: #0a0a0a; border: 1px solid var(--border); padding: 6px; }
    .sparkline svg { width: 100%; height: 100%; }
    .mini-label { color: var(--gray); font-size: 0.8em; margin-top: 6px; }
    .mini-sparkline { width: 100%; height: 52px; background: #0a0a0a; border: 1px solid var(--border); margin: 6px 0; padding: 4px; }
    .mini-sparkline svg { width: 100%; height: 100%; }
    .cta-btn {
      display: inline-block;
      padding: 6px 12px;
      margin-top: 8px;
      background: var(--orange);
      color: #000000;
      border: 1px solid var(--orange);
      font-weight: 700;
      cursor: pointer;
      font-size: 0.85em;
      letter-spacing: 0.3px;
    }

    /* COLLAPSE BEHAVIOR */
    .nav-wrapper.collapsed .menu-bar,
    .nav-wrapper.collapsed .menu-panels {
      display: none;
    }
    @media (max-width: 1100px) {
      .hamburger-btn { display: flex; }
      .menu-bar { flex-wrap: wrap; }
    }
    @media (min-width: 1101px) {
      .hamburger-btn { display: none; }
    }
    
    /* MOBILE: Hide menu-bar items, show only hamburger */
    @media (max-width: 768px) {
      .menu-bar {
        flex-direction: column;
        padding: 8px;
        gap: 4px;
      }
      .menu-bar .menu-item {
        width: 100%;
        text-align: center;
        padding: 12px 16px;
        font-size: 0.9em;
      }
      .menu-bar .genius-hamburger-btn {
        width: 100%;
        justify-content: center;
        margin: 8px 0;
      }
    }

    /* SECTION HEADER WITH SENTIMENT */
    .section-header-wrapper {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 14px;
      padding: 14px 24px 2px 24px;
      margin-bottom: 0;
    }
    .section-header {
      background: var(--panel);
      padding: 10px 15px;
      border-left: 2px solid #1a1a1a;
    }
    .section-title {
      font-size: 0.95em;
      font-weight: 700;
      color: #ffffff;
    }
    .section-subtitle {
      font-size: 0.8em;
      color: #333333;
      margin-top: 3px;
    }
    .section-sentiment {
      background: var(--panel);
      padding: 10px 15px;
      border-left: 2px solid #1a1a1a;
    }
    .section-sentiment h3 {
      font-size: 1.05em;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 8px;
      letter-spacing: 0.8px;
      text-transform: uppercase;
    }
    .sentiment-stat {
      display: flex;
      justify-content: space-between;
      font-size: 0.9em;
      color: var(--gray);
      margin-bottom: 4px;
      line-height: 1.5;
    }
    .sentiment-stat span:last-child {
      color: #ffffff;
      font-weight: 600;
    }

    /* PSYCHOLOGY HEADER (monochrome) */
    .psych-title { color: #ffffff; font-weight: 700; font-size: 1.05em; letter-spacing: 0.8px; margin-bottom: 10px; text-transform: uppercase; }
    .psych-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .psych-card { border: 1px solid var(--border); padding: 10px; background: var(--panel); border-left: 2px solid #1a1a1a; }
    .psych-head { color: #ffffff; font-weight: 700; margin-bottom: 6px; font-size: 0.95em; }
    .psych-percent { color: #ffffff; font-weight: 700; }
    .psych-list { list-style: none; padding-left: 0; }
    .psych-list li { color: var(--gray); font-size: 0.9em; margin: 3px 0; line-height: 1.5; }
    .psych-note { color: var(--gray); font-size: 0.9em; margin-top: 12px; line-height: 1.5; }

    /* METRICS GRID (4 boxes like Bloomberg) */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
      padding: 14px 24px;
      margin-bottom: 0;
    }
    .metric-box {
      background: var(--panel);
      border: 1px solid var(--border);
      border-left: 2px solid #1a1a1a;
      padding: 15px;
    }
    .metric-label {
      font-size: 0.9em;
      color: var(--gray);
      margin-bottom: 8px;
      font-weight: 600;
      letter-spacing: 0.3px;
    }
    .metric-value {
      font-size: 2em;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 5px;
      letter-spacing: -0.5px;
    }
    .metric-change {
      font-size: 1em;
      font-weight: 600;
      color: #ffffff;
    }
    .metric-change.down { color: #ffffff; }

    /* TICKER */
    .ticker-wrapper {
      padding: 0 24px 8px 24px;
    }
    .ticker {
      background: #000;
      border: none;
      border-top: 1px solid #222;
      border-bottom: 1px solid #222;
      padding: 12px 14px;
      overflow: hidden;
      margin-bottom: 0;
      font-size: 1.3em;
      line-height: 1.3;
    }
    .ticker-track {
      display: inline-flex;
      gap: 25px;
      white-space: nowrap;
      animation: ticker-scroll 80s linear infinite;
    }
    .ticker-label {
      color: #666;
      font-weight: 700;
      margin-right: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .ticker-symbol { color: #888; margin-right: 4px; font-weight: 600; }
    .ticker-price { color: #fff; font-weight: 600; }
    .ticker-change { margin-left: 6px; font-size: 0.85em; color: #666; }
    .ticker-change.up { color: #888; }
    .ticker-change.down { color: #666; }
    .ticker-sep { color: #333; margin: 0 8px; }
    @keyframes ticker-scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* NEWS */
    .news {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 12px;
    }
    .news h4 {
      color: #ffffff;
      margin-bottom: 10px;
      font-size: 1.15em;
      font-weight: 700;
      letter-spacing: 0.8px;
      text-transform: uppercase;
    }
    .news-item {
      font-size: 1em;
      margin-bottom: 7px;
      padding: 5px 0;
      border-bottom: 1px solid #1a1a1a;
      line-height: 1.6;
    }
    .news-item:last-child {
      border-bottom: none;
    }

    /* BREAKING NEWS */
    .breaking-news {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 12px;
    }
    .news-breaking-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      padding: 0 24px 12px 24px;
    }
    .breaking-news h4 {
      color: #ffffff;
      margin-bottom: 12px;
      font-size: 1.15em;
      font-weight: 700;
      letter-spacing: 1.5px;
      text-transform: uppercase;
    }
    .breaking-item {
      display: grid;
      grid-template-columns: 0.8fr 1fr 1.2fr 0.7fr;
      gap: 10px;
      padding: 10px 8px;
      border-bottom: 1px solid #1a1a1a;
      font-size: 0.95em;
      align-items: center;
      line-height: 1.5;
    }
    .breaking-item:last-child {
      border-bottom: none;
    }
    .breaking-status {
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.85em;
      letter-spacing: 0.5px;
    }
    .breaking-category {
      font-weight: 700;
      color: var(--gray);
      font-size: 0.9em;
    }
    .breaking-source {
      color: var(--gray);
      font-size: 0.85em;
    }
    .breaking-headline {
      color: #ffffff;
      font-weight: 600;
      font-size: 1em;
    }
    .breaking-time {
      color: var(--gray);
      text-align: right;
      font-size: 0.8em;
    }
    .breaking-red { color: var(--red); }
    .breaking-green { color: var(--green); }

    /* BTC/ETH CARDS */
    .top-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
      padding: 14px 24px;
    }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 14px;
    }
    .card h3 {
      color: #ffffff;
      font-size: 1em;
      margin-bottom: 6px;
    }
    .price {
      font-size: 2.4em;
      font-weight: 700;
      color: var(--yellow);
    }
    .change {
      font-weight: 700;
      color: var(--green);
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.9em;
      color: var(--gray);
      margin-top: 4px;
    }
    .stat-row span:last-child {
      color: #ffffff;
      font-weight: 700;
    }

    /* CHART STYLES */
    /* TIMEFRAME SELECTOR */
    .timeframe-selector {
      display: flex;
      gap: 6px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    .timeframe-btn {
      background: #1a1a1a;
      border: 1px solid var(--border);
      color: var(--gray);
      padding: 6px 12px;
      cursor: pointer;
      font-size: 0.85em;
      font-weight: 600;
      font-family: 'Roboto Mono', monospace;
      transition: all 0.2s;
      letter-spacing: 0.5px;
    }
    .timeframe-btn:hover {
      background: #2a2a2a;
      border-color: var(--orange);
      color: #ffffff;
    }
    .timeframe-btn.active {
      background: var(--orange);
      border-color: var(--orange);
      color: #000000;
      font-weight: 700;
    }

    .chart-box {
      background: #131722;
      border: 1px solid #2a2e39;
      height: 400px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }
    .chart-svg {
      width: 100%;
      height: 100%;
      background: #131722;
    }
    .chart-grid {
      stroke: #1e222d;
      stroke-width: 0.5;
    }
    .chart-axis {
      stroke: #363a45;
      stroke-width: 1;
    }
    .chart-price-line {
      stroke: var(--orange);
      stroke-width: 3;
      fill: none;
      filter: drop-shadow(0 0 4px rgba(255, 140, 0, 0.6));
    }
    .chart-ema {
      stroke: var(--cyan);
      stroke-width: 2;
      fill: none;
      stroke-dasharray: 4,3;
      opacity: 0.9;
    }
    .chart-ema50 {
      stroke: #888888;
      stroke-width: 1.8;
      fill: none;
      stroke-dasharray: 5,4;
      opacity: 0.8;
    }
    .chart-support {
      stroke: var(--green);
      stroke-width: 2;
      stroke-dasharray: 8,4;
      filter: drop-shadow(0 0 3px rgba(0, 255, 0, 0.4));
    }
    .chart-resistance {
      stroke: var(--red);
      stroke-width: 2;
      stroke-dasharray: 8,4;
      filter: drop-shadow(0 0 3px rgba(255, 0, 0, 0.4));
    }
    .chart-liquidity {
      fill: rgba(0, 255, 0, 0.15);
    }
    .chart-buy-signal {
      fill: var(--green);
      filter: drop-shadow(0 0 6px rgba(0, 255, 0, 0.8));
    }
    .chart-sell-signal {
      fill: var(--red);
      filter: drop-shadow(0 0 6px rgba(255, 0, 0, 0.8));
    }
    .chart-label {
      font-size: 11px;
      fill: #aaaaaa;
      font-weight: bold;
      text-shadow: 0 0 2px #000;
    }
    .chart-value {
      font-size: 13px;
      fill: #ffffff;
      font-weight: bold;
      text-shadow: 0 0 3px #000;
    }
    .chart-price-current {
      font-size: 14px;
      fill: var(--orange);
      font-weight: 900;
    }
    .session-module {
      background: var(--panel);
      border: 1px solid var(--border);
      border-left: 2px solid #1a1a1a;
      padding: 14px 16px 16px 16px;
      margin-bottom: 18px;
    }
    .session-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .session-title {
      color: #ffffff;
      font-weight: 700;
      font-size: 0.95em;
      text-transform: uppercase;
      letter-spacing: 0.6px;
    }
    .session-timer {
      color: var(--yellow);
      font-weight: 700;
      font-size: 0.85em;
      letter-spacing: 0.4px;
    }
    .session-svg {
      width: 100%;
      height: 160px;
      background: #050505;
      border: 1px solid #101010;
    }
    .killzone-rect {
      fill-opacity: 0.18;
      stroke-width: 1;
      stroke-dasharray: 4,4;
    }
    .killzone-london {
      fill: rgba(0, 212, 255, 0.16);
      stroke: var(--cyan);
    }
    .killzone-ny {
      fill: rgba(255, 0, 51, 0.16);
      stroke: var(--red);
    }
    .killzone-asia {
      fill: rgba(255, 196, 0, 0.16);
      stroke: var(--yellow);
    }
    .killzone-block {
      transition: transform 0.3s ease;
    }
    .killzone-block.killzone-active {
      transform: scaleY(1.02);
    }
    .killzone-block.killzone-active .killzone-rect {
      stroke-width: 2;
      filter: drop-shadow(0 0 6px rgba(255, 196, 0, 0.35));
    }
    .killzone-block.killzone-upcoming .killzone-rect {
      stroke-dasharray: 6,4;
      opacity: 0.9;
    }
    .session-axis {
      stroke: #1a1a1a;
      stroke-width: 0.5;
    }
    .session-bubble {
      fill: rgba(255, 140, 0, 0.12);
      stroke: var(--orange);
      stroke-width: 1;
    }
    .session-bubble-tail {
      fill: rgba(255, 140, 0, 0.12);
      stroke: var(--orange);
      stroke-width: 1;
    }
    .session-bubble-text {
      font-size: 9px;
      fill: var(--orange);
      font-weight: 600;
    }
    .session-sniper-line {
      stroke: var(--green);
      stroke-width: 1.2;
      stroke-dasharray: 5,3;
    }
    .session-footer {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 12px;
      margin-top: 14px;
    }
    .session-signal-box,
    .session-push-box {
      background: #0d0d0d;
      border: 1px solid #1a1a1a;
      padding: 10px 12px;
    }
    .session-label {
      color: #ffffff;
      font-weight: 700;
      font-size: 0.85em;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      margin-bottom: 6px;
      display: block;
    }
    .session-signal-box span {
      display: block;
      color: var(--gray);
      font-size: 0.82em;
      line-height: 1.5;
    }
    .session-push-box {
      color: var(--gray);
      font-size: 0.83em;
      line-height: 1.5;
    }
    .genius-commentary {
      background: #0d0d0d;
      border: 1px solid var(--border);
      border-left: 2px solid var(--orange);
      padding: 12px 16px;
      margin-bottom: 20px;
    }
    .genius-commentary-title {
      color: #ffffff;
      font-weight: 700;
      font-size: 0.9em;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 6px;
    }
    .genius-commentary-text {
      color: var(--gray);
      font-size: 0.85em;
      line-height: 1.6;
    }
    .transfers {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 12px;
    }
    .transfer-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #161616;
      font-size: 0.92em;
    }
    .transfer-row:last-child {
      border-bottom: none;
    }
    .pos { color: #ffffff; font-weight: 700; }
    .neg { color: #ffffff; font-weight: 700; }

    /* TAB CONTENT STYLES */
    .tab-content {
      display: none;
      padding: 14px 24px;
      background: var(--panel);
      border-top: 1px solid var(--border);
      color: #ffffff;
    }
    .tab-content.active {
      display: block;
    }
    .tab-content h2 { color: #ffffff; }
    .trend-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-bottom: 20px;
    }
    .trend-card { background: #ffffff; border: 1px solid #e5e5e5; padding: 12px; }
    .trend-card h4 { color: #000000; font-size: 0.9em; margin-bottom: 8px; font-weight: 700; }
    .trend-card p { font-size: 0.85em; color: #333333; margin: 4px 0; }
    .trend-value { color: #111111; font-weight: 700; font-size: 1em; }
    .trend-up { color: #111111; }
    .trend-down { color: #111111; }
    .trend-neutral { color: #111111; }

    /* Trend Analysis dark variant with white text */
    #trend-analysis h2 { color: #ffffff !important; }
    #trend-analysis .trend-card { background: var(--panel); border: 1px solid var(--border); border-left: 2px solid #1a1a1a; }
    #trend-analysis .trend-card h4 { color: #ffffff; }
    #trend-analysis .trend-card p { color: #dddddd; }
    #trend-analysis .trend-value { color: #ffffff; }
    #trend-analysis .trend-up, 
    #trend-analysis .trend-down, 
    #trend-analysis .trend-neutral { color: #ffffff; }
    
    /* CORRELATION TABLE (dark) */
    .corr-wrapper { background: var(--panel); border: 1px solid var(--border); padding: 14px; }
    .corr-controls { display: flex; gap: 8px; align-items: center; margin-bottom: 12px; }
    .corr-select, .corr-btn { background: #0e0e0e; border: 1px solid var(--border); color: #ffffff; padding: 6px 10px; font-family: 'Roboto Mono', monospace; font-size: 0.85em; }
    .corr-btn.active { background: var(--orange); color: #000000; border-color: var(--orange); font-weight: 700; }
    .corr-grid { width: 100%; border-collapse: collapse; }
    .corr-grid th, .corr-grid td { border: 1px solid #161616; padding: 6px 8px; text-align: center; font-size: 0.85em; }
    .corr-grid th { background: #0f0f0f; color: #ffffff; font-weight: 700; }
    .corr-asset { text-align: left; color: #ffffff; font-weight: 700; }
    .corr-cell { color: #ffffff; }
    .heat-pos-high { background: rgba(0,255,65,0.12); }
    .heat-pos-mid { background: rgba(0,255,65,0.08); }
    .heat-pos-low { background: rgba(0,255,65,0.04); }
    .heat-neg-high { background: rgba(255,0,51,0.12); }
    .heat-neg-mid { background: rgba(255,0,51,0.08); }
    .heat-neg-low { background: rgba(255,0,51,0.04); }
    .corr-summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 12px; }
    .corr-card { background: #0d0d0d; border: 1px solid var(--border); padding: 10px; }
    .corr-card h4 { color: #ffffff; font-size: 0.9em; margin-bottom: 6px; }
    .corr-card p { color: #dddddd; font-size: 0.85em; }

    /* MULTI-TF ANALYSIS (dark) */
    .tf-wrapper { background: var(--panel); border: 1px solid var(--border); padding: 14px; }
    .tf-guide { background: #0e0e0e; border: 1px solid var(--border); padding: 12px; margin-bottom: 14px; color: #ffffff; }
    .tf-guide h3 { color: #ffffff; font-size: 1em; margin-bottom: 8px; }
    .tf-guide ul { list-style: none; padding-left: 0; }
    .tf-guide li { color: #dddddd; font-size: 0.85em; margin: 4px 0; }
    .tf-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    .tf-card { background: #0d0d0d; border: 1px solid var(--border); padding: 10px; color: #ffffff; }
    .tf-title { color: #ffffff; font-weight: 700; font-size: 0.95em; margin-bottom: 6px; display: flex; justify-content: space-between; }
    .tf-status { font-weight: 700; color: #ffffff; }
    .tf-bull { color: var(--green); }
    .tf-bear { color: var(--red); }
    .tf-neutral { color: var(--yellow); }
    .tf-sideways { color: var(--cyan); }
    .tf-konsol { color: var(--yellow); }
    .tf-row { display: flex; justify-content: space-between; color: #dddddd; font-size: 0.85em; }
    .tf-row span:last-child { color: #ffffff; font-weight: 700; }
    @media (max-width: 1200px) { .tf-grid { grid-template-columns: 1fr; } }

    @media (max-width: 1200px) {
      .metrics-grid { grid-template-columns: repeat(2, 1fr); }
      .top-grid { grid-template-columns: repeat(2, 1fr); }
      .middle-section { grid-template-columns: 1fr; }
      .trend-grid { grid-template-columns: 1fr; }
    }

    /* TOOLS DROPDOWN CONTAINER */
    .tools-dropdown-container {
      position: relative;
      display: inline-block;
      margin-left: 12px;
    }
    .tools-nav-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: rgba(255, 140, 0, 0.2);
      backdrop-filter: blur(8px);
      border: 2px solid rgba(255, 140, 0, 0.5);
      border-radius: 8px;
      color: var(--orange);
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 12px rgba(255, 140, 0, 0.3);
    }
    .tools-nav-btn:hover {
      background: rgba(255, 140, 0, 0.35);
      border-color: var(--orange);
      box-shadow: 0 0 20px rgba(255, 140, 0, 0.5);
      transform: scale(1.05);
    }
    .tools-nav-btn.active {
      background: rgba(255, 140, 0, 0.4);
      border-color: var(--orange);
    }
    .tools-nav-icon {
      font-size: 1.1em;
    }
    .tools-nav-text {
      font-weight: 800;
      letter-spacing: 2px;
      font-size: 0.85em;
      text-transform: uppercase;
    }
    .tools-dropdown-arrow {
      font-size: 0.7em;
      transition: transform 0.3s ease;
    }
    .tools-nav-btn.active .tools-dropdown-arrow {
      transform: rotate(180deg);
    }
    /* TOOLS DROPDOWN PANEL */
    .tools-dropdown {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      width: 420px;
      max-height: 80vh;
      background: linear-gradient(180deg, #0d0d0d 0%, #0a0a0a 100%);
      border: 2px solid var(--orange);
      border-radius: 8px;
      box-shadow: 0 8px 32px rgba(255, 140, 0, 0.3);
      z-index: 10001;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      overflow-y: auto;
    }
    .tools-dropdown.open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    .tools-dropdown-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: rgba(255, 140, 0, 0.1);
      border-bottom: 2px solid var(--orange);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .tools-dropdown-title {
      color: var(--orange);
      font-weight: 900;
      letter-spacing: 1px;
      font-size: 0.95em;
    }
    .tools-dropdown-close {
      background: transparent;
      border: 1px solid var(--orange);
      color: var(--orange);
      width: 24px;
      height: 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1em;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .tools-dropdown-close:hover {
      background: var(--orange);
      color: #000;
    }
    .tools-dropdown-content {
      padding: 12px;
    }
    .tools-dropdown-section {
      background: rgba(26, 26, 26, 0.8);
      border: 1px solid #333;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 12px;
    }
    .tools-dropdown-section:last-child {
      margin-bottom: 0;
    }
    .tools-section-title {
      color: var(--orange);
      font-weight: 800;
      font-size: 0.9em;
      margin-bottom: 10px;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .tools-grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .tools-grid-2 label {
      color: #aaa;
      font-size: 0.8em;
      font-weight: 600;
    }
    .tools-grid-2 input, .tools-grid-2 select {
      width: 100%;
      padding: 8px;
      background: #0a0a0a;
      color: #fff;
      border: 1px solid #333;
      border-radius: 4px;
      font-size: 0.9em;
      font-family: 'Courier New', monospace;
    }
    .tools-grid-2 input:focus, .tools-grid-2 select:focus {
      border-color: var(--orange);
      outline: none;
    }
    .tools-result-box {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid #333;
      border-radius: 4px;
      padding: 10px;
      margin-top: 10px;
      font-family: 'Courier New', monospace;
    }
    .tools-result-row {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      font-size: 0.85em;
    }
    .tools-result-label {
      color: #888;
    }
    .tools-result-value {
      color: #fff;
      font-weight: 600;
    }
    .tools-result-value.green { color: var(--green); }
    .tools-result-value.red { color: var(--red); }
    .tools-result-value.cyan { color: var(--cyan); }
    .tools-result-value.orange { color: var(--orange); }
    @media (max-width: 768px) {
      .tools-dropdown {
        width: calc(100vw - 20px);
        left: -100px;
        max-height: 70vh;
      }
    }

    /* SIDEBAR MARKET INFO */
    .sidebar {
      position: fixed;
      right: 0;
      top: 0;
      width: 280px;
      height: 100vh;
      background: #0a0a0a;
      border-left: 2px solid var(--border);
      overflow-y: auto;
      padding: 14px;
      z-index: 100;
      display: none;
    }
    .sidebar-title { color: #ffffff; font-weight: 700; font-size: 1em; margin-bottom: 12px; letter-spacing: 0.5px; }
    .sidebar-item { background: #0d0d0d; border: 1px solid var(--border); padding: 10px; margin-bottom: 8px; }
    .sidebar-label { color: var(--gray); font-size: 0.85em; }
    .sidebar-value { color: #ffffff; font-weight: 700; font-size: 0.95em; }
    .sidebar-ticker { color: #ffffff; font-size: 0.9em; line-height: 1.4; }
    .ticker-up { color: var(--green); }
    .ticker-down { color: var(--red); }

    /* HAMBURGER & ANALYTICS BUTTONS CONTAINER */
    .hamburger-container {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: center;
      padding: 10px 16px;
      background: #0d0d0d;
      border-bottom: 1px solid var(--border);
    }

    /* HAMBURGER MENU BUTTON - LARGER FOR MOBILE */
    .hamburger-menu {
      display: flex;
      flex-direction: column;
      gap: 6px;
      background: rgba(255, 140, 0, 0.1);
      border: 2px solid var(--orange);
      border-radius: 8px;
      cursor: pointer;
      padding: 14px 20px;
      min-width: 70px;
      min-height: 60px;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      position: relative;
    }
    
    .hamburger-menu:hover {
      border-color: var(--orange);
      background: rgba(255, 140, 0, 0.2);
    }
    
    .hamburger-menu:active {
      background: rgba(255, 140, 0, 0.3);
      transform: scale(0.95);
    }

    .hamburger-menu .bar {
      width: 30px;
      height: 4px;
      background: var(--orange);
      transition: all 0.3s ease;
      display: block;
      border-radius: 2px;
    }

    .hamburger-menu.open .bar:nth-child(1) {
      transform: translateY(10px) rotate(45deg);
    }

    .hamburger-menu.open .bar:nth-child(2) {
      opacity: 0;
    }

    .hamburger-menu.open .bar:nth-child(3) {
      transform: translateY(-10px) rotate(-45deg);
    }

    /* Mobile: Center hamburger */
    @media (max-width: 768px) {
      .hamburger-container {
        flex-direction: column;
        gap: 10px;
        padding: 12px;
      }
      
      .hamburger-menu {
        min-width: 120px;
        min-height: 65px;
        padding: 16px 30px;
        order: -1;
      }
      
      .hamburger-menu .bar {
        width: 36px;
        height: 5px;
      }
      
      .hamburger-menu::after {
        content: 'MENU';
        position: absolute;
        bottom: -18px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.7em;
        font-weight: 700;
        color: var(--orange);
        letter-spacing: 1px;
      }
      
      .hamster-header {
        display: none !important;
      }
      
      .hamburger-container > div[style*="margin-left: auto"] {
        margin-left: 0 !important;
        width: 100%;
        justify-content: center !important;
      }
    }

    /* ANALYTICS BUTTON */
    .analytics-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      background: transparent;
      border: 1px solid var(--border);
      color: #ffffff;
      cursor: pointer;
      padding: 8px 14px;
      font-size: 0.95em;
      font-weight: 600;
      border-radius: 0;
      transition: all 0.2s;
      font-family: 'Roboto Mono', monospace;
    }

    .analytics-btn:hover {
      border-color: var(--orange);
      background: #0a0a0a;
    }

    .analytics-btn.open {
      background: #1a1a1a;
      border-color: var(--orange);
      color: var(--orange);
    }

    .analytics-icon {
      font-size: 1.1em;
    }

    /* ===== ANALYTICS PANEL (BOTTOM EXPANDABLE) ===== */
    .analytics-panel {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease;
      background: #0a0a0a;
      border-bottom: 1px solid var(--border);
    }

    .analytics-panel.open {
      max-height: 2000px;
    }

    .radar-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
      padding: 14px 24px;
    }

    .radar-card {
      background: #0d0d0d;
      border: 1px solid var(--border);
      border-left: 2px solid #1a1a1a;
      padding: 12px;
    }

    .radar-title {
      color: #ffffff;
      font-weight: 700;
      font-size: 0.95em;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }

    .radar-data {
      color: #dddddd;
      font-size: 0.9em;
      line-height: 1.6;
    }

    .radar-data div {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .radar-cool {
      color: var(--green);
      font-weight: 600;
    }

    .radar-hot {
      color: var(--red);
      font-weight: 600;
    }

    .radar-neutral {
      color: var(--yellow);
      font-weight: 600;
    }

    @media (max-width: 1000px) {
      .radar-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ===== SIDE DRAWER - ADVANCED ANALYTICS ===== */
    .analytics-drawer {
      position: fixed;
      right: -450px;
      top: 0;
      width: 450px;
      height: 100vh;
      background: linear-gradient(135deg, #0a0a0a 0%, #0f0f0f 100%);
      border-left: 2px solid var(--orange);
      overflow-y: auto;
      z-index: 200;
      transition: right 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: -10px 0 40px rgba(255, 140, 0, 0.15);
    }

    .analytics-drawer.open {
      right: 0;
    }

    .analytics-drawer::-webkit-scrollbar {
      width: 8px;
    }

    .analytics-drawer::-webkit-scrollbar-track {
      background: #0a0a0a;
    }

    .analytics-drawer::-webkit-scrollbar-thumb {
      background: var(--orange);
      border-radius: 4px;
    }

    .drawer-header {
      background: linear-gradient(90deg, var(--burgundy), #1a0015);
      padding: 14px 18px;
      border-bottom: 2px solid var(--orange);
      position: sticky;
      top: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
    }

    .drawer-header h2 {
      color: #ffffff;
      font-size: 1.1em;
      font-weight: 700;
      letter-spacing: 1px;
      margin: 0;
    }

    .close-drawer {
      background: transparent;
      border: none;
      color: #ffffff;
      font-size: 1.4em;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s;
    }

    .close-drawer:hover {
      color: var(--orange);
    }

    .drawer-tabs {
      display: flex;
      gap: 0;
      padding: 0 18px;
      margin-top: 12px;
      border-bottom: 1px solid var(--border);
    }

    .drawer-tab {
      background: transparent;
      border: none;
      color: var(--gray);
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85em;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      font-family: 'Roboto Mono', monospace;
    }

    .drawer-tab.active {
      color: var(--orange);
      border-bottom-color: var(--orange);
    }

    .drawer-tab:hover {
      color: #ffffff;
    }

    .drawer-content {
      padding: 18px;
    }

    /* HEATMAP STYLES */
    .heatmap-container {
      background: #0d0d0d;
      border: 1px solid var(--border);
      padding: 12px;
      margin-bottom: 14px;
      border-left: 2px solid var(--orange);
    }

    .heatmap-title {
      color: #ffffff;
      font-weight: 700;
      font-size: 0.9em;
      margin-bottom: 10px;
      letter-spacing: 0.5px;
    }

    .heatmap-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 4px;
      margin-bottom: 8px;
    }

    .heatmap-cell {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75em;
      font-weight: 600;
      color: #ffffff;
      border-radius: 2px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .heatmap-cell:hover {
      transform: scale(1.1);
      box-shadow: 0 0 12px rgba(255, 140, 0, 0.5);
    }

    .heat-high-pos { background: rgba(0, 255, 65, 0.8); }
    .heat-mid-pos { background: rgba(0, 255, 65, 0.4); }
    .heat-neutral { background: rgba(100, 100, 100, 0.4); }
    .heat-mid-neg { background: rgba(255, 0, 51, 0.4); }
    .heat-high-neg { background: rgba(255, 0, 51, 0.8); }

    /* OPTION ROWS */
    .option-row {
      background: #0d0d0d;
      border: 1px solid var(--border);
      padding: 10px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 2px solid var(--orange);
    }

    .option-label {
      color: #ffffff;
      font-weight: 600;
      font-size: 0.9em;
    }

    .option-value {
      color: var(--orange);
      font-weight: 700;
      font-size: 0.9em;
    }

    /* UNUSUAL ITEMS */
    .unusual-item {
      background: #0d0d0d;
      border: 1px solid var(--border);
      padding: 12px;
      margin-bottom: 10px;
      border-left: 3px solid var(--orange);
    }

    .unusual-header {
      color: #ffffff;
      font-weight: 700;
      font-size: 0.9em;
      margin-bottom: 6px;
    }

    .unusual-value {
      color: var(--orange);
      font-weight: 700;
      font-size: 0.95em;
      margin-bottom: 4px;
    }

    .unusual-note {
      color: #999999;
      font-size: 0.8em;
      font-style: italic;
    }

    .pill-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .pill {
      display: inline-block;
      padding: 6px 10px;
      font-size: 0.8em;
      font-weight: 600;
      border-radius: 2px;
      letter-spacing: 0.3px;
    }

    .pill-hot {
      background: rgba(255, 0, 51, 0.15);
      color: var(--red);
    }

    .pill-cool {
      background: rgba(0, 255, 65, 0.15);
      color: var(--green);
    }

    .pill-neutral {
      background: rgba(255, 255, 0, 0.15);
      color: var(--yellow);
    }

    .live-comment {
      color: #ffffff;
      font-size: 0.9em;
      line-height: 1.5;
      margin-bottom: 8px;
      padding: 8px;
      background: #0a0a0a;
      border-left: 2px solid var(--orange);
    }

    .tactic-note {
      color: var(--cyan);
      font-size: 0.85em;
      line-height: 1.5;
      padding: 8px;
      background: rgba(0, 212, 255, 0.05);
      border-left: 2px solid var(--cyan);
    }

    /* HAMSTER TERMINAL HEADER BAR */
    .hamster-header {
      width: auto;
      height: auto;
      background: none;
      border: none;
      display: flex;
      align-items: center;
      padding: 0 12px;
      font-size: 0.95em;
      color: var(--yellow);
      font-weight: 700;
      letter-spacing: 1px;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .hamster-header-icon {
      font-size: 1.4em;
      margin-right: 10px;
    }
    .hamster-header-text {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      color: #ffffff;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .hamster-header-market {
      color: #ffffff;
      letter-spacing: 1.2px;
      display: inline-flex;
      gap: 6px;
      align-items: center;
    }
    .hamster-header-crypto {
      color: var(--yellow);
      font-weight: 700;
    }
    
    /* WebSocket Live Price Animation */
    .price-flash-up {
      animation: flashGreen 0.5s ease-out;
    }
    .price-flash-down {
      animation: flashRed 0.5s ease-out;
    }
    @keyframes flashGreen {
      0% { color: #00ff00; text-shadow: 0 0 10px #00ff00; }
      100% { color: inherit; text-shadow: none; }
    }
    @keyframes flashRed {
      0% { color: #ff4444; text-shadow: 0 0 10px #ff4444; }
      100% { color: inherit; text-shadow: none; }
    }
    .ws-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.7em;
      color: #666;
    }
    .ws-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #444;
    }
    .ws-dot.connected {
      background: #00ff00;
      box-shadow: 0 0 6px #00ff00;
    }
    .ws-dot.connecting {
      background: #ffaa00;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    #typewriterCursor {
      color: #ff6b00;
      font-weight: bold;
    }
  </style>
  <!-- Socket.IO Client Library -->
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
</head>
<body>

  <!-- GENIUS AI SLIDE-OUT PANELS -->
  
  <!-- Smart Alerts Panel -->
  <div id="genius-panel-alerts" class="genius-panel">
    <div class="genius-panel-header">
      <div class="genius-panel-title">SMART ALERTS</div>
      <button class="genius-panel-close" onclick="closeGeniusPanel('genius-panel-alerts')"></button>
    </div>
    <div class="genius-panel-content">
      <div style="background: rgba(255, 140, 0, 0.1); border: 1px solid var(--orange); padding: 12px; border-radius: 6px; margin-bottom: 20px;">
        <div style="color: var(--orange); font-weight: 700; margin-bottom: 8px;">CREATE ALERT</div>
        <select id="alertSymbol" style="width: 100%; padding: 8px; background: #0a0a0a; color: #fff; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 8px;">
          <option>BTC/USD</option>
          <option>ETH/USD</option>
          <option>SOL/USD</option>
        </select>
        <select id="alertType" style="width: 100%; padding: 8px; background: #0a0a0a; color: #fff; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 8px;">
          <option value="price">Price Alert</option>
          <option value="volume">Volume Spike</option>
          <option value="change">% Change</option>
        </select>
        <input type="number" id="alertValue" placeholder="Target value" style="width: 100%; padding: 8px; background: #0a0a0a; color: #fff; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 8px;">
        <button onclick="createSmartAlert()" style="width: 100%; padding: 10px; background: var(--orange); color: #000; border: none; border-radius: 4px; font-weight: 700; cursor: pointer;">CREATE ALERT</button>
      </div>
      <div style="color: #fff; font-weight: 700; margin-bottom: 12px;">ACTIVE ALERTS</div>
      <div id="alertsList" style="color: var(--gray); font-size: 0.9em;">No active alerts. Create one above.</div>
    </div>
  </div>

  <!-- Genius Chat AI Panel -->
  <div id="genius-panel-chat" class="genius-panel">
    <div class="genius-panel-header">
      <div class="genius-panel-title"> Genius Chat AI</div>
      <button class="genius-panel-close" onclick="closeGeniusPanel('genius-panel-chat')"></button>
    </div>
    <div class="genius-panel-content">
      <div style="background: rgba(0, 212, 255, 0.1); border: 1px solid var(--cyan); padding: 12px; border-radius: 6px; margin-bottom: 16px;">
        <div style="color: var(--cyan); font-weight: 700; margin-bottom: 8px;"> VOICE OPTIONS</div>
        <label style="display: flex; align-items: center; gap: 8px; color: #fff; margin-bottom: 8px;">
          <input type="checkbox" id="voiceEnabled" checked>
          <span>Enable voice responses</span>
        </label>
        <select id="voiceLanguage" style="width: 100%; padding: 8px; background: #0a0a0a; color: #fff; border: 1px solid var(--border); border-radius: 4px;">
          <option value="en">English</option>
          <option value="pl" selected>Polski</option>
          <option value="es">Espaol</option>
          <option value="de">Deutsch</option>
        </select>
      </div>
      <div id="chatMessages" style="height: 400px; overflow-y: auto; background: #0a0a0a; border: 1px solid var(--border); border-radius: 6px; padding: 12px; margin-bottom: 12px;">
        <div style="color: var(--cyan); font-size: 0.9em;"> Genius AI ready. Ask me anything about markets!</div>
      </div>
      <div style="display: flex; gap: 8px;">
        <input type="text" id="chatInput" placeholder="Ask Genius AI..." style="flex: 1; padding: 10px; background: #0a0a0a; color: #fff; border: 1px solid var(--border); border-radius: 4px;">
        <button onclick="sendGeniusMessage()" style="padding: 10px 20px; background: var(--cyan); color: #000; border: none; border-radius: 4px; font-weight: 700; cursor: pointer;">SEND</button>
      </div>
    </div>
  </div>

  <!-- Portfolio Panel -->
  <div id="genius-panel-portfolio" class="genius-panel">
    <div class="genius-panel-header">
      <div class="genius-panel-title"> Portfolio</div>
      <button class="genius-panel-close" onclick="closeGeniusPanel('genius-panel-portfolio')"></button>
    </div>
    <div class="genius-panel-content">
      <div style="background: rgba(0, 255, 65, 0.1); border: 1px solid var(--green); padding: 14px; border-radius: 6px; margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <span style="color: var(--gray);">Health Score</span>
          <span id="portfolioHealth" style="color: var(--green); font-weight: 700; font-size: 1.2em;">--</span>
        </div>
        <div style="width: 100%; height: 8px; background: #1a1a1a; border-radius: 4px; overflow: hidden;">
          <div id="portfolioHealthBar" style="width: 0%; height: 100%; background: var(--green); transition: width 0.3s;"></div>
        </div>
      </div>
      <div style="color: #fff; font-weight: 700; margin-bottom: 12px;">HOLDINGS</div>
      <div id="portfolioHoldings" style="color: var(--gray); font-size: 0.9em;">Loading portfolio...</div>
      <button onclick="analyzePortfolio()" style="width: 100%; padding: 10px; background: var(--green); color: #000; border: none; border-radius: 4px; font-weight: 700; cursor: pointer; margin-top: 16px;">ANALYZE</button>
    </div>
  </div>

  <!-- Quick Trade Panel -->
  <div id="genius-panel-quick-trade" class="genius-panel">
    <div class="genius-panel-header">
      <div class="genius-panel-title"> Quick Trade</div>
      <button class="genius-panel-close" onclick="closeGeniusPanel('genius-panel-quick-trade')"></button>
    </div>
    <div class="genius-panel-content">
      <div style="background: rgba(255, 255, 0, 0.1); border: 1px solid var(--yellow); padding: 12px; border-radius: 6px; margin-bottom: 16px;">
        <div style="color: var(--yellow); font-weight: 700; margin-bottom: 12px;">MARKET ORDER</div>
        <select id="tradeSymbol" style="width: 100%; padding: 8px; background: #0a0a0a; color: #fff; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 8px;">
          <option>BTC/USD</option>
          <option>ETH/USD</option>
          <option>SOL/USD</option>
        </select>
        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
          <button onclick="setTradeType('buy')" id="buyBtn" style="flex: 1; padding: 10px; background: var(--green); color: #000; border: none; border-radius: 4px; font-weight: 700; cursor: pointer;">BUY</button>
          <button onclick="setTradeType('sell')" id="sellBtn" style="flex: 1; padding: 10px; background: var(--red); color: #fff; border: none; border-radius: 4px; font-weight: 700; cursor: pointer;">SELL</button>
        </div>
        <input type="number" id="tradeAmount" placeholder="Amount (USD)" style="width: 100%; padding: 8px; background: #0a0a0a; color: #fff; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 8px;">
        <button onclick="executeQuickTrade()" style="width: 100%; padding: 12px; background: var(--orange); color: #000; border: none; border-radius: 4px; font-weight: 700; cursor: pointer; font-size: 1.1em;">EXECUTE TRADE</button>
      </div>
      <div style="color: #fff; font-weight: 700; margin-bottom: 12px;">RECENT TRADES</div>
      <div id="tradeHistory" style="color: var(--gray); font-size: 0.85em;">No recent trades.</div>
    </div>
  </div>

  <!-- Technical Analysis Panel -->
  <div id="genius-panel-technical" class="genius-panel">
    <div class="genius-panel-header">
      <div class="genius-panel-title"> Technical Analysis</div>
      <button class="genius-panel-close" onclick="closeGeniusPanel('genius-panel-technical')"></button>
    </div>
    <div class="genius-panel-content">
      <div style="background: rgba(0, 212, 255, 0.1); border: 1px solid var(--cyan); padding: 12px; border-radius: 6px; margin-bottom: 16px;">
        <div style="color: var(--cyan); font-weight: 700; margin-bottom: 12px;">INDICATORS</div>
        <div style="color: #fff; margin-bottom: 8px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span>RSI (14)</span>
            <span id="rsiValue" style="color: var(--yellow);">--</span>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span>MACD</span>
            <span id="macdValue" style="color: var(--green);">--</span>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span>BB Position</span>
            <span id="bbValue" style="color: var(--gray);">--</span>
          </div>
        </div>
      </div>
      <div style="color: #fff; font-weight: 700; margin-bottom: 12px;">PATTERNS DETECTED</div>
      <div id="patternsList" style="color: var(--gray); font-size: 0.9em;">Scanning for patterns...</div>
      <button onclick="loadTechnicalAnalysis()" style="width: 100%; padding: 10px; background: var(--cyan); color: #000; border: none; border-radius: 4px; font-weight: 700; cursor: pointer; margin-top: 16px;">REFRESH ANALYSIS</button>
    </div>
  </div>

  <!-- Strategy Builder Panel -->
  <div id="genius-panel-strategy" class="genius-panel">
    <div class="genius-panel-header">
      <div class="genius-panel-title"> Strategy Builder</div>
      <button class="genius-panel-close" onclick="closeGeniusPanel('genius-panel-strategy')"></button>
    </div>
    <div class="genius-panel-content">
      <div style="background: rgba(255, 140, 0, 0.1); border: 1px solid var(--orange); padding: 12px; border-radius: 6px; margin-bottom: 16px;">
        <div style="color: var(--orange); font-weight: 700; margin-bottom: 12px;">CREATE STRATEGY</div>
        <input type="text" id="strategyName" placeholder="Strategy name" style="width: 100%; padding: 8px; background: #0a0a0a; color: #fff; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 8px;">
        <select id="strategyType" style="width: 100%; padding: 8px; background: #0a0a0a; color: #fff; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 8px;">
          <option>Trend Following</option>
          <option>Mean Reversion</option>
          <option>Breakout</option>
          <option>Scalping</option>
        </select>
        <div style="color: #fff; margin-bottom: 8px;">Entry Conditions:</div>
        <textarea id="entryConditions" placeholder="e.g., RSI < 30 and MACD crosses up" style="width: 100%; padding: 8px; background: #0a0a0a; color: #fff; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 8px; min-height: 60px;"></textarea>
        <button onclick="backtestStrategy()" style="width: 100%; padding: 10px; background: var(--orange); color: #000; border: none; border-radius: 4px; font-weight: 700; cursor: pointer;">BACKTEST</button>
      </div>
      <div style="color: #fff; font-weight: 700; margin-bottom: 12px;">SAVED STRATEGIES</div>
      <div id="strategiesList" style="color: var(--gray); font-size: 0.9em;">No saved strategies yet.</div>
    </div>
  </div>



  <div class="nav-wrapper" id="navWrapper">
    <!-- HAMBURGER + ANALYTICS BUTTONS CONTAINER -->
    <div class="hamburger-container">
      <!-- HAMSTER TERMINAL LABEL (hidden on mobile) -->
      <div class="hamster-header" style="margin: 0 8px; width: auto; height: auto; background: none; border: none; padding: 0 12px;">
        <span class="hamster-header-icon" aria-hidden="true"></span>
        <span class="hamster-header-text">
          <span class="hamster-header-market">
            <span>BTC USD</span>
            <span class="hamster-header-crypto">Crypto</span>
          </span>
          <span>|</span>
          <span>Hamster Terminal <span style="color: #00ff41; font-size: 0.7em;">v6.0</span></span>
        </span>
      </div>
      
      <!-- HAMBURGER MENU (CENTER ON MOBILE) -->
      <button class="hamburger-menu" id="hamburgerMenu" title="Main Menu">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </button>
      
      <!-- TOOLS DROPDOWN (slides down) -->
      <div class="tools-dropdown-container">
        <button class="tools-nav-btn" id="toolsBtn" title="Trading Tools">
          <span class="tools-nav-icon">T</span>
          <span class="tools-nav-text">TOOLS</span>
          <span class="tools-dropdown-arrow"></span>
        </button>
        <div class="tools-dropdown" id="toolsDropdown">
          <div class="tools-dropdown-header">
            <span class="tools-dropdown-title">TRADING TOOLS</span>
            <button class="tools-dropdown-close" id="closeToolsDropdown"></button>
          </div>
          <div class="tools-dropdown-content">
            
            <!-- PIP VALUE CALCULATOR -->
            <div class="tools-dropdown-section">
              <div class="tools-section-title">PIP VALUE CALCULATOR</div>
              <div class="tools-grid-2">
                <label>Instrument
                  <select id="pipInstrument">
                    <option value="XAUUSD">XAUUSD (Gold)</option>
                    <option value="XAGUSD">XAGUSD (Silver)</option>
                    <option value="EURUSD">EURUSD</option>
                    <option value="GBPUSD">GBPUSD</option>
                    <option value="USDJPY">USDJPY</option>
                    <option value="US30">US30 (Dow Jones)</option>
                    <option value="NAS100">NAS100 (Nasdaq)</option>
                    <option value="SPX500">SPX500 (S&P 500)</option>
                    <option value="DE40">DE40 (DAX)</option>
                    <option value="BTCUSD">BTCUSD</option>
                    <option value="ETHUSD">ETHUSD</option>
                    <option value="USOIL">USOIL (WTI Crude)</option>
                  </select>
                </label>
                <label>Lot Size
                  <input type="number" id="pipLotSize" value="0.1" step="0.01" min="0.01">
                </label>
                <label>Account Currency
                  <select id="pipCurrency">
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="PLN">PLN</option>
                    <option value="GBP">GBP</option>
                  </select>
                </label>
                <label>Leverage
                  <select id="pipLeverage">
                    <option value="1">1:1</option>
                    <option value="10">1:10</option>
                    <option value="20">1:20</option>
                    <option value="30">1:30</option>
                    <option value="50">1:50</option>
                    <option value="100" selected>1:100</option>
                    <option value="200">1:200</option>
                    <option value="500">1:500</option>
                  </select>
                </label>
              </div>
              <div class="tools-result-box" id="pipResults">
                <div style="color: var(--cyan); font-weight: 700; margin-bottom: 8px; font-size: 0.85em;">PIP VALUES:</div>
                <div class="tools-result-row">
                  <span class="tools-result-label">0.1 pip:</span>
                  <span class="tools-result-value" id="pip01val">--</span>
                </div>
                <div class="tools-result-row">
                  <span class="tools-result-label">0.5 pip:</span>
                  <span class="tools-result-value cyan" id="pip05val">--</span>
                </div>
                <div class="tools-result-row">
                  <span class="tools-result-label">1 pip:</span>
                  <span class="tools-result-value green" id="pip1val">--</span>
                </div>
                <div class="tools-result-row">
                  <span class="tools-result-label">10 pips:</span>
                  <span class="tools-result-value orange" id="pip10val">--</span>
                </div>
                <div style="border-top: 1px solid #333; margin-top: 8px; padding-top: 8px;">
                  <div class="tools-result-row">
                    <span class="tools-result-label">Contract Size:</span>
                    <span class="tools-result-value" id="pipContractSize">--</span>
                  </div>
                  <div class="tools-result-row">
                    <span class="tools-result-label">Margin Required:</span>
                    <span class="tools-result-value orange" id="pipMargin">--</span>
                  </div>
                  <div class="tools-result-row">
                    <span class="tools-result-label">Position Value:</span>
                    <span class="tools-result-value cyan" id="pipPositionValue">--</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- QUICK POSITION CALCULATOR -->
            <div class="tools-dropdown-section">
              <div class="tools-section-title">POSITION CALCULATOR</div>
              <div class="tools-grid-2">
                <label>Account Size ($)
                  <input type="number" id="posAccSize" value="10000" step="100">
                </label>
                <label>Risk %
                  <input type="number" id="posRisk" value="1" step="0.1" min="0.1" max="10">
                </label>
                <label>Entry Price
                  <input type="number" id="posEntry" value="2650" step="0.01">
                </label>
                <label>Stop Loss
                  <input type="number" id="posSL" value="2640" step="0.01">
                </label>
              </div>
              <div class="tools-result-box">
                <div class="tools-result-row">
                  <span class="tools-result-label">Risk Amount:</span>
                  <span class="tools-result-value red" id="posRiskAmt">--</span>
                </div>
                <div class="tools-result-row">
                  <span class="tools-result-label">SL Distance:</span>
                  <span class="tools-result-value" id="posSLDist">--</span>
                </div>
                <div class="tools-result-row">
                  <span class="tools-result-label">Position Size:</span>
                  <span class="tools-result-value green" id="posSizeResult">--</span>
                </div>
              </div>
            </div>
            
            <!-- FUNDING RATE CALC -->
            <div class="tools-dropdown-section">
              <div class="tools-section-title">FUNDING RATE (PERPS)</div>
              <div class="tools-grid-2">
                <label>Position ($)
                  <input type="number" id="fundPos" value="10000" step="100">
                </label>
                <label>Rate (%)
                  <input type="number" id="fundRate" value="0.01" step="0.001">
                </label>
                <label>Days
                  <input type="number" id="fundDays" value="30" step="1" min="1">
                </label>
                <label>Payments/Day
                  <select id="fundPayments">
                    <option value="3" selected>3x (Binance)</option>
                    <option value="1">1x (Daily)</option>
                    <option value="8">8x (Bybit)</option>
                  </select>
                </label>
              </div>
              <div class="tools-result-box">
                <div class="tools-result-row">
                  <span class="tools-result-label">Per Payment:</span>
                  <span class="tools-result-value" id="fundPerPayment">--</span>
                </div>
                <div class="tools-result-row">
                  <span class="tools-result-label">Daily Cost:</span>
                  <span class="tools-result-value orange" id="fundDaily">--</span>
                </div>
                <div class="tools-result-row">
                  <span class="tools-result-label">Total ({fundDays}d):</span>
                  <span class="tools-result-value red" id="fundTotal">--</span>
                </div>
                <div class="tools-result-row">
                  <span class="tools-result-label">APR:</span>
                  <span class="tools-result-value cyan" id="fundAPR">--</span>
                </div>
              </div>
            </div>
            
          </div>
        </div>
      </div>
      
      <!-- BUTTONS on the right -->
      <div style="margin-left: auto; display: flex; gap: 8px;">
        <button class="analytics-btn" id="analyticsBtn" title="Toggle Radar Panel (Bottom)">
          <span>RADAR</span>
        </button>
        <button class="analytics-btn" id="drawerBtn" title="Advanced Analytics (Side)">
          <span>ADVANCED</span>
        </button>
      </div>
    </div>

    <!-- BLOOMBERG NEWS TICKER (TOP) -->
    <div class="news-ticker-bar">
      <div class="news-ticker-content" id="newsTickerContent" aria-live="polite">
        <div class="news-ticker-item">
          <span class="news-ticker-label">LADOWANIE</span>
          <span class="news-ticker-text">Pobieram naglowki z API...</span>
          <span class="news-ticker-time">--</span>
        </div>
      </div>
    </div>

    <!-- TWITTER/X CRYPTO TICKER -->
    <div class="twitter-ticker-bar" style="background: linear-gradient(90deg, #0a0a0a 0%, #111111 50%, #0a0a0a 100%); border-top: 1px solid #1976d2; border-bottom: 1px solid #1976d2; padding: 8px 0; overflow: hidden; position: relative;">
      <div style="position: absolute; left: 0; top: 0; bottom: 0; width: 60px; background: linear-gradient(90deg, #0a0a0a 0%, transparent 100%); z-index: 2; display: flex; align-items: center; padding-left: 10px;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="#1DA1F2">
          <path d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"/>
        </svg>
      </div>
      <div id="twitterTickerContent" style="display: flex; animation: ticker-scroll 60s linear infinite; white-space: nowrap; padding-left: 70px;">
        <span class="twitter-ticker-item" style="display: inline-flex; align-items: center; gap: 8px; margin-right: 50px; color: var(--gray); font-size: 0.9em;">
          <span style="color: #1DA1F2; font-weight: 700;">@CryptoNews</span>
          <span>adowanie wiadomoci crypto...</span>
          <span style="color: #666;"></span>
        </span>
      </div>
      <div style="position: absolute; right: 0; top: 0; bottom: 0; width: 40px; background: linear-gradient(90deg, transparent 0%, #0a0a0a 100%); z-index: 2;"></div>
    </div>

    <!-- BURGUNDY MENU BAR -->
    <div class="menu-bar">
      <button class="menu-item" data-tab="dashboard">Dashboard</button>
      <button class="menu-item" data-tab="trend-analysis">Trend Analysis</button>
      <button class="menu-item" data-tab="kpi-correlation">KPI Correlation</button>
      <button class="menu-item" data-tab="multi-tf-analysis">IMEFRAME ZONE  MULTI-TF ANALYSIS</button>
      <button class="menu-item" data-tab="hamster-genius">Hamster Genius</button>
      
      <!-- GENIUS AI HAMBURGER (Mobile App Style) -->
      <button class="genius-hamburger-btn" id="geniusHamburger" style="margin-left: auto; display: inline-flex; align-items: center; gap: 10px; padding: 8px 16px; background: rgba(255, 140, 0, 0.1); border: 1px solid var(--orange); border-radius: 6px; color: var(--orange); font-weight: 700; font-size: 0.85em; cursor: pointer;">
        <div class="genius-hamburger-icon" style="display: grid; gap: 4px;">
          <span class="line1" style="width: 18px; height: 2px; background: var(--orange); display: block; border-radius: 2px; transition: all 0.3s ease;"></span>
          <span class="line2" style="width: 18px; height: 2px; background: var(--orange); display: block; border-radius: 2px; transition: all 0.3s ease;"></span>
          <span class="line3" style="width: 18px; height: 2px; background: var(--orange); display: block; border-radius: 2px; transition: all 0.3s ease;"></span>
        </div>
        <span>MENU</span>
      </button>
      
      <button class="menu-item" data-tab="onchain-flows">On-chain & Flows</button>
      <button class="menu-item" data-tab="risk-positioning">Risk & Positioning</button>
      <button class="menu-item" data-tab="execution-playbook">Execution Playbook</button>
      <button class="menu-item" data-tab="alerts-journal">Alerts & Journal</button>
    </div>

    <!-- GENIUS MENU OVERLAY -->
    <div class="genius-menu-overlay" id="geniusMenuOverlay"></div>

    <!-- GENIUS MENU PANEL - Mobile App Style -->
    <div class="genius-menu-panel" id="geniusMenuPanel">
      <div class="genius-menu-header">
        <button class="genius-menu-close" id="geniusMenuClose"></button>
        <div class="genius-menu-logo">GENIUS AI v6.0</div>
        <div class="genius-menu-subtitle">ENTERPRISE TRADING ENGINE</div>
      </div>
      <div class="genius-menu-grid">
        <div class="genius-menu-item" data-panel="alerts">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Smart Alerts</div>
            <div class="genius-menu-item-desc">Price & volume monitoring</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-item" data-panel="chat">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Genius Chat AI</div>
            <div class="genius-menu-item-desc">Voice & text assistant</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-item" data-panel="portfolio">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Portfolio</div>
            <div class="genius-menu-item-desc">Health & analysis</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-divider"></div>
        <div class="genius-menu-item" data-panel="quick-trade">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Quick Trade</div>
            <div class="genius-menu-item-desc">Fast execution</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-item" data-panel="technical">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Technical Analysis</div>
            <div class="genius-menu-item-desc">Indicators & patterns</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-item" data-panel="strategy">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Strategy Builder</div>
            <div class="genius-menu-item-desc">Create & backtest</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-divider"></div>
        <!-- NEW v6.0 MODULES -->
        <div class="genius-menu-item" data-panel="order-executor" style="border-left: 2px solid #00ff41;">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Order Executor</div>
            <div class="genius-menu-item-desc">Real trading Binance/Bybit</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-item" data-panel="portfolio-optimizer" style="border-left: 2px solid #00d4ff;">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Portfolio Optimizer</div>
            <div class="genius-menu-item-desc">Black-Litterman, Risk Parity</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-item" data-panel="risk-engine" style="border-left: 2px solid #ff0033;">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Risk Engine</div>
            <div class="genius-menu-item-desc">VaR, CVaR, Kelly Criterion</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-item" data-panel="multi-asset" style="border-left: 2px solid #ffff00;">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Multi-Asset Trading</div>
            <div class="genius-menu-item-desc">Crypto, Forex, Stocks, Commodities</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-item" data-panel="ai-models" style="border-left: 2px solid #ff8c00;">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">AI Models</div>
            <div class="genius-menu-item-desc">LSTM + Transformer + Sentiment</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-item" data-panel="options-greeks" style="border-left: 2px solid #9966ff;">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Options Greeks</div>
            <div class="genius-menu-item-desc">10 Greeks + IV Solver</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
        <div class="genius-menu-divider"></div>
        <div class="genius-menu-item" data-panel="settings">
          <div class="genius-menu-item-icon"></div>
          <div class="genius-menu-item-content">
            <div class="genius-menu-item-label">Settings</div>
            <div class="genius-menu-item-desc">Customize terminal</div>
          </div>
          <div class="genius-menu-item-arrow"></div>
        </div>
      </div>
      <div class="genius-menu-footer">
        <div class="genius-menu-footer-text">HAMSTER TERMINAL v6.0  ENTERPRISE</div>
        <div style="margin-top: 8px; display: flex; gap: 12px; justify-content: center; align-items: center; flex-wrap: wrap;">
          <a href="https://t.me/HamsterTerminalBot" target="_blank" style="color: #0088cc; text-decoration: none; font-size: 0.85em; display: flex; align-items: center; gap: 4px;">
            <span style="font-size: 1.1em;"></span> Telegram
          </a>
          <span style="color: #333;">|</span>
          <a href="https://discord.gg/hamsterterminal" target="_blank" style="color: #5865F2; text-decoration: none; font-size: 0.85em; display: flex; align-items: center; gap: 4px;">
            <span style="font-size: 1.1em;"></span> Discord
          </a>
          <span style="color: #333;">|</span>
          <a href="https://github.com/deadpoolsebix/hamsterterminal" target="_blank" style="color: #888; text-decoration: none; font-size: 0.85em; display: flex; align-items: center; gap: 4px;">
            <span style="font-size: 1.1em;"></span> GitHub
          </a>
        </div>
        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #222; font-size: 0.75em; color: #666;">
          16 Modules  12,394 Lines  TIER 1 Enterprise
        </div>
      </div>
    </div>

    <!-- ANALYTICS RADAR PANEL (BOTTOM EXPANDABLE) -->
    <div class="analytics-panel" id="analyticsPanel">
      <div style="background: rgba(255, 255, 0, 0.15); border: 1px solid var(--yellow); padding: 10px 24px; margin: 10px 24px 0 24px; color: var(--yellow); font-weight: 700; font-size: 0.9em; letter-spacing: 1px;">
         PO POSTU
      </div>
      <div class="radar-grid">
        <div class="radar-card">
          <div class="radar-title"> FVG RADAR</div>
          <div class="radar-data">
            <div>1H: <span class="radar-cool" data-update="fvg-1h">95.0k95.4k</span> (BUY)</div>
            <div>4H: <span class="radar-hot">97.3k97.6k</span> (SELL)</div>
            <div>D1: <span class="radar-cool">92.8k93.6k</span> (DEMAND)</div>
            <div style="margin-top: 6px; font-size: 0.8em; color: #999;">Live</div>
          </div>
        </div>

        <div class="radar-card">
          <div class="radar-title"> EQL / EQH LEVELS</div>
          <div class="radar-data">
            <div>EQL: <span class="radar-cool" data-update="eql">94,200</span> (Support)</div>
            <div>EQH: <span class="radar-hot" data-update="eqh">97,800</span> (Resistance)</div>
            <div>Range: $3,600</div>
            <div style="margin-top: 6px; font-size: 0.8em; color: #999;">Live</div>
          </div>
        </div>

        <div class="radar-card">
          <div class="radar-title"> PREMIUM / DISCOUNT</div>
          <div class="radar-data">
            <div>Spot vs Perps: <span class="radar-cool">+0.15%</span></div>
            <div>Spot vs Futures: <span class="radar-cool">+0.08%</span></div>
            <div>Funding: <span class="radar-neutral">+0.0082%</span></div>
            <div style="margin-top: 6px; font-size: 0.8em; color: #999;">Live</div>
          </div>
        </div>

        <div class="radar-card">
          <div class="radar-title"> INTERNAL / EXTERNAL</div>
          <div class="radar-data">
            <div>Internal Flow: <span class="radar-cool">+$180M</span></div>
            <div>External Flow: <span class="radar-cool">-$3.2k BTC</span></div>
            <div>Net Inflow: <span class="radar-cool">+$220M</span></div>
            <div style="margin-top: 6px; font-size: 0.8em; color: #999;">Live</div>
          </div>
        </div>

        <div class="radar-card" style="grid-column: span 2;">
          <div class="radar-title"> BLOCKCHAIN METRICS</div>
          <div class="radar-data">
            <div>Mempool: <span class="radar-hot">82% full</span> (Fees: 32 sat/vB)</div>
            <div>L2 Bridges: <span class="radar-cool">+$65M  Arbitrum</span></div>
            <div>Whale Outflow: <span class="radar-cool">-1.1k BTC</span> > cold storage (BULLISH)</div>
            <div>UTXO Age: <span class="radar-cool">Majority > 6mo</span> (Long-term holders)</div>
            <div style="margin-top: 6px; font-size: 0.8em; color: #999;">On-chain sentiment: BULLISH [+]</div>
          </div>
        </div>

        <div class="radar-card">
          <div class="radar-title"> LIQUIDATION CLUSTERS</div>
          <div class="radar-data">
            <div>Short Liq: <span class="radar-hot" data-update="liq-short">$18M</span> @ 97.4k</div>
            <div>Long Liq: <span class="radar-hot" data-update="liq-long">$42M</span> @ 94.8k</div>
            <div>Total 24h: <span class="radar-hot">$110M</span></div>
            <div style="margin-top: 6px; font-size: 0.8em; color: #999;">Live</div>
          </div>
        </div>

        <div class="radar-card">
          <div class="radar-title"> VOLATILITY INDEX</div>
          <div class="radar-data">
            <div>1H: <span class="radar-neutral">2.3%</span> (Normal)</div>
            <div>4H: <span class="radar-neutral">1.8%</span> (Calm)</div>
            <div>24H: <span class="radar-hot">3.2%</span> (Elevated)</div>
            <div style="margin-top: 6px; font-size: 0.8em; color: #999;">Live</div>
          </div>
        </div>

        <div class="radar-card">
          <div class="radar-title"> SIGNAL STRENGTH</div>
          <div class="radar-data">
            <div>Bullish: <span class="radar-cool" data-update="bullish">58%</span> (DOMINANT)</div>
            <div>Bearish: <span class="radar-hot" data-update="bearish">42%</span> (RESISTANCE)</div>
            <div>Stalemate: <span class="radar-neutral">SCALP ZONE</span></div>
            <div style="margin-top: 6px; font-size: 0.8em; color: #999;">Live</div>
          </div>
        </div>
      </div>
    </div>

    <!-- SIDE DRAWER - ADVANCED ANALYTICS OPTIONS -->
    <div class="analytics-drawer" id="analyticsDrawer">
      <div class="drawer-header">
        <h2> ADVANCED ANALYTICS</h2>
        <button class="close-drawer" id="closeDrawer"></button>
      </div>

      <div class="drawer-tabs">
        <button class="drawer-tab active" data-tab="heatmaps">HEATMAPS</button>
        <button class="drawer-tab" data-tab="flow">FLOW ANALYSIS</button>
        <button class="drawer-tab" data-tab="unusual">UNUSUAL</button>
      </div>

      <div class="drawer-content" id="heatmapsContent">
        <!-- CORRELATION HEATMAP -->
        <div class="heatmap-container">
          <div class="heatmap-title"> CORRELATION MATRIX</div>
          <div class="heatmap-grid">
            <div class="heatmap-cell heat-high-pos" title="BTCETH: 0.86">0.86</div>
            <div class="heatmap-cell heat-mid-pos" title="BTCAAPL: 0.42">0.42</div>
            <div class="heatmap-cell heat-neutral" title="BTCDXY: -0.48">-0.48</div>
            <div class="heatmap-cell heat-mid-neg" title="BTCVIX: -0.35">-0.35</div>
            <div class="heatmap-cell heat-high-pos" title="BTCNASDAQ: 0.62">0.62</div>
          </div>
          <div style="color: var(--gray); font-size: 0.8em;">Pearson correlation (24h)</div>
        </div>

        <!-- LIQUIDATION HEATMAP -->
        <div class="heatmap-container">
          <div class="heatmap-title"> LIQUIDATION ZONES (BY LEVEL)</div>
          <div class="heatmap-grid">
            <div class="heatmap-cell heat-high-neg" title="98.2k - EXTREME">DANGER</div>
            <div class="heatmap-cell heat-mid-neg" title="97.4k - HIGH">HIGH</div>
            <div class="heatmap-cell heat-neutral" title="96.0k - MID">MID</div>
            <div class="heatmap-cell heat-mid-pos" title="94.8k - MID">MID</div>
            <div class="heatmap-cell heat-high-pos" title="93.5k - SUPPORT">SAFE</div>
          </div>
          <div style="color: var(--gray); font-size: 0.8em;">Top liq zones (24h)</div>
        </div>

        <!-- VOLUME PROFILE -->
        <div class="heatmap-container">
          <div class="heatmap-title"> VOLUME PROFILE (POC)</div>
          <div class="heatmap-grid">
            <div class="heatmap-cell heat-mid-pos">5.2%</div>
            <div class="heatmap-cell heat-high-pos">8.7%</div>
            <div class="heatmap-cell heat-high-pos">9.1%</div>
            <div class="heatmap-cell heat-mid-pos">6.3%</div>
            <div class="heatmap-cell heat-neutral">4.1%</div>
          </div>
          <div style="color: var(--gray); font-size: 0.8em;">POC at $96,200</div>
        </div>

        <!-- MARKET MICROSTRUCTURE -->
        <div class="heatmap-container">
          <div class="heatmap-title"> MARKET MICROSTRUCTURE</div>
          <div class="heatmap-grid">
            <div class="heatmap-cell heat-high-pos">0.12</div>
            <div class="heatmap-cell heat-mid-pos">1.34</div>
            <div class="heatmap-cell heat-neutral">0.08%</div>
            <div class="heatmap-cell heat-mid-pos">STRONG</div>
            <div class="heatmap-cell heat-high-pos">POSITIVE</div>
          </div>
          <div style="color: var(--gray); font-size: 0.8em;">Bid/Ask  Imbalance  VWAP  Momentum  OrderFlow</div>
        </div>
      </div>

      <div class="drawer-content" id="flowContent" style="display: none;">
        <div class="option-row">
          <div class="option-label">WHALE ACCUMULATION</div>
          <div class="option-value" data-update="whale">+2.3k BTC</div>
        </div>

        <div class="option-row">
          <div class="option-label"> EXCHANGE INFLOWS</div>
          <div class="option-value" data-update="exchange">-$120M OUT</div>
        </div>

        <div class="option-row">
          <div class="option-label"> DARK POOL FLOW</div>
          <div class="option-value" data-update="dark-pool">$680M </div>
        </div>

        <div class="option-row">
          <div class="option-label"> ORDER FLOW IMBALANCE</div>
          <div class="option-value">+58% BUYERS</div>
        </div>

        <div class="option-row">
          <div class="option-label"> LONG/SHORT RATIO</div>
          <div class="option-value" data-update="long-short">1.18 BULL</div>
        </div>

        <div class="option-row">
          <div class="option-label"> OPEN INTEREST</div>
          <div class="option-value">$14.2B (+3.2%)</div>
        </div>

        <div class="option-row">
          <div class="option-label"> SKEW INDEX</div>
          <div class="option-value">-0.12 NEUTRAL</div>
        </div>

        <div class="option-row">
          <div class="option-label"> CASCADE RISK</div>
          <div class="option-value">MEDIUM (2.5%)</div>
        </div>
      </div>

      <div class="drawer-content" id="unusualContent" style="display: none;">
        <div class="unusual-item">
          <div class="unusual-header"> UNUSUAL OPTION FLOW</div>
          <div class="unusual-value">$120M BTC CALL SKEW</div>
          <div class="unusual-note">Expiry: 24-Jan | Sentiment: BULLISH</div>
        </div>

        <div class="unusual-item">
          <div class="unusual-header"> PERPETUAL FUNDING SPIKE</div>
          <div class="unusual-value">+0.025% (4HR HIGH)</div>
          <div class="unusual-note">Longs getting expensive</div>
        </div>

        <div class="unusual-item">
          <div class="unusual-header"> VOLUME SPIKE ZONES</div>
          <div class="unusual-value">95.8k & 97.2k</div>
          <div class="unusual-note">Breakout levels locked</div>
        </div>

        <div class="unusual-item">
          <div class="unusual-header"> WHALE ALERT ACTIVE</div>
          <div class="unusual-value">$50M TRANSFER  EXCHANGE</div>
          <div class="unusual-note">Possible liquidation prep</div>
        </div>

        <div class="unusual-item">
          <div class="unusual-header"> STALE CANDLE WATCH</div>
          <div class="unusual-value">LOW VOLATILITY BREWING</div>
          <div class="unusual-note">Accumulation zone forming</div>
        </div>

        <div class="unusual-item">
          <div class="unusual-header"> WAVE COUNT SETUP</div>
          <div class="unusual-value">POTENTIAL IMPULSE 5 INCOMING</div>
          <div class="unusual-note">Fibonacci targets: $98.2k</div>
        </div>
      </div>
    </div>

    <!-- CRYPTO TICKER -->
    <div class="ticker-wrapper">
      <div class="ticker">
        <div class="ticker-track" id="cryptoTickerTrack">
          <span class="ticker-label">CRYPTO</span>
          <span>BTC <span class="ticker-price">--</span></span>
          <span class="ticker-sep"></span>
          <span>ETH <span class="ticker-price">--</span></span>
          <span class="ticker-sep"></span>
          <span>Loading...</span>
        </div>
      </div>
    </div>

    <!-- STOCKS & INDICES TICKER -->
    <div class="ticker-wrapper">
      <div class="ticker">
        <div class="ticker-track" id="stocksTickerTrack">
          <span class="ticker-label">MARKETS</span>
          <span>NASDAQ <span class="ticker-price">--</span></span>
          <span class="ticker-sep"></span>
          <span>S&P 500 <span class="ticker-price">--</span></span>
          <span class="ticker-sep"></span>
          <span>Loading...</span>
        </div>
      </div>
    </div>

    <!-- SLIDE-DOWN PANELS FROM TOP (opens when menu item clicked) -->
    <div class="menu-panels" id="menuPanelsContainer">
      <div class="menu-panels-header">
        <div class="menu-panels-title" id="menuPanelsTitle"> PANEL</div>
        <button class="menu-panels-close" id="closeMenuPanels" title="Zamknij panel (ESC)"></button>
      </div>
    <div class="menu-panel" id="panel-dashboard">
      <div class="panel-grid">
        <div class="panel-card">
          <div class="panel-title">RADAR SNAJPERSKI  BTC</div>
          <div class="panel-text">Poziomy natychmiast: <strong style="color: var(--green);">95.0k95.4k BUY</strong> | <strong style="color: var(--red);">97.3k97.6k SELL</strong>. Invalidation: wybicie 97.8k.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">SZYBKIE SYGNAY</div>
          <div style="margin-bottom: 6px;">
            <span class="signal-tag">LONG bias</span>
            <span class="signal-tag">Scalp ON</span>
            <span class="signal-tag">R:R 1:2.5</span>
          </div>
          <div class="panel-text">Wejcie przy FVG $95.2k, TP $97.4k, SL $94.2k. Aktualizuj co 15m.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">MINI WYKRES  BTC</div>
          <div class="sparkline">
            <svg viewBox="0 0 200 80" preserveAspectRatio="xMidYMid meet">
              <polyline points="5,60 35,50 65,40 95,45 125,35 155,42 185,38" fill="none" stroke="var(--yellow)" stroke-width="2" />
              <circle cx="65" cy="40" r="4" fill="var(--green)" />
              <text x="55" y="28" font-size="8" fill="var(--green)">BUY</text>
              <circle cx="155" cy="42" r="4" fill="var(--red)" />
              <text x="145" y="30" font-size="8" fill="var(--red)">SELL</text>
            </svg>
          </div>
          <div class="mini-label">Overlay dla gwnego wykresu + sygnay live.</div>
        </div>
      </div>
    </div>

    <div class="menu-panel" id="panel-trend-analysis">
      <div class="panel-grid">
        <div class="panel-card">
          <div class="panel-title">SZYBKI TREND</div>
          <div class="panel-text">1H: konsolidacja; 4H: lekkie wybicie gra; 1D: byczy kana. Wybij 97.4k = przyspieszenie.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">CO SPRAWDZI</div>
          <div class="panel-text">Powtrz test EMA50, reakcj na FVG $95.2k, obron buy walli. Przyspieszenie wolumenu > +20% = wejcie.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">NASTPNE KROKI</div>
          <div class="panel-text">Ustaw alert na 97.4k i 94.8k. Jeli RSI 1H < 42 przy 95k  odpu longi, szukaj reentry przy 94.2k.</div>
        </div>
      </div>
    </div>

    <div class="menu-panel" id="panel-kpi-correlation">
      <div class="panel-grid">
        <div class="panel-card">
          <div class="panel-title">MAKRO CHECK</div>
          <div class="panel-text">DXY -0.48 korelacji: spadki dolara pomagaj longom BTC. VIX nisko  rynek ryzyka sprzyja.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">ETF/INFLOWS</div>
          <div class="panel-text">Napywy ETF +$220M  wspiera trend wzrostowy. Watch: jeli dzienny dopyw < +$50M, zdejmij dwigni.</div>
        </div>
        <div class="panel-card" style="grid-column: span 2;">
          <div class="panel-title"> CROSS-ASSET CORRELATION HEATMAP <span style="color: var(--cyan); font-size: 0.7em;">LIVE</span></div>
          <div id="crossAssetHeatmap" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px;">
            <!-- Header row -->
            <div style="color: var(--gray); font-weight: 700; text-align: center; padding: 8px;">ASSET</div>
            <div style="color: #ff9500; font-weight: 700; text-align: center; padding: 8px;">BTC</div>
            <div style="color: #4CAF50; font-weight: 700; text-align: center; padding: 8px;">SPX</div>
            <div style="color: #FFD700; font-weight: 700; text-align: center; padding: 8px;">GOLD</div>
            <!-- BTC row -->
            <div style="color: #ff9500; font-weight: 700; padding: 8px;">BTC</div>
            <div id="corr-btc-btc" style="background: rgba(0, 255, 65, 0.6); color: #fff; text-align: center; padding: 8px; border-radius: 4px; font-weight: 700;">1.00</div>
            <div id="corr-btc-spx" style="background: rgba(0, 255, 65, 0.3); color: #fff; text-align: center; padding: 8px; border-radius: 4px; font-weight: 700; transition: all 0.3s;">0.42</div>
            <div id="corr-btc-gold" style="background: rgba(255, 165, 0, 0.3); color: #fff; text-align: center; padding: 8px; border-radius: 4px; font-weight: 700; transition: all 0.3s;">0.28</div>
            <!-- SPX row -->
            <div style="color: #4CAF50; font-weight: 700; padding: 8px;">SPX</div>
            <div id="corr-spx-btc" style="background: rgba(0, 255, 65, 0.3); color: #fff; text-align: center; padding: 8px; border-radius: 4px; font-weight: 700; transition: all 0.3s;">0.42</div>
            <div id="corr-spx-spx" style="background: rgba(0, 255, 65, 0.6); color: #fff; text-align: center; padding: 8px; border-radius: 4px; font-weight: 700;">1.00</div>
            <div id="corr-spx-gold" style="background: rgba(255, 165, 0, 0.2); color: #fff; text-align: center; padding: 8px; border-radius: 4px; font-weight: 700; transition: all 0.3s;">0.15</div>
            <!-- GOLD row -->
            <div style="color: #FFD700; font-weight: 700; padding: 8px;">GOLD</div>
            <div id="corr-gold-btc" style="background: rgba(255, 165, 0, 0.3); color: #fff; text-align: center; padding: 8px; border-radius: 4px; font-weight: 700; transition: all 0.3s;">0.28</div>
            <div id="corr-gold-spx" style="background: rgba(255, 165, 0, 0.2); color: #fff; text-align: center; padding: 8px; border-radius: 4px; font-weight: 700; transition: all 0.3s;">0.15</div>
            <div id="corr-gold-gold" style="background: rgba(0, 255, 65, 0.6); color: #fff; text-align: center; padding: 8px; border-radius: 4px; font-weight: 700;">1.00</div>
          </div>
          <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
            <div style="font-size: 0.8em; color: var(--gray);">
              <span style="display: inline-block; width: 12px; height: 12px; background: rgba(0, 255, 65, 0.5); border-radius: 2px; margin-right: 4px;"></span>Pozytywna
              <span style="display: inline-block; width: 12px; height: 12px; background: rgba(255, 0, 51, 0.5); border-radius: 2px; margin-left: 12px; margin-right: 4px;"></span>Negatywna
              <span style="display: inline-block; width: 12px; height: 12px; background: rgba(255, 255, 0, 0.8); border-radius: 2px; margin-left: 12px; margin-right: 4px;"></span>Zmiana znaku!
            </div>
            <div id="corrLastUpdate" style="font-size: 0.75em; color: var(--gray);">Update: --</div>
          </div>
        </div>
      </div>
    </div>

    <div class="menu-panel" id="panel-multi-tf-analysis">
      <div class="panel-grid">
        <div class="panel-card">
          <div class="panel-title">SCALP PLAN</div>
          <div class="panel-text">1m/5m bull, 15m/30m neutral: graj mean-revert do EMA, target +0.35% per trade.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">SWING PLAN</div>
          <div class="panel-text">4h neutral, 1d bear  trzymaj poow pozycji hedge (short perps) przy 97.4k, zdejmij gdy 98k wybite.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">RADAR SNAJPERSKI BTC</div>
          <div class="panel-text">Alerty: 95.2k (buy), 94.2k (re-entry), 97.8k (short invalidation). Dodaj auto-lini na wykresie.</div>
        </div>
      </div>
    </div>

    <div class="menu-panel" id="panel-hamster-genius">
      <div class="panel-grid">
        <div class="panel-card" style="grid-column: span 2;">
          <div class="panel-title">LIVE GENIUS OVERLAY</div>
          <div class="panel-text panel-text-strong">Overlay na wykresie: "Buy wall trzyma 95.2k, brak poday na ask; przenie SL pod 95.1k". Update co 30s; plan push-notyfikacji na mobile.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">SYGNAY LIVE</div>
          <div class="panel-text"> BUY: 95.2k (potwierdzony FVG + wolumen)
            <br> SELL: 97.4k (liquidity sweep)
            <br> ALERT: funding > 0.012%  zmniejsz long.</div>
        </div>
        <div class="panel-card" style="grid-column: span 2;">
          <div class="panel-title">GENIUS QUANT PANEL <span style="color: var(--cyan); font-size: 0.7em;">REAL-TIME</span></div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div id="geniusQuantPanelInline" class="panel-text" style="color: #cce8ff; font-size: 0.9em; line-height: 1.5; background: rgba(0, 212, 255, 0.05); border: 1px solid rgba(0, 212, 255, 0.25); padding: 10px; border-radius: 4px;">
              Quant engine inicjalizuje oczekiwanie na odpowied API.
            </div>
            <div style="background: rgba(0, 212, 255, 0.03); border: 1px solid rgba(0, 212, 255, 0.15); padding: 10px; border-radius: 4px; font-size: 0.85em; line-height: 1.6; color: var(--gray);">
              <div style="color: var(--cyan); font-weight: 700; margin-bottom: 6px;"> OPIS PANELU</div>
              <div> <span style="color: #fff;">BIAS:</span> kierunek pozycji (LONG/SHORT/NEUTRAL)</div>
              <div> <span style="color: #fff;">CONFIDENCE:</span> sia sygnau (0-100%)</div>
              <div> <span style="color: #fff;">ENTRY/TP/SL:</span> rekomendowane poziomy</div>
              <div> <span style="color: #fff;">R:R:</span> stosunek zysku do ryzyka</div>
              <div style="margin-top: 8px; color: var(--orange); font-size: 0.8em;"> Update co 30s z Genius AI</div>
            </div>
          </div>
        </div>
        <div class="panel-card" style="grid-column: span 3; grid-row: span 2;">
          <div class="panel-title">HAMSTER GENIUS  WYKRES + KOMENTARZ</div>
          <div class="sparkline" style="height: 180px;">
            <svg viewBox="0 0 620 160" preserveAspectRatio="xMidYMid meet">
              <polyline points="30,125 150,90 250,70 330,78 420,55 510,68 590,52" fill="none" stroke="var(--yellow)" stroke-width="3" />
              <circle cx="250" cy="70" r="8" fill="var(--green)" />
              <text x="216" y="40" font-size="12" fill="var(--green)">LONG 95.2k</text>
              <circle cx="510" cy="68" r="8" fill="var(--red)" />
              <text x="474" y="48" font-size="12" fill="var(--red)">TAKE PROFIT 97.4k</text>
            </svg>
          </div>
          <div class="panel-text panel-text-xl">
            <div><span class="text-buy">LONG 95.2k</span></div>
            <div><span class="text-sell">TAKE PROFIT 97.4k</span></div>
            <div>Komentarz: momentum ronie po obronie buy walli. Ryzyko: wybicie 94.8k = stop.</div>
          </div>
          <div class="panel-text" id="geniusLiveBias" style="margin-top: 10px; color: var(--gray); font-size: 0.95em; line-height: 1.6;">
            adowanie danych live-bias...
          </div>
          <div class="panel-text" style="margin-top: 12px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center;">
            <label for="geniusAudioLang" style="color: var(--gray); font-size: 0.85em;">Audio jzyk:</label>
            <select id="geniusAudioLang" style="background: #0a0a0a; color: #ffffff; border: 1px solid var(--border); padding: 4px 8px;">
              <option value="pl">PL</option>
              <option value="en">EN</option>
              <option value="de">DE</option>
              <option value="sk">SK</option>
            </select>
            <button id="geniusAudioPlay" class="tools-btn" style="padding: 6px 12px;"> Odtwrz koment</button>
            <span id="geniusAudioStatus" style="color: var(--gray); font-size: 0.8em;">Gotowe</span>
          </div>
        </div>
        <div class="panel-card">
          <div class="panel-title">SNIPER SHOT  PLAY <span style="color: var(--green); font-size: 0.65em;"> LIVE</span></div>
          <div id="sniperShotContent" class="panel-text">
            <div id="sniperLevels"><strong>Poziomy natychmiast:</strong> <span class="text-buy">adowanie...</span></div>
            <div id="sniperSetup" style="margin-top: 6px;">Setup: Oczekiwanie na dane...</div>
            <div id="sniperTimer" style="margin-top: 6px; color: var(--gray); font-size: 0.85em;">Timer: --</div>
          </div>
        </div>
        <div class="panel-card">
          <div class="panel-title">NIETYPOWE TAKTYKI <span style="color: var(--orange); font-size: 0.65em;">AI</span></div>
          <div id="unusualTacticsContent" class="panel-text">
            <div id="tactic1">1) <span style="color: var(--cyan);">Fade sweep:</span> Oczekiwanie na killzone...</div>
            <div id="tactic2">2) <span style="color: var(--cyan);">Ladder TP:</span> Obliczanie poziomw...</div>
            <div id="tactic3">3) <span style="color: var(--cyan);">Funding hedge:</span> Monitoring...</div>
          </div>
        </div>
      </div>
    </div>

    <div class="menu-panel" id="panel-onchain-flows">
      <div class="panel-grid">
        <div class="panel-card">
          <div class="panel-title">STABLECOIN FLOWS</div>
          <div class="panel-text">Net inflow +$180M (24h). Zastrzyk pynnoci wspiera popyt spot.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">ETF SPOT BTC</div>
          <div class="panel-text">Napyw dzienny +$220M, 5d rednia +$140M. Jeli < +$50M  ostroniej z long.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">EXCHANGE FLOWS</div>
          <div class="panel-text">Net outflow -3.2k BTC (24h)  presja spadku poday na spot.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">DUE LIKWIDACJE</div>
          <div class="mini-sparkline">
            <svg viewBox="0 0 220 60">
              <polyline points="5,50 45,28 85,36 125,24 165,30 205,18" fill="none" stroke="var(--red)" stroke-width="2" />
              <circle cx="45" cy="28" r="4" fill="var(--red)" />
              <circle cx="165" cy="30" r="4" fill="var(--red)" />
            </svg>
          </div>
          <div class="panel-text">1h: $18M short liq @97.4k; 4h: $42M long liq @94.8k; 24h: $110M gwnie perps. Graj pod czyszczenie shortw.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">FVG / IMBALANCE MAP</div>
          <div class="panel-text">1H: FVG 95.0k95.4k (long refill); 4H: 97.3k97.6k (short fade); D1: 92.8k93.6k (demand). Dodaj alert na ponowne dotknicie.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">BLOCKCHAIN HEAT</div>
          <div class="panel-text">Mempool: 82% full; Fees: 32 sat/vB (wysokie); L2 mosty: +$65M  Arbitrum; Whale outflow: -1.1k BTC z Binance  cold storage.</div>
        </div>
      </div>
    </div>

    <div class="menu-panel" id="panel-risk-positioning">
      <div class="panel-grid">
        <div class="panel-card">
          <div class="panel-title">FUNDING / SKEW</div>
          <div class="panel-text">Funding +0.008%: zdrowe. Skew lekko dodatni  lekka przewaga longw.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">OI / DWIGNIA</div>
          <div class="panel-text">Open Interest $12.4B, wzrost +3% d/d. Brak przegrzania, ale led przy wybiciu 97.4k.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">LIQUIDATION MAP</div>
          <div class="panel-text">Clustery: 97.4k (short liq), 94.8k (long liq). Graj w kierunku czyszczenia shortw.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">POZYCJE / RYZYKO</div>
          <div class="panel-text">Wskanik long/short: 1.28; Delta perps vs spot: +0.9%; Heat: funding + OI + skew w zielonym  mona utrzyma longi, ale hedgowa 25% przy spike funding.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">KILLZONE + SESJE</div>
          <div class="panel-text">LON 8:00-11:00: szukaj sweepu low; NY 14:30-16:30: kontynuacja; Asia: mean reversion. Dostosuj SL pod zmienno sesyjn.</div>
        </div>
      </div>
    </div>

    <div class="menu-panel" id="panel-execution-playbook">
      <div class="panel-grid">
        <div class="panel-card">
          <div class="panel-title">SCALP PLAN</div>
          <div class="panel-text">Wejcie: 95.2k FVG. TP: 97.4k. SL: 94.2k. Wielko: 0.35x equity.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">INTRADAY PLAN</div>
          <div class="panel-text">Kup retrace do 95.896.2k jeli RSI 1H>45. TP1 97.4k, TP2 99k. Trailing pod EMA20 1H.</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">SWING PLAN</div>
          <div class="panel-text">Po wybiciu 98k hold do 105k, hedge 25% na perps przy spadku poniej 96k.</div>
        </div>
      </div>
    </div>

    <div class="menu-panel" id="panel-alerts-journal">
      <div class="panel-grid">
        <div class="panel-card">
          <div class="panel-title">ALERTY</div>
          <div class="panel-text"> Alert: 97.4k SELL sweep
            <br> Alert: Funding > 0.012%
            <br> Alert: Net inflow ETF < +$50M</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">CHECKLIST</div>
          <div class="panel-text">[ ] Trend 1H zgodny z 4H
            <br>[ ] Funding OK
            <br>[ ] Poziomy: 95.2k/97.4k ustawione
            <br>[ ] Wielko pozycji  plan</div>
        </div>
        <div class="panel-card">
          <div class="panel-title">NOTATKI</div>
          <div class="panel-text">Dodaj krtkie wnioski po trade: co zagrao, co poprawi.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION HEADER WITH SENTIMENT & STATS -->
  <div class="section-header-wrapper">
    <div class="section-header">
      <div class="psych-title">STAN PSYCHOLOGICZNY  BULLS vs BEARS</div>
      <div class="psych-grid">
        <div class="psych-card" id="bullsCard">
          <div class="psych-head">BULLS <span class="psych-percent" id="bullsPercent">(58%)</span></div>
          <ul class="psych-list" id="bullsList">
            <li id="bullsMood">Nastrj: Optymistyczny</li>
            <li id="bullsTarget">Target: $98,500$99,200</li>
            <li id="bullsAction">Akcja: Akumulacja + hold</li>
            <li id="bullsFear">Fear: Manipulation at $96,850</li>
            <li id="bullsExpect">Oczekiwanie: Break & Rally</li>
          </ul>
        </div>
        <div class="psych-card" id="bearsCard">
          <div class="psych-head">BEARS <span class="psych-percent" id="bearsPercent">(42%)</span></div>
          <ul class="psych-list" id="bearsList">
            <li id="bearsMood">Nastrj: Ostrony</li>
            <li id="bearsTarget">Target: $93,500$94,800</li>
            <li id="bearsAction">Akcja: Shorty + wait</li>
            <li id="bearsFear">Fear: Squeeze shorts</li>
            <li id="bearsExpect">Oczekiwanie: Pullback soon</li>
          </ul>
        </div>
      </div>
      <div class="psych-note" id="marketReality">MARKET REALITY: Dominacja BULLS, BEARS kontroluj support. Stalemate = SCALP OPPORTUNITY!  Data: <span id="current-date">2026-01-19</span></div>
    </div>

    <div class="section-sentiment">
      <h3>SENTYMENT & STATS</h3>
      <div class="sentiment-stat">
        <span>Fear & Greed</span>
        <span id="sentimentFearGreed">62 (Greed)</span>
      </div>
      <div class="sentiment-stat">
        <span>Funding Rate</span>
        <span id="sentimentFunding">+0.0082%</span>
      </div>
      <div class="sentiment-stat">
        <span>Open Interest</span>
        <span id="sentimentOI">$12.4B</span>
      </div>
      <div class="sentiment-stat">
        <span>Dominacja BTC</span>
        <span id="sentimentDominance">51.3%</span>
      </div>
      <div class="sentiment-stat">
        <span>Liquidations 24h</span>
        <span id="sentimentLiq">$84M</span>
      </div>
      <div class="sentiment-stat" style="border-top: 1px solid #333; padding-top: 8px; margin-top: 4px;">
        <span>24H Volume</span>
        <span id="sentimentVolume" style="color: var(--cyan);">$24.5B</span>
      </div>
      <div class="sentiment-stat">
        <span>Market Cap</span>
        <span id="sentimentMarketCap" style="color: var(--green);">$1.86T</span>
      </div>
    </div>
  </div>

  <!-- MARKET STATUS & MOVERS PANEL (above price) -->
  <div style="padding: 14px 24px 0 24px;">
    <div style="background: #000; border: 1px solid #222; padding: 16px;">
      <!-- Market State -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #222;">
        <div style="color: #888; font-weight: 700; font-size: 0.85em; letter-spacing: 1px;">MARKET STATUS</div>
        <div id="marketStateDisplay" style="display: flex; gap: 16px; font-size: 0.85em;">
          <span style="color: #666;">NYSE: <span id="nyseStatus" style="color: #888;">--</span></span>
          <span style="color: #666;">NASDAQ: <span id="nasdaqStatus" style="color: #888;">--</span></span>
          <span style="color: #666;">CRYPTO: <span style="color: #fff;">24/7</span></span>
        </div>
      </div>
      
      <!-- Top Movers Grid -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
        <!-- Crypto Gainers -->
        <div>
          <div style="color: #666; font-weight: 700; font-size: 0.75em; letter-spacing: 1px; margin-bottom: 10px;">TOP CRYPTO GAINERS</div>
          <div id="cryptoGainersList" style="font-size: 0.85em;">
            <div style="display: flex; justify-content: space-between; padding: 4px 0; color: #888;">Loading...</div>
          </div>
        </div>
        
        <!-- Crypto Losers -->
        <div>
          <div style="color: #666; font-weight: 700; font-size: 0.75em; letter-spacing: 1px; margin-bottom: 10px;">TOP CRYPTO LOSERS</div>
          <div id="cryptoLosersList" style="font-size: 0.85em;">
            <div style="display: flex; justify-content: space-between; padding: 4px 0; color: #888;">Loading...</div>
          </div>
        </div>
      </div>
      
      <!-- Technical Indicators -->
      <div style="margin-top: 16px; padding-top: 12px; border-top: 1px solid #222;">
        <div style="color: #666; font-weight: 700; font-size: 0.75em; letter-spacing: 1px; margin-bottom: 10px;">BTC TECHNICAL INDICATORS</div>
        <div id="technicalIndicatorsDisplay" style="display: flex; gap: 20px; font-size: 0.85em; flex-wrap: wrap;">
          <span style="color: #666;">RSI(14): <span id="btcRSI" style="color: #fff;">--</span></span>
          <span style="color: #666;">MACD: <span id="btcMACD" style="color: #fff;">--</span></span>
          <span style="color: #666;">EMA21: <span id="btcEMA21" style="color: #fff;">--</span></span>
          <span style="color: #666;">BB Upper: <span id="btcBBUpper" style="color: #fff;">--</span></span>
          <span style="color: #666;">BB Lower: <span id="btcBBLower" style="color: #fff;">--</span></span>
        </div>
      </div>
    </div>
  </div>

  <!-- GENIUS AI LIVE SIGNAL PANEL -->
  <div style="padding: 0 24px;">
    <div style="background: #000; border: 1px solid #222; padding: 16px;">
      <!-- Header -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #222;">
        <div style="color: #888; font-weight: 700; font-size: 0.85em; letter-spacing: 1px;">GENIUS AI SIGNAL</div>
        <div style="display: flex; align-items: center; gap: 12px;">
          <span id="geniusSignalType" style="color: #fff; font-weight: 700; font-size: 1.1em; letter-spacing: 1px;">--</span>
          <span style="color: #666; font-size: 0.75em;">Confidence: <span id="geniusConfidenceValue" style="color: #fff;">--%</span></span>
        </div>
      </div>
      
      <!-- Signal Details Grid -->
      <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 16px;">
        <div style="border-left: 2px solid #333; padding-left: 12px;">
          <div style="color: #666; font-size: 0.7em; letter-spacing: 1px; margin-bottom: 4px;">ENTRY ZONE</div>
          <div id="geniusEntryZone" style="color: #fff; font-size: 0.95em; font-weight: 600;">--</div>
        </div>
        <div style="border-left: 2px solid #333; padding-left: 12px;">
          <div style="color: #666; font-size: 0.7em; letter-spacing: 1px; margin-bottom: 4px;">STOP LOSS</div>
          <div id="geniusStopLoss" style="color: #fff; font-size: 0.95em; font-weight: 600;">--</div>
        </div>
        <div style="border-left: 2px solid #333; padding-left: 12px;">
          <div style="color: #666; font-size: 0.7em; letter-spacing: 1px; margin-bottom: 4px;">TAKE PROFIT</div>
          <div id="geniusTakeProfit" style="color: #fff; font-size: 0.95em; font-weight: 600;">--</div>
        </div>
        <div style="border-left: 2px solid #333; padding-left: 12px;">
          <div style="color: #666; font-size: 0.7em; letter-spacing: 1px; margin-bottom: 4px;">RISK:REWARD</div>
          <div id="geniusRiskReward" style="color: #fff; font-size: 0.95em; font-weight: 600;">--</div>
        </div>
      </div>
      
      <!-- Reasoning Section -->
      <div style="margin-bottom: 16px; padding: 12px; background: #0a0a0a; border-left: 2px solid #444;">
        <div style="color: #666; font-size: 0.7em; letter-spacing: 1px; margin-bottom: 8px;">ANALYSIS REASONING</div>
        <div id="geniusReasoning" style="color: #999; font-size: 0.85em; line-height: 1.6;">
          Loading analysis...
        </div>
      </div>
      
      <!-- Tactics Section -->
      <div style="padding: 12px; background: #0a0a0a; border-left: 2px solid #444;">
        <div style="color: #666; font-size: 0.7em; letter-spacing: 1px; margin-bottom: 8px;">TRADING TACTICS</div>
        <div id="geniusTactics" style="color: #ccc; font-size: 0.85em; line-height: 1.6;">
          Loading tactics...
        </div>
      </div>
      
      <!-- Footer -->
      <div style="margin-top: 12px; display: flex; justify-content: space-between; font-size: 0.7em; color: #555;">
        <span>Source: Genius Trading Engine v3.0 RIGOROUS</span>
        <span>Updated: <span id="geniusUpdateTime">--</span></span>
      </div>
    </div>
  </div>

  <!-- CURRENT PRICE + GENIUS COMMENTARY -->
  <div style="display: grid; grid-template-columns: 280px 1fr; gap: 14px; padding: 14px 24px;">
    <!-- CURRENT PRICE BOX -->
    <div class="metric-box" style="display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px;">
      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
        <div class="metric-label" style="font-size: 0.85em;">CURRENT PRICE</div>
        <div class="ws-status" id="wsStatus">
          <div class="ws-dot" id="wsDot"></div>
          <span id="wsLabel">OFFLINE</span>
        </div>
      </div>
      <div class="metric-value" id="metricPrice" style="font-size: 2.2em;">$--</div>
      <div class="metric-change" id="metricPriceChange" style="font-size: 1.1em; margin-top: 6px;"> --</div>
    </div>

    <!-- GENIUS COMMENTARY -->
    <div style="background: var(--panel); border: 1px solid var(--border); padding: 15px;">
      <div style="color: #888; font-weight: 700; margin-bottom: 10px; font-size: 0.8em; letter-spacing: 0.5px; text-transform: uppercase;">GENIUS COMMENTARY</div>
      <div id="geniusCommentaryText" style="color: #ccc; font-size: 0.9em; line-height: 1.6; min-height: 60px;">
        Analyzing market conditions...
      </div>
      <div style="margin-top: 10px; color: #555; font-size: 0.7em;">
        <span>Signal: <span id="geniusSignalBadge" style="color: #888;">--</span></span>
        <span style="margin-left: 12px;">Confidence: <span id="geniusConfidence" style="color: #888;">--</span></span>
      </div>
    </div>
  </div>

  <!-- LIVE ANALYSIS PANEL -->
  <div style="padding: 0 24px 14px 24px;">
    <div style="background: var(--panel); border: 1px solid var(--border); padding: 15px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; border-bottom: 1px solid #222; padding-bottom: 8px;">
        <div style="color: #888; font-weight: 700; font-size: 0.8em; letter-spacing: 0.5px; text-transform: uppercase;">LIVE ANALYSIS</div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <select id="voiceSelect" style="background: #0a0a0a; color: #888; border: 1px solid #333; padding: 3px 6px; font-size: 0.7em; cursor: pointer;">
            <option value="pl-PL">PL</option>
            <option value="en-US">EN</option>
            <option value="de-DE">DE</option>
          </select>
          <button id="playCommentaryBtn" style="background: #1a1a1a; border: 1px solid #333; color: #888; padding: 3px 10px; font-size: 0.7em; cursor: pointer;">
            PLAY
          </button>
          <span id="audioStatus" style="color: #555; font-size: 0.7em;">Ready</span>
        </div>
      </div>

      <!-- ANALYSIS GRID -->
      <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 14px;">
        <div style="padding: 10px 0; border-right: 1px solid #222;">
          <div style="color: #888; font-size: 0.7em; margin-bottom: 4px; text-transform: uppercase;">SIGNAL</div>
          <div id="analysisSignal" style="color: #fff; font-size: 0.85em; font-weight: 600;">BUY</div>
          <div id="analysisSignalNote" style="color: #666; font-size: 0.7em; margin-top: 4px;">RSI bounce from 48</div>
        </div>
        <div style="padding: 10px 0; border-right: 1px solid #222;">
          <div style="color: #888; font-size: 0.7em; margin-bottom: 4px; text-transform: uppercase;">LIQUIDITY</div>
          <div id="analysisLiquidity" style="color: #fff; font-size: 0.85em; font-weight: 600;">$94.8K</div>
          <div id="analysisLiquidityNote" style="color: #666; font-size: 0.7em; margin-top: 4px;">Buy wall detected</div>
        </div>
        <div style="padding: 10px 0; border-right: 1px solid #222;">
          <div style="color: #888; font-size: 0.7em; margin-bottom: 4px; text-transform: uppercase;">FVG ZONE</div>
          <div id="analysisFVG" style="color: #fff; font-size: 0.85em; font-weight: 600;">$95.2K</div>
          <div id="analysisFVGNote" style="color: #666; font-size: 0.7em; margin-top: 4px;">Retest expected</div>
        </div>
        <div style="padding: 10px 0;">
          <div style="color: #888; font-size: 0.7em; margin-bottom: 4px; text-transform: uppercase;">RESISTANCE</div>
          <div id="analysisResistance" style="color: #fff; font-size: 0.85em; font-weight: 600;">$97.4K</div>
          <div id="analysisResistanceNote" style="color: #666; font-size: 0.7em; margin-top: 4px;">Watch for rejection</div>
        </div>
      </div>

      <!-- LIVE TYPEWRITER COMMENTARY -->
      <div style="background: #0a0a0a; border-left: 2px solid #ff6b00; padding: 12px;">
        <div id="liveCommentaryText" style="color: #ccc; font-size: 0.85em; line-height: 1.5; min-height: 40px; font-family: 'Courier New', monospace;">
          <span id="typewriterText"></span><span id="typewriterCursor" style="animation: blink 1s infinite;">|</span>
        </div>
      </div>
      
      <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
        <span style="color: #555; font-size: 0.7em;">Update: <span id="commentaryLastUpdate">--</span></span>
        <span style="color: #666; font-size: 0.7em;">Confidence: <span style="color: #888;">87%</span></span>
      </div>
    </div>
  </div>

  <!-- BREAKING NEWS -->
  <div style="padding: 0 24px 14px 24px;">
    <div class="breaking-news" style="background: var(--panel); border: 1px solid var(--border); padding: 12px;">
      <h4 style="color: #888; font-weight: 700; margin-bottom: 10px; font-size: 0.8em; letter-spacing: 0.5px; text-transform: uppercase;">BREAKING NEWS</h4>
      <div id="breakingNewsList">
        <div class="breaking-item">
          <div class="breaking-status breaking-red">LOADING</div>
          <div class="breaking-category">...</div>
          <div>
            <div class="breaking-headline">Pobieranie nagwkw...</div>
            <div class="breaking-source">API</div>
          </div>
          <div class="breaking-time">--</div>
        </div>
      </div>
    </div>
  </div>
          <div class="breaking-time">--</div>
        </div>
      </div>
    </div>
  </div>

  <!-- CRYPTOPANIC TICKER -->
  <div class="cryptopanic-ticker" style="background: linear-gradient(90deg, #0a0a0a 0%, #111 50%, #0a0a0a 100%); border-top: 1px solid #ff6b00; border-bottom: 1px solid #ff6b00; padding: 6px 0; overflow: hidden; position: relative;">
    <div style="position: absolute; left: 0; top: 0; bottom: 0; width: 80px; background: linear-gradient(90deg, #0a0a0a 0%, transparent 100%); z-index: 2; display: flex; align-items: center; padding-left: 10px;">
      <span style="color: #ff6b00; font-weight: 700; font-size: 0.8em;"> CRYPTO</span>
    </div>
    <div id="cryptoPanicTicker" style="display: flex; animation: ticker-scroll 80s linear infinite; white-space: nowrap; padding-left: 90px;">
      <span style="color: var(--gray); margin-right: 40px;">adowanie wiadomoci crypto...</span>
    </div>
    <div style="position: absolute; right: 0; top: 0; bottom: 0; width: 40px; background: linear-gradient(90deg, transparent 0%, #0a0a0a 100%); z-index: 2;"></div>
  </div>

  <!-- CHART + TRANSFERS -->
  <div style="padding: 14px 24px;">
    <div>
      <!-- TIMEFRAME SELECTOR -->
      <div class="timeframe-selector">
        <button class="timeframe-btn" data-timeframe="1m">1m</button>
        <button class="timeframe-btn" data-timeframe="5m">5m</button>
        <button class="timeframe-btn" data-timeframe="15m">15m</button>
        <button class="timeframe-btn" data-timeframe="1h">1H</button>
        <button class="timeframe-btn" data-timeframe="4h">4H</button>
        <button class="timeframe-btn active" data-timeframe="1d">1D</button>
        <button class="timeframe-btn" data-timeframe="1w">1W</button>
      </div>
      <div class="chart-box">
      <svg class="chart-svg" id="mainChart" viewBox="0 0 1200 340" preserveAspectRatio="xMidYMid meet">
        <!-- CLEAN TERMINAL STYLE CHART -->
        <rect x="0" y="0" width="1200" height="340" fill="#000"/>
        
        <!-- MINIMAL GRID -->
        <g class="chart-grid" opacity="0.3">
          <line x1="60" y1="50" x2="1140" y2="50" stroke="#222"/>
          <line x1="60" y1="100" x2="1140" y2="100" stroke="#222"/>
          <line x1="60" y1="150" x2="1140" y2="150" stroke="#222"/>
          <line x1="60" y1="200" x2="1140" y2="200" stroke="#222"/>
          <line x1="60" y1="250" x2="1140" y2="250" stroke="#222"/>
          <line x1="60" y1="295" x2="1140" y2="295" stroke="#333"/>
        </g>

        <!-- PRICE AXIS (LEFT) -->
        <text id="axisLabelHigh" x="8" y="55" fill="#888" font-size="11" font-family="Consolas, Monaco, monospace">$98.0k</text>
        <text x="8" y="105" fill="#888" font-size="11" font-family="Consolas, Monaco, monospace">$97.0k</text>
        <text x="8" y="155" fill="#888" font-size="11" font-family="Consolas, Monaco, monospace">$96.0k</text>
        <text x="8" y="205" fill="#888" font-size="11" font-family="Consolas, Monaco, monospace">$95.0k</text>
        <text id="axisLabelLow" x="8" y="255" fill="#888" font-size="11" font-family="Consolas, Monaco, monospace">$94.0k</text>

        <!-- TIME AXIS (BOTTOM) -->
        <text x="100" y="315" fill="#666" font-size="10" font-family="Consolas, Monaco, monospace">-24h</text>
        <text x="260" y="315" fill="#666" font-size="10" font-family="Consolas, Monaco, monospace">-18h</text>
        <text x="420" y="315" fill="#666" font-size="10" font-family="Consolas, Monaco, monospace">-12h</text>
        <text x="580" y="315" fill="#666" font-size="10" font-family="Consolas, Monaco, monospace">-6h</text>
        <text x="740" y="315" fill="#666" font-size="10" font-family="Consolas, Monaco, monospace">-3h</text>
        <text x="900" y="315" fill="#666" font-size="10" font-family="Consolas, Monaco, monospace">-1h</text>
        <text x="1100" y="315" fill="#fff" font-size="10" font-weight="600" font-family="Consolas, Monaco, monospace">NOW</text>

        <!-- SUPPORT/RESISTANCE LINES -->
        <line id="resistanceLine" x1="60" y1="65" x2="1140" y2="65" stroke="#ff4444" stroke-width="1.5" stroke-dasharray="8,4" opacity="0.8"/>
        <line id="supportLine" x1="60" y1="235" x2="1140" y2="235" stroke="#00ff88" stroke-width="1.5" stroke-dasharray="8,4" opacity="0.8"/>
        
        <!-- RESISTANCE/SUPPORT LABELS -->
        <rect x="1145" y="56" width="50" height="18" fill="#1a0000" stroke="#ff4444" stroke-width="1" rx="2"/>
        <text id="resistanceLabel" x="1170" y="69" fill="#ff4444" font-size="10" font-weight="600" font-family="Consolas, Monaco, monospace" text-anchor="middle">R $97.5k</text>
        <rect x="1145" y="226" width="50" height="18" fill="#001a00" stroke="#00ff88" stroke-width="1" rx="2"/>
        <text id="supportLabel" x="1170" y="239" fill="#00ff88" font-size="10" font-weight="600" font-family="Consolas, Monaco, monospace" text-anchor="middle">S $94.5k</text>

        <!-- EMA 50 LINE -->
        <polyline id="emaLine50" points="80,210 180,200 280,185 380,190 480,175 580,160 680,165 780,155 880,160 980,155 1080,150" 
                  stroke="#555" stroke-width="1" fill="none" opacity="0.8"/>

        <!-- EMA 20 LINE -->
        <polyline id="emaLine20" points="80,195 180,180 280,160 380,170 480,150 580,135 680,145 780,130 880,140 980,135 1080,125" 
                  stroke="#888" stroke-width="1" fill="none" opacity="0.8"/>

        <!-- MAIN PRICE LINE -->
        <polyline id="priceLine" points="80,185 180,165 280,140 380,155 480,130 580,110 680,125 780,105 880,120 980,115 1080,100" 
                  stroke="#fff" stroke-width="2" fill="none"/>

        <!-- PRICE AREA FILL -->
        <polygon id="priceArea" points="80,185 180,165 280,140 380,155 480,130 580,110 680,125 780,105 880,120 980,115 1080,100 1080,295 80,295" 
                 fill="url(#priceGradient)" opacity="0.1"/>
        
        <defs>
          <linearGradient id="priceGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#fff;stop-opacity:0.3"/>
            <stop offset="100%" style="stop-color:#fff;stop-opacity:0"/>
          </linearGradient>
        </defs>

        <!-- BUY SIGNAL - GREEN ARROW -->
        <g id="buySignalGroup">
          <!-- Arrow pointing up -->
          <polygon id="buySignalArrow" points="380,175 370,195 375,195 375,210 385,210 385,195 390,195" fill="#00ff88" stroke="#00cc66" stroke-width="1"/>
          <rect x="358" y="212" width="44" height="18" fill="#001a00" stroke="#00ff88" stroke-width="1" rx="3"/>
          <text id="buySignalText" x="380" y="225" fill="#00ff88" text-anchor="middle" font-size="11" font-weight="700" font-family="Consolas, Monaco, monospace">BUY</text>
        </g>

        <!-- SELL SIGNAL - RED ARROW -->
        <g id="sellSignalGroup">
          <!-- Arrow pointing down -->
          <polygon id="sellSignalArrow" points="880,95 870,75 875,75 875,60 885,60 885,75 890,75" fill="#ff4444" stroke="#cc3333" stroke-width="1"/>
          <rect x="858" y="40" width="44" height="18" fill="#1a0000" stroke="#ff4444" stroke-width="1" rx="3"/>
          <text id="sellSignalText" x="880" y="53" fill="#ff4444" text-anchor="middle" font-size="11" font-weight="700" font-family="Consolas, Monaco, monospace">SELL</text>
        </g>

        <!-- CURRENT PRICE TAG -->
        <g id="currentPriceGroup">
          <line x1="1080" y1="100" x2="1120" y2="100" stroke="#fff" stroke-width="1"/>
          <rect x="1120" y="91" width="55" height="18" fill="#333" stroke="#fff" stroke-width="1" rx="0"/>
          <text id="currentPriceLabel" x="1147" y="104" fill="#fff" text-anchor="middle" font-size="11" font-weight="600" font-family="Consolas, Monaco, monospace">$96.4k</text>
        </g>

        <!-- LEGEND (TOP RIGHT) -->
        <g transform="translate(980, 20)">
          <line x1="0" y1="0" x2="20" y2="0" stroke="#fff" stroke-width="2"/>
          <text x="25" y="4" fill="#888" font-size="9" font-family="Consolas, Monaco, monospace">PRICE</text>
          <line x1="70" y1="0" x2="90" y2="0" stroke="#888" stroke-width="1"/>
          <text x="95" y="4" fill="#666" font-size="9" font-family="Consolas, Monaco, monospace">EMA20</text>
          <line x1="140" y1="0" x2="160" y2="0" stroke="#555" stroke-width="1"/>
          <text x="165" y="4" fill="#666" font-size="9" font-family="Consolas, Monaco, monospace">EMA50</text>
        </g>
      </svg>
    </div>

    <!-- RSI INDICATOR - ENLARGED -->
    <div style="background: #000000; border: 1px solid #1a1a1a; border-top: none; padding: 16px; height: 160px; margin-top: -10px;">
      <svg class="chart-svg" viewBox="0 0 1200 140" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%;">
        <!-- RSI ZONES BACKGROUND -->
        <!-- OVERBOUGHT ZONE (70-100) - Subtle red -->
        <rect x="60" y="0" width="1080" height="42" fill="#ff0000" opacity="0.05"/>
        <!-- OVERSOLD ZONE (0-30) - Subtle green -->
        <rect x="60" y="98" width="1080" height="42" fill="#00ff00" opacity="0.05"/>
        
        <!-- RSI LEVEL LINES -->
        <line x1="60" y1="0" x2="1140" y2="0" stroke="#333333" stroke-width="1"/>
        <line x1="60" y1="42" x2="1140" y2="42" stroke="#ff4444" stroke-width="1" stroke-dasharray="6,4"/>
        <text x="65" y="38" fill="#ff4444" font-size="11" font-weight="600">OVERBOUGHT (70) - SELL ZONE</text>
        
        <line x1="60" y1="98" x2="1140" y2="98" stroke="#00ff88" stroke-width="1" stroke-dasharray="6,4"/>
        <text x="65" y="115" fill="#00ff88" font-size="11" font-weight="600">OVERSOLD (30) - BUY ZONE</text>
        
        <line x1="60" y1="140" x2="1140" y2="140" stroke="#333333" stroke-width="1"/>

        <!-- RSI MIDLINE (50) -->
        <line x1="60" y1="70" x2="1140" y2="70" stroke="#333333" stroke-width="1" stroke-dasharray="3,3"/>
        <text x="1145" y="73" fill="#555555" font-size="10">50</text>

        <!-- Y-AXIS LABELS -->
        <text x="20" y="8" fill="#666666" font-size="11" font-weight="600">100</text>
        <text x="25" y="45" fill="#ff4444" font-size="10">70</text>
        <text x="25" y="73" fill="#555555" font-size="10">50</text>
        <text x="25" y="102" fill="#00ff88" font-size="10">30</text>
        <text x="35" y="138" fill="#666666" font-size="11" font-weight="600">0</text>

        <!-- RSI LINE -->
        <polyline id="rsiLine" points="80,56 180,58 280,62 380,60 480,66 580,70 680,68 780,74 880,78 980,74 1080,72" 
                  stroke="#d4a856" stroke-width="2.5" fill="none"/>

        <!-- RSI CURRENT VALUE -->
        <circle id="rsiCurrentDot" cx="1080" cy="72" r="5" fill="#d4a856" stroke="#ffffff" stroke-width="1"/>
        <rect id="rsiValueBg" x="1085" y="60" width="50" height="22" fill="#1a1a1a" stroke="#d4a856" stroke-width="1" rx="2"/>
        <text id="rsiCurrentLabel" x="1110" y="76" fill="#00ff88" font-size="13" font-weight="700" text-anchor="middle">RSI: 45</text>
        
        <!-- RSI SIGNAL INDICATOR -->
        <g id="rsiSignalGroup">
          <text id="rsiSignalText" x="600" y="130" fill="#666666" font-size="11" font-weight="600" text-anchor="middle">NEUTRAL ZONE</text>
        </g>
        
        <!-- TIMEFRAME SYNC INDICATOR -->
        <text id="rsiTimeframeLabel" x="1140" y="130" fill="#444444" font-size="9" text-anchor="end">TF: 1D</text>
      </svg>
    </div>

    <!-- OPEN INTEREST CHART - Dark theme matching chart -->
    <div style="background: #0d0d0d; border: 1px solid #1a1a1a; padding: 20px; border-radius: 4px; margin-bottom: 20px;">
      <!-- Header -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 14px; border-bottom: 1px solid #1a1a1a;">
        <div>
          <div style="color: #ffffff; font-weight: 700; font-size: 1.1em; letter-spacing: 1px;">OPEN INTEREST</div>
          <div style="color: #666666; font-size: 0.8em; margin-top: 2px;">BTC Perpetual Futures</div>
        </div>
        <div style="text-align: right;">
          <div id="totalOI" style="color: #ffffff; font-size: 1.4em; font-weight: 700;">$12.45B</div>
          <div id="oiChange24h" style="color: #089981; font-size: 0.9em;">+2.8% (24h)</div>
        </div>
      </div>

      <!-- OI Chart SVG -->
      <svg id="oiChart" viewBox="0 0 800 120" style="width: 100%; height: 120px; background: #000000; border-radius: 4px;">
        <!-- Grid lines -->
        <line x1="50" y1="20" x2="780" y2="20" stroke="#1a1a1a" stroke-width="1"/>
        <line x1="50" y1="60" x2="780" y2="60" stroke="#1a1a1a" stroke-width="1"/>
        <line x1="50" y1="100" x2="780" y2="100" stroke="#1a1a1a" stroke-width="1"/>
        
        <!-- OI Area Fill -->
        <defs>
          <linearGradient id="oiGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#2962ff;stop-opacity:0.4"/>
            <stop offset="100%" style="stop-color:#2962ff;stop-opacity:0.05"/>
          </linearGradient>
        </defs>
        <path id="oiAreaPath" d="M50,100 L50,65 L100,62 L150,58 L200,55 L250,52 L300,48 L350,45 L400,42 L450,40 L500,38 L550,35 L600,38 L650,42 L700,38 L750,35 L780,32 L780,100 Z" fill="url(#oiGradient)"/>
        
        <!-- OI Line -->
        <polyline id="oiLine" points="50,65 100,62 150,58 200,55 250,52 300,48 350,45 400,42 450,40 500,38 550,35 600,38 650,42 700,38 750,35 780,32" fill="none" stroke="#2962ff" stroke-width="2"/>
        
        <!-- Current value dot -->
        <circle id="oiCurrentDot" cx="780" cy="32" r="4" fill="#2962ff"/>
        
        <!-- Axis labels -->
        <text x="10" y="24" fill="#555" font-size="9">$14B</text>
        <text x="10" y="64" fill="#555" font-size="9">$12B</text>
        <text x="10" y="104" fill="#555" font-size="9">$10B</text>
        
        <!-- Time labels -->
        <text x="50" y="115" fill="#555" font-size="8">24h ago</text>
        <text x="400" y="115" fill="#555" font-size="8">12h ago</text>
        <text x="750" y="115" fill="#555" font-size="8">Now</text>
      </svg>

      <!-- Exchange Breakdown -->
      <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 16px;">
        <div style="background: #0a0a0a; padding: 14px; border-radius: 4px; border-left: 3px solid #333333;">
          <div style="color: #ffffff; font-weight: 600; font-size: 0.85em;">BINANCE</div>
          <div id="oiBinance" style="color: #cccccc; font-size: 1.2em; font-weight: 700; margin-top: 6px;">$5.12B</div>
          <div id="oiBinanceChange" style="color: #999999; font-size: 0.8em; margin-top: 4px;">+3.2%</div>
        </div>
        <div style="background: #0a0a0a; padding: 14px; border-radius: 4px; border-left: 3px solid #333333;">
          <div style="color: #ffffff; font-weight: 600; font-size: 0.85em;">BYBIT</div>
          <div id="oiBybit" style="color: #cccccc; font-size: 1.2em; font-weight: 700; margin-top: 6px;">$3.85B</div>
          <div id="oiBybitChange" style="color: #999999; font-size: 0.8em; margin-top: 4px;">+2.1%</div>
        </div>
        <div style="background: #0a0a0a; padding: 14px; border-radius: 4px; border-left: 3px solid #333333;">
          <div style="color: #ffffff; font-weight: 600; font-size: 0.85em;">OKX</div>
          <div id="oiOkx" style="color: #cccccc; font-size: 1.2em; font-weight: 700; margin-top: 6px;">$2.28B</div>
          <div id="oiOkxChange" style="color: #999999; font-size: 0.8em; margin-top: 4px;">-0.8%</div>
        </div>
        <div style="background: #0a0a0a; padding: 14px; border-radius: 4px; border-left: 3px solid #333333;">
          <div style="color: #ffffff; font-weight: 600; font-size: 0.85em;">OTHERS</div>
          <div id="oiOthers" style="color: #cccccc; font-size: 1.2em; font-weight: 700; margin-top: 6px;">$1.20B</div>
          <div id="oiOthersChange" style="color: #999999; font-size: 0.8em; margin-top: 4px;">+1.5%</div>
        </div>
      </div>

      <!-- OI Analysis -->
      <div style="background: #0a0a0a; border-radius: 6px; padding: 16px; margin-top: 16px; border-left: 3px solid #333333;">
        <div style="color: #666666; font-size: 0.85em; margin-bottom: 10px;">OI ANALYSIS</div>
        <div id="oiAnalysisText" style="color: #cccccc; font-size: 0.95em; line-height: 1.6;">
          OI rosnce - rynek w konsolidacji. Czekaj na wyrany sygna kierunku przed zajciem pozycji.
        </div>
      </div>

      <!-- OI Metrics -->
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 16px;">
        <div style="text-align: center; padding: 12px; background: #0a0a0a; border-radius: 4px;">
          <div style="color: #666666; font-size: 0.8em;">LONG/SHORT RATIO</div>
          <div id="longShortRatio" style="color: #089981; font-size: 1.2em; font-weight: 700; margin-top: 4px;">1.24</div>
          <div style="color: #666666; font-size: 0.8em; margin-top: 2px;">Longs dominant</div>
        </div>
        <div style="text-align: center; padding: 12px; background: #0a0a0a; border-radius: 4px;">
          <div style="color: #666666; font-size: 0.8em;">24H LIQUIDATIONS</div>
          <div id="liquidations24h" style="color: #f23645; font-size: 1.2em; font-weight: 700; margin-top: 4px;">$85.2M</div>
          <div style="color: #666666; font-size: 0.8em; margin-top: 2px;">Shorts: 62%</div>
        </div>
        <div style="text-align: center; padding: 12px; background: #0a0a0a; border-radius: 4px;">
          <div style="color: #666666; font-size: 0.8em;">FUNDING RATE</div>
          <div id="fundingRateOI" style="color: #089981; font-size: 1.2em; font-weight: 700; margin-top: 4px;">+0.008%</div>
          <div style="color: #666666; font-size: 0.8em; margin-top: 2px;">Neutral-bullish</div>
        </div>
      </div>
    </div>

    <div class="genius-commentary">
      <div class="genius-commentary-title"> Komentarz Genius AI</div>
      <div class="genius-commentary-text" id="geniusCommentaryMain">adowanie komentarza z API...</div>
    </div>
    </div>
    
    <!-- SIDE PANEL - Flat Ticker Style (like DJI 38,650.00 +0.30%  DAX) -->
    <div style="background: #000000; border: 1px solid #333333; padding: 0; font-weight: 700; letter-spacing: 0.5px; margin-top: 20px;">
      
      <!-- WHALE TRANSFERS - Flat ticker row -->
      <div style="padding: 14px 16px; border-bottom: 1px solid #333333; display: flex; align-items: center; flex-wrap: wrap; gap: 8px;">
        <span style="color: #ffffff; font-size: 1.8em;">WHALE</span>
        <span style="color: #666666;"></span>
        <span style="color: #cccccc; font-size: 0.95em;">TRANSFERS</span>
        <span style="color: #666666;"></span>
        <span style="display: inline-flex; align-items: center; gap: 4px;">
          <span style="width: 6px; height: 6px; background: #ff3333; border-radius: 50%; animation: livePulse 1.5s infinite;"></span>
          <span style="color: #ff3333; font-size: 0.75em; font-weight: 600;">LIVE</span>
        </span>
      </div>
      <div id="largeTransfersList" style="padding: 8px 16px; font-size: 0.9em;">
        <div style="color: #666666;">Loading...</div>
      </div>
      
      <!-- ICEBERG - Flat ticker rows -->
      <div style="padding: 14px 16px; border-top: 1px solid #333333; border-bottom: 1px solid #222222; display: flex; align-items: center; gap: 8px;">
        <span style="color: #ffffff; font-size: 1.8em;">ICEBERG</span>
        <span style="color: #666666;"></span>
        <span style="color: #cccccc; font-size: 0.95em;">HIDDEN ORDERS</span>
      </div>
      <div style="padding: 10px 16px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #222222;">
        <span style="color: #ffffff; font-size: 1.1em;">BUY</span>
        <span style="color: #cccccc;">$94,800 - $95,200</span>
        <span style="color: #666666;"></span>
        <span style="color: #999999;">~3,200 BTC</span>
      </div>
      <div style="padding: 10px 16px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #222222;">
        <span style="color: #ffffff; font-size: 1.1em;">SELL</span>
        <span style="color: #cccccc;">$97,400 - $97,800</span>
        <span style="color: #666666;"></span>
        <span style="color: #999999;">~2,100 BTC</span>
      </div>
      <div style="padding: 10px 16px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #333333;">
        <span style="color: #ffffff; font-size: 1.1em;">HIDE</span>
        <span style="color: #cccccc;">$96,000 - $96,500</span>
        <span style="color: #666666;"></span>
        <span style="color: #999999;">~1,800 BTC</span>
      </div>
      
      <!-- SESSION - Flat ticker row with progress bar -->
      <div style="padding: 14px 16px; border-bottom: 1px solid #333333;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
          <span style="color: #ffffff; font-size: 1.8em;">SESSION</span>
          <span style="color: #cccccc; font-size: 1.2em;" id="frontSessionTimer">--:--:--</span>
          <span style="color: #666666;"></span>
          <span style="color: #999999; font-size: 0.95em;" id="frontSessionName">--</span>
          <span style="color: #666666;"></span>
          <span style="color: #666666; font-size: 0.9em;">Next:</span>
          <span style="color: #cccccc; font-size: 1.1em; font-weight: 500;" id="nextSessionInfo">--</span>
        </div>
        <!-- Session Progress Bar -->
        <div style="background: #1a1a1a; height: 4px; border-radius: 2px; overflow: hidden;">
          <div id="sessionProgressBar" style="background: #ffffff; height: 100%; width: 50%; transition: width 1s linear;"></div>
        </div>
      </div>
      
      <!-- LIQUIDATION LEVELS - Improved readability -->
      <div style="padding: 14px 16px; border-bottom: 1px solid #333333; display: flex; align-items: center; gap: 8px;">
        <span style="color: #ffffff; font-size: 1.8em;">LIQUIDATION</span>
        <span style="color: #666666;"></span>
        <span style="color: #cccccc; font-size: 0.95em;">LEVELS</span>
      </div>
      
      <!-- Liquidation Grid -->
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 16px;">
        <!-- LONG -->
        <div style="background: #0a0a0a; padding: 14px; border-radius: 4px; border-left: 3px solid #333333;">
          <div style="color: #888888; font-size: 0.75em; letter-spacing: 1px; margin-bottom: 6px;">LONG LIQ</div>
          <div id="longLiqPrice" style="color: #ffffff; font-size: 1.3em; font-weight: 700;">$93,450</div>
          <div style="display: flex; align-items: center; gap: 6px; margin-top: 6px;">
            <span style="color: #666666; font-size: 0.8em;">Vol:</span>
            <span id="longLiqVolume" style="color: #cccccc; font-size: 0.9em;">$245M</span>
          </div>
        </div>
        
        <!-- SHORT -->
        <div style="background: #0a0a0a; padding: 14px; border-radius: 4px; border-left: 3px solid #333333;">
          <div style="color: #888888; font-size: 0.75em; letter-spacing: 1px; margin-bottom: 6px;">SHORT LIQ</div>
          <div id="shortLiqPrice" style="color: #ffffff; font-size: 1.3em; font-weight: 700;">$97,800</div>
          <div style="display: flex; align-items: center; gap: 6px; margin-top: 6px;">
            <span style="color: #666666; font-size: 0.8em;">Vol:</span>
            <span id="shortLiqVolume" style="color: #cccccc; font-size: 0.9em;">$180M</span>
          </div>
        </div>
        
        <!-- MEGA -->
        <div style="background: #0a0a0a; padding: 14px; border-radius: 4px; border-left: 3px solid #333333;">
          <div style="color: #888888; font-size: 0.75em; letter-spacing: 1px; margin-bottom: 6px;">MEGA CLUSTER</div>
          <div id="megaLiqPrice" style="color: #ffffff; font-size: 1.3em; font-weight: 700;">$91,200</div>
          <div style="display: flex; align-items: center; gap: 6px; margin-top: 6px;">
            <span style="color: #666666; font-size: 0.8em;">Vol:</span>
            <span id="megaLiqVolume" style="color: #cccccc; font-size: 0.9em;">$520M</span>
          </div>
        </div>
      </div>
      
      <!-- FOOTER STATS - Flat ticker row -->
      <div style="padding: 12px 16px; display: flex; align-items: center; gap: 10px; font-size: 0.9em; border-top: 1px solid #222222;">
        <span style="color: #ffffff;">VOL</span>
        <span style="color: #cccccc;" id="totalTransferVolume">--</span>
        <span style="color: #666666;"></span>
        <span style="color: #ffffff;">NET</span>
        <span id="netFlowIndicator" style="color: #cccccc;">--</span>
        <span style="color: #666666;"></span>
        <span style="color: #ffffff;">PROX</span>
        <span id="liqProximity" style="color: #cccccc;">--</span>
      </div>
    </div>
  </div>

  <!-- DASHBOARD TAB CONTENT (dodatkowe info) -->
  <div id="dashboard" class="tab-content">
    <h2>Dashboard  szybki podgld</h2>
    <p style="color: var(--gray);">Widok gwny jest nad menu, a tu masz notatki akcji: Radar Snajperski BTC, szybkie sygnay i mini-wykres z panelu menu.</p>
  </div>

  <!-- ON-CHAIN & FLOWS TAB -->
  <div id="onchain-flows" class="tab-content">
    <h2>On-chain & Flows</h2>
    <div class="trend-grid" style="grid-template-columns: repeat(3, 1fr);">
      <div class="trend-card">
        <h4>Stablecoin Netflow</h4>
        <p>24h: <span class="trend-up">+$180M</span></p>
        <p>Bias: popyt spot </p>
        <p>Watch: odwrt &lt; +$50M</p>
        <div class="mini-sparkline">
          <svg viewBox="0 0 120 40" preserveAspectRatio="xMidYMid meet">
            <polyline points="5,30 25,24 45,18 65,22 85,15 105,20" fill="none" stroke="var(--green)" stroke-width="2" />
          </svg>
        </div>
      </div>
      <div class="trend-card">
        <h4>ETF Spot BTC</h4>
        <p>Dzienny napyw: <span class="trend-up">+$220M</span></p>
        <p>5d avg: +$140M</p>
        <p>Ryzyko: <span class="trend-down">spadek &lt; +$50M</span></p>
        <div class="mini-sparkline">
          <svg viewBox="0 0 120 40" preserveAspectRatio="xMidYMid meet">
            <polyline points="5,25 25,26 45,24 65,22 85,20 105,18" fill="none" stroke="var(--yellow)" stroke-width="2" />
          </svg>
        </div>
      </div>
      <div class="trend-card">
        <h4>Exchange Flows</h4>
        <p>Net outflow: <span class="trend-up">-3.2k BTC</span></p>
        <p>Presja poday maleje</p>
        <p>Alert: duy inflow = risk-off</p>
        <div class="mini-sparkline">
          <svg viewBox="0 0 120 40" preserveAspectRatio="xMidYMid meet">
            <polyline points="5,18 25,20 45,24 65,28 85,26 105,30" fill="none" stroke="var(--cyan)" stroke-width="2" />
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- RISK & POSITIONING TAB -->
  <div id="risk-positioning" class="tab-content">
    <h2>Risk & Positioning</h2>
    <div class="trend-grid" style="grid-template-columns: repeat(3, 1fr);">
      <div class="trend-card">
        <h4>Funding / Skew</h4>
        <p>Funding: <span class="trend-up">+0.008%</span></p>
        <p>Skew: lekko long</p>
        <p>Alert: &gt;0.012% redukuj</p>
        <div class="mini-sparkline">
          <svg viewBox="0 0 120 40" preserveAspectRatio="xMidYMid meet">
            <polyline points="5,24 25,22 45,20 65,21 85,19 105,18" fill="none" stroke="var(--orange)" stroke-width="2" />
          </svg>
        </div>
      </div>
      <div class="trend-card">
        <h4>Open Interest</h4>
        <p>OI: $12.4B</p>
        <p>d/d: <span class="trend-up">+3%</span></p>
        <p>Brak przegrzania</p>
        <div class="mini-sparkline">
          <svg viewBox="0 0 120 40" preserveAspectRatio="xMidYMid meet">
            <polyline points="5,28 25,26 45,24 65,22 85,20 105,19" fill="none" stroke="var(--green)" stroke-width="2" />
          </svg>
        </div>
      </div>
      <div class="trend-card">
        <h4>Liquidation Map</h4>
        <p>Short liq: 97.4k</p>
        <p>Long liq: 94.8k</p>
        <p>Scenariusz: graj pod sweep shortw</p>
        <div class="mini-sparkline">
          <svg viewBox="0 0 120 40" preserveAspectRatio="xMidYMid meet">
            <polyline points="5,30 25,18 45,20 65,16 85,22 105,14" fill="none" stroke="var(--red)" stroke-width="2" />
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- EXECUTION PLAYBOOK TAB -->
  <div id="execution-playbook" class="tab-content">
    <h2>Execution Playbook</h2>
    <div class="trend-grid" style="grid-template-columns: repeat(3, 1fr);">
      <div class="trend-card">
        <h4>Scalp</h4>
        <p>Entry: 95.2k (FVG)</p>
        <p>TP: 97.4k</p>
        <p>SL: 94.2k  size 0.35x</p>
        <button class="cta-btn">Ustaw alert</button>
      </div>
      <div class="trend-card">
        <h4>Intraday</h4>
        <p>Buy: 95.896.2k jeli RSI1H&gt;45</p>
        <p>TP1 97.4k, TP2 99k</p>
        <p>Trailing: EMA20 1H</p>
        <button class="cta-btn">Dodaj do playbooka</button>
      </div>
      <div class="trend-card">
        <h4>Swing</h4>
        <p>Po wybiciu 98k  hold do 105k</p>
        <p>Hedge 25% jeli &lt;96k</p>
        <p>Rewizja codziennie 21:00 UTC</p>
        <button class="cta-btn">Wylij alert</button>
      </div>
    </div>
  </div>

  <!-- ALERTS & JOURNAL TAB -->
  <div id="alerts-journal" class="tab-content">
    <h2>Alerts & Journal</h2>
    <div class="trend-grid" style="grid-template-columns: repeat(3, 1fr);">
      <div class="trend-card">
        <h4>Alerty aktywne</h4>
        <p> 97.4k SELL sweep</p>
        <p> Funding &gt; 0.012%</p>
        <p> ETF inflow &lt; +$50M</p>
        <button class="cta-btn">Zarzdzaj alertami</button>
      <div class="trend-card">
        <h4>Checklist</h4>
        <p>[ ] Trend 1H zgodny z 4H</p>
        <p>[ ] Funding OK</p>
        <p>[ ] Poziomy 95.2k/97.4k ustawione</p>
      </div>
        <button class="cta-btn">Odhacz</button>
        <h4>Notatki</h4>
        <p>Zapisz po trade: co zadziaao, co poprawi, decyzje emocjonalne vs plan.</p>
      </div>
    </div>
        <button class="cta-btn">Dodaj notatk</button>

  <!-- TREND ANALYSIS TAB -->
  <div id="trend-analysis" class="tab-content">
    <h2 style="color: #ffffff; margin-bottom: 14px; font-size: 1.2em; font-weight: 700; letter-spacing: 0.5px;">TREND ANALYSIS - Bitcoin</h2>
    
    <!-- MAIN TREND INDICATORS -->
    <div class="trend-grid">
      <div class="trend-card">
        <h4>MAIN TREND</h4>
        <p>Direction: <span class="trend-up">UPTREND</span></p>
        <p>Strength: <span class="trend-value">STRONG</span></p>
        <p>Status: Price above EMA 50</p>
      </div>

      <div class="trend-card">
        <h4>KEY LEVELS</h4>
        <p>Resistance: <span class="trend-value">$97,400</span></p>
        <p>Support: <span class="trend-value">$94,800</span></p>
        <p>Range: $2,600</p>
      </div>

      <div class="trend-card">
        <h4>MOMENTUM</h4>
        <p>RSI 14: <span class="trend-up">62.3</span> (Bullish)</p>
        <p>MACD: <span class="trend-up">Positive Divergence</span></p>
        <p>Volume: Above Average</p>
      </div>

      <div class="trend-card">
        <h4>SIGNAL QUALITY</h4>
        <p>Last BUY Signal: <span class="trend-up">Valid (84M Liq)</span></p>
        <p>Last SELL Signal: <span class="trend-down">Valid (96M Liq)</span></p>
        <p>Signal Accuracy: 78%</p>
      </div>

      <div class="trend-card">
        <h4>LIQUIDITY ZONES</h4>
        <p>Buy Zone: $94.8k - $95.1k</p>
        <p>Sell Zone: $96.0k - $96.3k</p>
        <p>Strength: <span class="trend-up">DEEP</span></p>
      </div>

      <div class="trend-card">
        <h4>RISK/REWARD</h4>
        <p>Risk/Reward: <span class="trend-value">1:2.5</span></p>
        <p>Stop Loss: $94,200</p>
        <p>Take Profit: $99,500</p>
      </div>

      <div class="trend-card">
        <h4>MARKET STRUCTURE</h4>
        <p>Higher Highs: <span class="trend-up">YES</span></p>
        <p>Higher Lows: <span class="trend-up">YES</span></p>
        <p>Trend Quality: <span class="trend-up">STRUCTURAL</span></p>
      </div>

      <div class="trend-card">
        <h4>TIME FRAME STATUS</h4>
        <p>1D: <span class="trend-up">UPTREND</span></p>
        <p>4H: <span class="trend-up">UPTREND</span></p>
        <p>1H: <span class="trend-neutral">CONSOLIDATING</span></p>
      </div>

      <div class="trend-card">
        <h4>NEXT TARGET</h4>
        <p>Short Term: $97,400</p>
        <p>Medium Term: $100,000</p>
        <p>Long Term: $105,000+</p>
      </div>
    </div>

    <!-- DETAILED TECHNICAL SUMMARY -->
    <div style="background: var(--panel); border: 1px solid var(--border); border-left: 2px solid #1a1a1a; padding: 14px; margin-bottom: 14px;">
      <h3 style="color: #ffffff; margin-bottom: 10px; font-weight: 700;">TECHNICAL SUMMARY</h3>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px;">
        <div>
          <p style="color: var(--gray); margin-bottom: 8px;"><strong>BULLISH FACTORS:</strong></p>
          <ul style="list-style: none; padding-left: 0; color: var(--green); font-size: 0.9em; line-height: 1.6;">
            <li> Price above all major moving averages</li>
            <li> Higher highs and higher lows pattern</li>
            <li> RSI approaching 65 (strong momentum)</li>
            <li> Volume increasing on up moves</li>
            <li> Support holding at $94.8k level</li>
          </ul>
        </div>
        <div>
          <p style="color: var(--gray); margin-bottom: 8px;"><strong>BEARISH FACTORS:</strong></p>
          <ul style="list-style: none; padding-left: 0; color: var(--red); font-size: 0.9em; line-height: 1.6;">
            <li>! RSI above 70 (potential overbought)</li>
            <li>! Resistance at $97.4k creating cap</li>
            <li>! Large liquidations detected</li>
            <li>! Fear & Greed at 62 (moderate)</li>
            <li>! Watch for pullback to $95.5k</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- ACTION PLAN -->
    <div style="background: var(--panel); border: 1px solid var(--border); border-left: 2px solid #1a1a1a; padding: 14px;">
      <h3 style="color: #ffffff; margin-bottom: 10px; font-weight: 700;">TRADER ACTION PLAN</h3>
      <p style="color: var(--gray); margin-bottom: 8px; font-size: 0.9em;"><strong>Current Strategy:</strong> <span style="color: var(--green);">LONG BIAS</span></p>
      <ul style="list-style: none; padding-left: 0; font-size: 0.9em; line-height: 1.6;">
        <li style="color: #ffffff; margin: 6px 0;"><strong>Entry:</strong> Pullback to $95.8k - $96.2k with BUY signal</li>
        <li style="color: #ffffff; margin: 6px 0;"><strong>Stop Loss:</strong> $94,200 (break of support)</li>
        <li style="color: #ffffff; margin: 6px 0;"><strong>Take Profit 1:</strong> $97,400 (resistance break)</li>
        <li style="color: #ffffff; margin: 6px 0;"><strong>Take Profit 2:</strong> $100,000 (psychological level)</li>
        <li style="color: #ffffff; margin: 6px 0;"><strong>Watch:</strong> Large liquidation zones - reduce size if RSI > 75</li>
      </ul>
    </div>
  </div>

  <!-- KPI CORRELATION TAB (PLACEHOLDER) -->
  <div id="kpi-correlation" class="tab-content">
    <h2 style="color: #ffffff; margin-bottom: 14px; font-size: 1.2em; font-weight: 700; letter-spacing: 0.5px;">KPI CORRELATION ANALYSIS</h2>
    
    <div class="corr-wrapper">
      <div class="corr-controls">
        <span style="color: var(--gray);">Timeframe:</span>
        <button class="corr-btn active" data-corrtf="1D">1D</button>
        <button class="corr-btn" data-corrtf="1W">1W</button>
        <button class="corr-btn" data-corrtf="1M">1M</button>
        <button class="corr-btn" data-corrtf="3M">3M</button>
        <span style="margin-left: auto; color: var(--gray);">Method: Pearson</span>
      </div>

      <table class="corr-grid">
        <thead>
          <tr>
            <th>ASSET</th>
            <th>BTC</th>
            <th>ETH</th>
            <th>SOL</th>
            <th>NASDAQ</th>
            <th>GOLD</th>
            <th>DXY</th>
            <th>VIX</th>
            <th>OI</th>
            <th>FUNDING</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="corr-asset">BTC</td>
            <td class="corr-cell heat-pos-high">1.00</td>
            <td class="corr-cell heat-pos-high">0.86</td>
            <td class="corr-cell heat-pos-mid">0.64</td>
            <td class="corr-cell heat-pos-low">0.38</td>
            <td class="corr-cell heat-pos-low">0.22</td>
            <td class="corr-cell heat-neg-mid">-0.48</td>
            <td class="corr-cell heat-neg-low">-0.35</td>
            <td class="corr-cell heat-pos-mid">0.57</td>
            <td class="corr-cell heat-pos-low">0.19</td>
          </tr>
          <tr>
            <td class="corr-asset">ETH</td>
            <td class="corr-cell heat-pos-high">0.86</td>
            <td class="corr-cell heat-pos-high">1.00</td>
            <td class="corr-cell heat-pos-mid">0.68</td>
            <td class="corr-cell heat-pos-low">0.35</td>
            <td class="corr-cell heat-pos-low">0.18</td>
            <td class="corr-cell heat-neg-mid">-0.42</td>
            <td class="corr-cell heat-neg-low">-0.31</td>
            <td class="corr-cell heat-pos-mid">0.51</td>
            <td class="corr-cell heat-pos-low">0.16</td>
          </tr>
          <tr>
            <td class="corr-asset">SOL</td>
            <td class="corr-cell heat-pos-mid">0.64</td>
            <td class="corr-cell heat-pos-mid">0.68</td>
            <td class="corr-cell heat-pos-high">1.00</td>
            <td class="corr-cell heat-pos-low">0.29</td>
            <td class="corr-cell heat-pos-low">0.12</td>
            <td class="corr-cell heat-neg-low">-0.22</td>
            <td class="corr-cell heat-neg-low">-0.18</td>
            <td class="corr-cell heat-pos-low">0.28</td>
            <td class="corr-cell heat-pos-low">0.10</td>
          </tr>
          <tr>
            <td class="corr-asset">NASDAQ</td>
            <td class="corr-cell heat-pos-low">0.62</td>
            <td class="corr-cell heat-pos-low">0.59</td>
            <td class="corr-cell heat-pos-low">0.33</td>
            <td class="corr-cell heat-pos-high">1.00</td>
            <td class="corr-cell heat-pos-low">0.21</td>
            <td class="corr-cell heat-neg-mid">-0.40</td>
            <td class="corr-cell heat-neg-low">-0.28</td>
            <td class="corr-cell heat-pos-low">0.30</td>
            <td class="corr-cell heat-pos-low">0.08</td>
          </tr>
          <tr>
            <td class="corr-asset">GOLD</td>
            <td class="corr-cell heat-pos-low">0.22</td>
            <td class="corr-cell heat-pos-low">0.18</td>
            <td class="corr-cell heat-pos-low">0.12</td>
            <td class="corr-cell heat-pos-low">0.21</td>
            <td class="corr-cell heat-pos-high">1.00</td>
            <td class="corr-cell heat-neg-low">-0.26</td>
            <td class="corr-cell heat-neg-low">-0.19</td>
            <td class="corr-cell heat-pos-low">0.12</td>
            <td class="corr-cell heat-pos-low">0.05</td>
          </tr>
          <tr>
            <td class="corr-asset">DXY</td>
            <td class="corr-cell heat-neg-mid">-0.48</td>
            <td class="corr-cell heat-neg-mid">-0.42</td>
            <td class="corr-cell heat-neg-low">-0.22</td>
            <td class="corr-cell heat-neg-mid">-0.40</td>
            <td class="corr-cell heat-neg-low">-0.26</td>
            <td class="corr-cell heat-pos-high">1.00</td>
            <td class="corr-cell heat-pos-low">0.28</td>
            <td class="corr-cell heat-neg-low">-0.18</td>
            <td class="corr-cell heat-neg-low">-0.12</td>
          </tr>
          <tr>
            <td class="corr-asset">VIX</td>
            <td class="corr-cell heat-neg-low">-0.35</td>
            <td class="corr-cell heat-neg-low">-0.31</td>
            <td class="corr-cell heat-neg-low">-0.18</td>
            <td class="corr-cell heat-neg-low">-0.28</td>
            <td class="corr-cell heat-neg-low">-0.19</td>
            <td class="corr-cell heat-pos-low">0.28</td>
            <td class="corr-cell heat-pos-high">1.00</td>
            <td class="corr-cell heat-neg-low">-0.15</td>
            <td class="corr-cell heat-neg-low">-0.11</td>
          </tr>
          <tr>
            <td class="corr-asset">OI</td>
            <td class="corr-cell heat-pos-mid">0.57</td>
            <td class="corr-cell heat-pos-mid">0.51</td>
            <td class="corr-cell heat-pos-low">0.28</td>
            <td class="corr-cell heat-pos-low">0.30</td>
            <td class="corr-cell heat-pos-low">0.12</td>
            <td class="corr-cell heat-neg-low">-0.18</td>
            <td class="corr-cell heat-neg-low">-0.15</td>
            <td class="corr-cell heat-pos-high">1.00</td>
            <td class="corr-cell heat-pos-low">0.22</td>
          </tr>
          <tr>
            <td class="corr-asset">FUNDING</td>
            <td class="corr-cell heat-pos-low">0.19</td>
            <td class="corr-cell heat-pos-low">0.16</td>
            <td class="corr-cell heat-pos-low">0.10</td>
            <td class="corr-cell heat-pos-low">0.08</td>
            <td class="corr-cell heat-pos-low">0.05</td>
            <td class="corr-cell heat-neg-low">-0.12</td>
            <td class="corr-cell heat-neg-low">-0.11</td>
            <td class="corr-cell heat-pos-low">0.22</td>
            <td class="corr-cell heat-pos-high">1.00</td>
          </tr>
        </tbody>
      </table>

      <div class="corr-summary">
        <div class="corr-card">
          <h4>Top Positive</h4>
          <p>BTCETH: <span style="color: var(--green); font-weight:700;">0.86</span></p>
          <p>BTCNASDAQ: <span style="color: var(--green); font-weight:700;">0.62</span></p>
        </div>
        <div class="corr-card">
          <h4>Top Negative</h4>
          <p>BTCDXY: <span style="color: var(--red); font-weight:700;">-0.48</span></p>
          <p>BTCVIX: <span style="color: var(--red); font-weight:700;">-0.35</span></p>
        </div>
        <div class="corr-card">
          <h4>Methodology</h4>
          <p>Pearson correlation over selected timeframe. Values are demo.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- MULTI-TF ANALYSIS TAB -->
  <div id="multi-tf-analysis" class="tab-content">
    <h2 style="color: #ffffff; margin-bottom: 14px; font-size: 1.2em;">IMEFRAME ZONE  MULTI-TF ANALYSIS</h2>
    <div class="tf-wrapper">
      <div class="tf-guide">
        <h3>JAK CZYTA WARTOCI:</h3>
        <ul>
          <li>RSI: Relative Strength Index (0-100, przekupienie >70, wyprzedanie <30)</li>
          <li>MACD: Momentum  + (wzrost), - (spadek), 0 (neutralny)</li>
          <li>K%D: Stochastic Oscillator  K/D (szybka/wolna linia)</li>
          <li>EMA: Kierunek redniej   (w gr),  (w d),  (pasko)</li>
          <li>BB: Bollinger Bands  Upper/Mid/Lower (pozycja ceny)</li>
          <li>Vol: Volume  HIGH, MED, LOW (poziom wolumenu)</li>
          <li>1m  5m  15m  30m  1h  4h  1d  1M  3M  1Y</li>
        </ul>
      </div>
      <div class="tf-grid">
        <!-- 1m -->
        <div class="tf-card">
          <div class="tf-title">1m <span class="tf-status tf-bull">BULL</span></div>
          <div class="tf-row"><span>RSI</span><span>58</span></div>
          <div class="tf-row"><span>MACD</span><span>+</span></div>
          <div class="tf-row"><span>K%D</span><span>72/68</span></div>
          <div class="tf-row"><span>EMA</span><span></span></div>
          <div class="tf-row"><span>BB</span><span>Upper</span></div>
          <div class="tf-row"><span>Vol</span><span>HIGH</span></div>
        </div>
        <!-- 5m -->
        <div class="tf-card">
          <div class="tf-title">5m <span class="tf-status tf-bull">BULL</span></div>
          <div class="tf-row"><span>RSI</span><span>54</span></div>
          <div class="tf-row"><span>MACD</span><span>+</span></div>
          <div class="tf-row"><span>K%D</span><span>65/60</span></div>
          <div class="tf-row"><span>EMA</span><span></span></div>
          <div class="tf-row"><span>BB</span><span>Mid</span></div>
          <div class="tf-row"><span>Vol</span><span>MED</span></div>
        </div>
        <!-- 15m -->
        <div class="tf-card">
          <div class="tf-title">15m <span class="tf-status tf-bull">BULL</span></div>
          <div class="tf-row"><span>RSI</span><span>56</span></div>
          <div class="tf-row"><span>MACD</span><span>+</span></div>
          <div class="tf-row"><span>K%D</span><span>58/52</span></div>
          <div class="tf-row"><span>EMA</span><span></span></div>
          <div class="tf-row"><span>BB</span><span>Mid</span></div>
          <div class="tf-row"><span>Vol</span><span>MED</span></div>
        </div>
        <!-- 30m -->
        <div class="tf-card">
          <div class="tf-title">30m <span class="tf-status tf-neutral"> NEUTRAL</span></div>
          <div class="tf-row"><span>RSI</span><span>51</span></div>
          <div class="tf-row"><span>MACD</span><span>0</span></div>
          <div class="tf-row"><span>K%D</span><span>48/50</span></div>
          <div class="tf-row"><span>EMA</span><span></span></div>
          <div class="tf-row"><span>BB</span><span>Mid</span></div>
          <div class="tf-row"><span>Vol</span><span>MED</span></div>
        </div>
        <!-- 1h -->
        <div class="tf-card">
          <div class="tf-title">1h <span class="tf-status tf-sideways"> SIDEWAYS</span></div>
          <div class="tf-row"><span>RSI</span><span>47</span></div>
          <div class="tf-row"><span>MACD</span><span>0</span></div>
          <div class="tf-row"><span>K%D</span><span>44/45</span></div>
          <div class="tf-row"><span>EMA</span><span></span></div>
          <div class="tf-row"><span>BB</span><span>Lower</span></div>
          <div class="tf-row"><span>Vol</span><span>LOW</span></div>
        </div>
        <!-- 4h -->
        <div class="tf-card">
          <div class="tf-title">4h <span class="tf-status tf-neutral"> NEUTRAL</span></div>
          <div class="tf-row"><span>RSI</span><span>48</span></div>
          <div class="tf-row"><span>MACD</span><span>-</span></div>
          <div class="tf-row"><span>K%D</span><span>40/42</span></div>
          <div class="tf-row"><span>EMA</span><span></span></div>
          <div class="tf-row"><span>BB</span><span>Lower</span></div>
          <div class="tf-row"><span>Vol</span><span>LOW</span></div>
        </div>
        <!-- 1d -->
        <div class="tf-card">
          <div class="tf-title">1d <span class="tf-status tf-bear"> BEAR</span></div>
          <div class="tf-row"><span>RSI</span><span>42</span></div>
          <div class="tf-row"><span>MACD</span><span>-</span></div>
          <div class="tf-row"><span>K%D</span><span>35/38</span></div>
          <div class="tf-row"><span>EMA</span><span></span></div>
          <div class="tf-row"><span>BB</span><span>Lower</span></div>
          <div class="tf-row"><span>Vol</span><span>MED</span></div>
        </div>
        <!-- 1M -->
        <div class="tf-card">
          <div class="tf-title">1M <span class="tf-status tf-bull">BULL</span></div>
          <div class="tf-row"><span>RSI</span><span>62</span></div>
          <div class="tf-row"><span>MACD</span><span>+</span></div>
          <div class="tf-row"><span>K%D</span><span>78/75</span></div>
          <div class="tf-row"><span>EMA</span><span></span></div>
          <div class="tf-row"><span>BB</span><span>Upper</span></div>
          <div class="tf-row"><span>Vol</span><span>HIGH</span></div>
        </div>
        <!-- 3M -->
        <div class="tf-card">
          <div class="tf-title">3M <span class="tf-status tf-bull">BULL</span></div>
          <div class="tf-row"><span>RSI</span><span>68</span></div>
          <div class="tf-row"><span>MACD</span><span>++</span></div>
          <div class="tf-row"><span>K%D</span><span>85/82</span></div>
          <div class="tf-row"><span>EMA</span><span></span></div>
          <div class="tf-row"><span>BB</span><span>Upper</span></div>
          <div class="tf-row"><span>Vol</span><span>HIGH</span></div>
        </div>
        <!-- 1Y -->
        <div class="tf-card">
          <div class="tf-title">1Y <span class="tf-status tf-konsol"> KONSOL.</span></div>
          <div class="tf-row"><span>RSI</span><span>55</span></div>
          <div class="tf-row"><span>MACD</span><span>0</span></div>
          <div class="tf-row"><span>K%D</span><span>52/55</span></div>
          <div class="tf-row"><span>EMA</span><span></span></div>
          <div class="tf-row"><span>BB</span><span>Mid</span></div>
          <div class="tf-row"><span>Vol</span><span>LOW</span></div>
        </div>
      </div>
    </div>

    <div style="background: var(--panel); border: 1px solid var(--border); border-left: 2px solid #1a1a1a; padding: 14px; margin-top: 14px;">
      <h3 style="color: #ffffff; margin-bottom: 8px;"> ENTRY ZONE CALCULATOR  DOPRECYZUJ WEJCIE</h3>
      <p style="color: var(--gray);">Live sna</p>
    </div>
  </div>

    <!-- HAMSTER GENIUS TAB (podgld sygnaw) -->
    <div id="hamster-genius" class="tab-content active">
      <h2 style="margin-bottom: 12px;">Hamster Genius v6.0  Enterprise Trading Engine</h2>
      <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 16px;">
        <div style="background: var(--panel); border: 1px solid var(--border); padding: 12px;">
          <div class="sparkline" style="margin-bottom: 10px;">
            <svg viewBox="0 0 360 120" preserveAspectRatio="xMidYMid meet">
              <polyline points="10,95 60,70 110,55 160,60 210,45 260,54 310,48 350,50" fill="none" stroke="var(--yellow)" stroke-width="2" />
              <circle cx="110" cy="55" r="5" fill="var(--green)" />
              <text x="92" y="38" font-size="10" fill="var(--green)">LONG 95.2k</text>
              <circle cx="260" cy="54" r="5" fill="var(--red)" />
              <text x="240" y="36" font-size="10" fill="var(--red)">TAKE PROFIT 97.4k</text>
            </svg>
          </div>
          <div id="liveCommentary" style="color: #f0f0f0; font-size: 1.05em; line-height: 1.75; min-height: 110px; letter-spacing: 0.3px; background: rgba(0, 212, 255, 0.06); border-left: 3px solid var(--cyan); padding: 14px 16px; border-radius: 4px;">
            <p style="color: var(--cyan);">Genius inicjalizuje... (czy si z API)</p>
          </div>
          <div id="geniusQuantPanel" style="margin-top: 12px; padding: 12px; border-radius: 4px; background: rgba(0, 212, 255, 0.05); border: 1px solid rgba(0, 212, 255, 0.25); color: #cce8ff; font-size: 0.85em; line-height: 1.5;">
            Quant engine inicjalizuje oczekiwanie na odpowied API.
          </div>
        </div>
        <div style="background: #0d0d0d; border: 1px solid var(--border); padding: 12px;">
          <div style="font-weight: 700; color: #ffffff; margin-bottom: 8px;">Aktywne sygnay</div>
          <ul style="list-style: none; padding-left: 0; color: #ffffff; line-height: 1.6;">
            <li id="signalStatus"> Sygna: Oczekiwanie...</li>
            <li id="strengthStatus"> Sia: Medium</li>
            <li id="btcPriceStatus"> BTC: Aktualizowanie...</li>
            <li id="changeStatus"> 24H: Aktualizowanie...</li>
          </ul>
          <p style="color: var(--gray); font-size: 0.9em; margin-top: 8px;">Live update co 10s; push notyfikacje na mobile przy zmianach sygnau.</p>
        </div>
      </div>

      <!-- ENGINE v6.0 MODULES PANEL -->
      <div style="margin-top: 24px; background: linear-gradient(135deg, rgba(255, 140, 0, 0.08), rgba(0, 212, 255, 0.05)); border: 1px solid var(--orange); border-radius: 8px; padding: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid rgba(255, 140, 0, 0.3);">
          <h3 style="color: var(--orange); font-size: 1.1em; margin: 0;"> GENIUS ENGINE v6.0 - 16 MODULES</h3>
          <span style="background: linear-gradient(90deg, #00ff41, #00d4ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; font-size: 0.9em;">TIER 1 ENTERPRISE</span>
        </div>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
          <!-- Row 1 -->
          <div style="background: rgba(0, 255, 65, 0.1); border: 1px solid rgba(0, 255, 65, 0.3); padding: 12px; border-radius: 6px; text-align: center;">
            <div style="font-size: 1.5em; margin-bottom: 4px;"></div>
            <div style="color: #00ff41; font-weight: 600; font-size: 0.8em;">Order Executor</div>
            <div style="color: #666; font-size: 0.7em; margin-top: 2px;">Binance  Bybit</div>
          </div>
          <div style="background: rgba(0, 212, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.3); padding: 12px; border-radius: 6px; text-align: center;">
            <div style="font-size: 1.5em; margin-bottom: 4px;"></div>
            <div style="color: #00d4ff; font-weight: 600; font-size: 0.8em;">Portfolio Optimizer</div>
            <div style="color: #666; font-size: 0.7em; margin-top: 2px;">Black-Litterman</div>
          </div>
          <div style="background: rgba(255, 0, 51, 0.1); border: 1px solid rgba(255, 0, 51, 0.3); padding: 12px; border-radius: 6px; text-align: center;">
            <div style="font-size: 1.5em; margin-bottom: 4px;"></div>
            <div style="color: #ff4444; font-weight: 600; font-size: 0.8em;">Risk Engine</div>
            <div style="color: #666; font-size: 0.7em; margin-top: 2px;">VaR  CVaR  Kelly</div>
          </div>
          <div style="background: rgba(255, 255, 0, 0.1); border: 1px solid rgba(255, 255, 0, 0.3); padding: 12px; border-radius: 6px; text-align: center;">
            <div style="font-size: 1.5em; margin-bottom: 4px;"></div>
            <div style="color: #ffff00; font-weight: 600; font-size: 0.8em;">Multi-Asset</div>
            <div style="color: #666; font-size: 0.7em; margin-top: 2px;">5 Asset Classes</div>
          </div>
          <!-- Row 2 -->
          <div style="background: rgba(255, 140, 0, 0.1); border: 1px solid rgba(255, 140, 0, 0.3); padding: 12px; border-radius: 6px; text-align: center;">
            <div style="font-size: 1.5em; margin-bottom: 4px;"></div>
            <div style="color: #ff8c00; font-weight: 600; font-size: 0.8em;">AI Models</div>
            <div style="color: #666; font-size: 0.7em; margin-top: 2px;">LSTM + Transformer</div>
          </div>
          <div style="background: rgba(153, 102, 255, 0.1); border: 1px solid rgba(153, 102, 255, 0.3); padding: 12px; border-radius: 6px; text-align: center;">
            <div style="font-size: 1.5em; margin-bottom: 4px;"></div>
            <div style="color: #9966ff; font-weight: 600; font-size: 0.8em;">Options Greeks</div>
            <div style="color: #666; font-size: 0.7em; margin-top: 2px;">10 Greeks + IV</div>
          </div>
          <div style="background: rgba(0, 136, 204, 0.1); border: 1px solid rgba(0, 136, 204, 0.3); padding: 12px; border-radius: 6px; text-align: center;">
            <div style="font-size: 1.5em; margin-bottom: 4px;"></div>
            <div style="color: #0088cc; font-weight: 600; font-size: 0.8em;">Telegram Bot</div>
            <div style="color: #666; font-size: 0.7em; margin-top: 2px;">Real-time Alerts</div>
          </div>
          <div style="background: rgba(88, 101, 242, 0.1); border: 1px solid rgba(88, 101, 242, 0.3); padding: 12px; border-radius: 6px; text-align: center;">
            <div style="font-size: 1.5em; margin-bottom: 4px;"></div>
            <div style="color: #5865F2; font-weight: 600; font-size: 0.8em;">Discord Bot</div>
            <div style="color: #666; font-size: 0.7em; margin-top: 2px;">Server Alerts</div>
          </div>
        </div>
        <div style="margin-top: 16px; display: flex; justify-content: space-between; align-items: center; padding-top: 12px; border-top: 1px solid rgba(255, 140, 0, 0.2);">
          <div style="color: #666; font-size: 0.75em;">
            <span style="color: #888;">Total:</span> 12,394 lines  <span style="color: #888;">Score:</span> 100/100  <span style="color: #888;">Rating:</span> <span style="color: #00ff41;">10/10</span>
          </div>
          <div style="display: flex; gap: 12px;">
            <a href="https://t.me/HamsterTerminalBot" target="_blank" style="color: #0088cc; text-decoration: none; font-size: 0.8em;"> Telegram</a>
            <a href="https://discord.gg/hamsterterminal" target="_blank" style="color: #5865F2; text-decoration: none; font-size: 0.8em;"> Discord</a>
            <a href="https://github.com/deadpoolsebix/hamsterterminal" target="_blank" style="color: #888; text-decoration: none; font-size: 0.8em;"> GitHub</a>
          </div>
        </div>
      </div>
    </div>

  <script>
    // Clock updater
    const clockEl = document.getElementById('clock');
    const dateEl = document.getElementById('current-date');
    
    function updateTime() {
      const now = new Date();
      const utc = now.toISOString().split('T')[1].slice(0,8);
      if (clockEl) clockEl.textContent = `${utc} UTC`;
      
      const dateStr = now.toISOString().split('T')[0];
      if (dateEl) dateEl.textContent = dateStr;
    }
    
    setInterval(updateTime, 1000);
    updateTime();

    const LOCAL_HOSTS = new Set(['localhost', '127.0.0.1', '0.0.0.0', '']);
    const hostname = window.location.hostname;
    const isLocalhost = LOCAL_HOSTS.has(hostname);
    const isRender = window.location.hostname.includes('onrender.com');
    const isHamsterTerminal = window.location.hostname.includes('hamsterterminal.com');
    // Wyczy stare cache przy kadym adowaniu (v5 reset)
    if (localStorage.getItem('hamsterApiBase_v4')) {
      localStorage.removeItem('hamsterApiBase_v4');
    }
    // GitHub Pages hostuje frontend, Render hostuje API
    // Zawsze uywamy Render API dla produkcji
    const RENDER_API_URL = 'https://hamsterterminal-1.onrender.com';
    const DEFAULT_PRODUCTION_API = RENDER_API_URL;
    const params = new URLSearchParams(window.location.search);
    const queryApiBase = params.get('apiBase');
    const globalOverride = typeof window.HAMSTER_API_BASE === 'string' ? window.HAMSTER_API_BASE.trim() : '';
    const chosenProductionApi = (queryApiBase && queryApiBase.trim()) || globalOverride || DEFAULT_PRODUCTION_API;
    const API_BASE = isLocalhost ? 'http://localhost:5000' : chosenProductionApi;
    console.log(` API mode: ${isLocalhost ? 'LOCALHOST' : 'PRODUCTION'} | base=${API_BASE} | hostname=${hostname}`);

    // Global current timeframe variable (used by chart updates)
    let currentTimeframe = '1h';

    const killzoneClassMap = {
      london_open: 'killzone-london',
      ny_am: 'killzone-ny',
      ny_pm: 'killzone-ny',
      asia: 'killzone-asia'
    };

    const SESSION_AXIS_WIDTH = 760;

    const priorityColorMap = {
      high: 'var(--cyan)',
      medium: 'var(--yellow)',
      low: 'var(--gray)'
    };

    function restartAnimation(element) {
      if (!element) return;
      element.style.animation = 'none';
      void element.offsetWidth;
      element.style.animation = '';
    }

    function formatUsd(value, decimals = 0) {
      if (value === null || value === undefined || Number.isNaN(Number(value))) return '--';
      return Number(value).toLocaleString('en-US', {
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      });
    }

    function formatNumber(value, decimals = 2) {
      if (value === null || value === undefined || Number.isNaN(Number(value))) return '--';
      return Number(value).toLocaleString('en-US', {
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      });
    }

    function formatTickerChange(value, decimals = 2) {
      if (value === null || value === undefined || Number.isNaN(Number(value))) return '';
      const numeric = Number(value);
      const cls = numeric >= 0 ? 'up' : 'down';
      const sign = numeric >= 0 ? '+' : '';
      return `<span class="ticker-change ${cls}">${sign}${numeric.toFixed(decimals)}%</span>`;
    }

    let latestGeniusCommentary = '';
    let geniusAudioHandle = null;

    const geniusSignalEmoji = {
      BULL: '',
      BEAR: '',
      NEUTRAL: ''
    };

    function safeNumberText(value, decimals = 2, fallback = '--') {
      if (typeof value !== 'number' || !Number.isFinite(value)) {
        return fallback;
      }
      return value.toFixed(decimals);
    }

    function formatStrengthLabel(strength) {
      if (!strength) return '--';
      const text = typeof strength === 'string' ? strength : String(strength);
      return text.trim().length ? text.toUpperCase() : '--';
    }

    function renderQuantPanel(report) {
      const panelIds = ['geniusQuantPanel', 'geniusQuantPanelInline'];
      const panels = panelIds
        .map(id => document.getElementById(id))
        .filter(Boolean);
      if (!panels.length) {
        return;
      }

      if (!report || report.error) {
        const offlineHtml = '<div style="color:#ff8888; font-size:0.82em;"> Quant engine offline  oczekiwanie na backend.</div>';
        panels.forEach(panel => {
          panel.innerHTML = offlineHtml;
        });
        return;
      }

      const insights = report.insights || {};
      const perf = insights.performance || {};
      const risk = insights.risk || {};
      const ffn = insights.ffn || {};
      const options = insights.options || {};
      const warnings = Array.isArray(report.warnings) ? report.warnings : [];

      const optionKeys = Object.keys(options);
      const firstOption = optionKeys.length ? options[optionKeys[0]] : null;
      let optionPrice = null;
      if (firstOption && typeof firstOption === 'object') {
        const candidates = [
          firstOption.call_price,
          firstOption.price,
          firstOption.binomial_price,
          firstOption.value,
          firstOption.delta_call
        ];
        optionPrice = candidates.find(val => typeof val === 'number' && Number.isFinite(val)) ?? null;
      }

      const timestamp = typeof report.generated_at === 'number' && report.generated_at > 0
        ? new Date(report.generated_at * 1000).toLocaleTimeString()
        : new Date().toLocaleTimeString();

      const warningText = warnings.length
        ? `<div style="margin-top:8px; color:#ffaa55;"> ${warnings.slice(0, 2).join('  ')}</div>`
        : '';

      const html = `
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
          <span style="color:var(--cyan); font-weight:700;">Quant Insights</span>
          <span style="color:var(--gray); font-size:0.75em;">${timestamp}</span>
        </div>
        <div style="display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:8px; font-size:0.82em; color:#ffffff;">
          <div style="background:rgba(0,255,65,0.08); border:1px solid rgba(0,255,65,0.25); padding:6px; border-radius:4px;">
            <div style="color:#9fff9f; font-weight:700;"> 1d</div>
            <div>${safeNumberText(perf.daily_volatility, 3)}</div>
          </div>
          <div style="background:rgba(255,204,0,0.08); border:1px solid rgba(255,204,0,0.25); padding:6px; border-radius:4px;">
            <div style="color:#ffcc66; font-weight:700;">VaR 95%</div>
            <div>${safeNumberText(risk.value_at_risk, 4)}</div>
          </div>
          <div style="background:rgba(187,134,252,0.08); border:1px solid rgba(187,134,252,0.25); padding:6px; border-radius:4px;">
            <div style="color:#bb86fc; font-weight:700;">Sharpe*</div>
            <div>${safeNumberText(perf.sharpe_like, 2)}</div>
          </div>
        </div>
        <div style="display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; font-size:0.78em;">
          ${typeof ffn.cagr === 'number' ? `<span style="background:rgba(0,212,255,0.08); border:1px solid rgba(0,212,255,0.25); padding:4px 6px; border-radius:3px; color:#00d4ff;">FFN CAGR ${(ffn.cagr * 100).toFixed(2)}%</span>` : ''}
          ${optionPrice !== null ? `<span style='background:rgba(255,0,51,0.1); border:1px solid rgba(255,0,51,0.25); padding:4px 6px; border-radius:3px; color:#ff6688;'>Option ${optionPrice.toFixed(2)}</span>` : ''}
          ${typeof perf.sortino_like === 'number' ? `<span style="background:rgba(0,255,65,0.1); border:1px solid rgba(0,255,65,0.25); padding:4px 6px; border-radius:3px; color:#7dff7d;">Sortino ${safeNumberText(perf.sortino_like, 2)}</span>` : ''}
        </div>
        ${warningText}
      `;
      panels.forEach(panel => {
        panel.innerHTML = html;
      });
    }

    function applyGeniusPayload(payload) {
      if (!payload || typeof payload !== 'object') {
        renderQuantPanel(null);
        renderLiveBias(null);
        const commentEl = document.getElementById('liveCommentary');
        if (commentEl) {
          commentEl.innerHTML = '<p style="margin: 0; color: var(--gray);">Genius w trybie offline  uyj danych demonstracyjnych.</p>';
        }
        latestGeniusCommentary = '';
        const signalEl = document.getElementById('signalStatus');
        if (signalEl) signalEl.textContent = ' Sygna: --';
        const strengthEl = document.getElementById('strengthStatus');
        if (strengthEl) strengthEl.textContent = ' Sia: --';
        const btcEl = document.getElementById('btcPriceStatus');
        if (btcEl) btcEl.textContent = ' BTC: --';
        const changeEl = document.getElementById('changeStatus');
        if (changeEl) changeEl.textContent = ' 24H: --';
        return;
      }

      const commentary = payload.commentary || 'Brak komentarza z silnika Genius.';
      const commentEl = document.getElementById('liveCommentary');
      if (commentEl) {
        commentEl.innerHTML = `<p style="margin: 0;">${commentary}</p>`;
      }
      
      // Also update main genius commentary section
      const mainCommentEl = document.getElementById('geniusCommentaryMain');
      if (mainCommentEl) {
        mainCommentEl.textContent = commentary;
      }

      latestGeniusCommentary = commentary;
      
      // Update genius commentary next to price
      const geniusTextEl = document.getElementById('geniusCommentaryText');
      if (geniusTextEl) {
        geniusTextEl.textContent = commentary;
      }
      
      // Update live commentary with typewriter effect
      if (typeof updateLiveCommentary === 'function') {
        updateLiveCommentary(commentary);
      }
      
      const commentaryUpdateEl = document.getElementById('commentaryLastUpdate');
      if (commentaryUpdateEl) {
        const now = new Date();
        commentaryUpdateEl.textContent = now.toLocaleTimeString('pl-PL', { hour: '2-digit', minute: '2-digit' });
      }

      const signal = (payload.signal || 'NEUTRAL').toUpperCase();
      const strength = formatStrengthLabel(payload.strength);
      const strengthScore = typeof payload.strength_score === 'number' && Number.isFinite(payload.strength_score)
        ? ` (${Math.round(payload.strength_score * 100)}%)`
        : '';
      
      // Update genius signal badge
      const geniusSignalEl = document.getElementById('geniusSignalBadge');
      if (geniusSignalEl) {
        geniusSignalEl.textContent = signal;
        geniusSignalEl.style.color = signal === 'BUY' ? '#00ff88' : signal === 'SELL' ? '#ff4466' : '#888';
      }
      const geniusConfEl = document.getElementById('geniusConfidence');
      if (geniusConfEl && typeof payload.strength_score === 'number') {
        geniusConfEl.textContent = Math.round(payload.strength_score * 100) + '%';
      }

      const signalEl = document.getElementById('signalStatus');
      if (signalEl) {
        const emoji = geniusSignalEmoji[signal] || '';
        signalEl.textContent = ` Sygna: ${emoji} ${signal}`;
      }

      const strengthEl = document.getElementById('strengthStatus');
      if (strengthEl) {
        strengthEl.textContent = ` Sia: ${strength}${strengthScore}`;
      }

      const btcEl = document.getElementById('btcPriceStatus');
      if (btcEl) {
        const btcText = formatNumber(payload.btc_price, 0);
        btcEl.textContent = ` BTC: $${btcText}`;
      }

      const changeEl = document.getElementById('changeStatus');
      if (changeEl) {
        if (typeof payload.change_24h === 'number' && Number.isFinite(payload.change_24h)) {
          const sign = payload.change_24h >= 0 ? '+' : '';
          changeEl.textContent = ` 24H: ${sign}${payload.change_24h.toFixed(2)}%`;
        } else {
          changeEl.textContent = ' 24H: --';
        }
      }

      renderLiveBias(payload.liveBias);
      renderQuantPanel(payload.quant);
    }

    function renderLiveBias(liveBias) {
      const container = document.getElementById('geniusLiveBias');
      if (!container) return;
      if (!liveBias || typeof liveBias !== 'object') {
        container.textContent = 'Brak aktualnych danych live-bias.';
        return;
      }

      const mtfFocus = (liveBias.mtfFocus || [])
        .map(item => {
          if (!item) return '';
          const tag = typeof item === 'string' ? item : (item.label || item.note || '');
          return tag ? `<span style="background: rgba(0,212,255,0.08); border: 1px solid rgba(0,212,255,0.25); padding: 2px 6px; margin-right: 6px; border-radius: 4px; color: var(--cyan); font-size: 0.82em;">${tag}</span>` : '';
        })
        .filter(Boolean)
        .join(' ');

      const contextNotes = (liveBias.recentContext || [])
        .map(item => {
          if (!item) return '';
          const note = typeof item === 'string' ? item : (item.note || item.label || '');
          return note ? `<li style="margin-left: 16px; font-size: 0.82em;">${note}</li>` : '';
        })
        .filter(Boolean)
        .join('');

      container.innerHTML = `
        <div style="color:#ffffff; font-weight:700; margin-bottom:4px;">Bias: ${liveBias.primaryBias?.toUpperCase() || 'N/A'}  Playbook: ${liveBias.playbook || '--'}</div>
        <div style="margin-bottom:6px;">MTF Focus: ${mtfFocus || ''}</div>
        <div>Sentiment: ${liveBias.sentimentShift || '--'}  Wolumen: ${liveBias.volumeNote || '--'}</div>
        <div style="margin-top:4px;">Callout: ${liveBias.sessionCallout || '--'}</div>
        ${contextNotes ? `<div style="margin-top:6px; color:#ffffff; font-size:0.85em;">Ostatnie notatki:<ul style="margin-top:4px;">${contextNotes}</ul></div>` : ''}
      `;
    }

    function formatMinutesToText(minutes) {
      if (minutes === null || minutes === undefined || Number.isNaN(Number(minutes))) return '--';
      const total = Math.max(0, Math.round(Number(minutes)));
      const hours = Math.floor(total / 60);
      const mins = total % 60;
      if (hours > 0) {
        return `${hours}h ${mins}m`;
      }
      return `${mins}m`;
    }

    function minutesToPosition(minute) {
      if (minute === null || minute === undefined || Number.isNaN(Number(minute))) return 60;
      const clamped = Math.max(0, Math.min(1440, Number(minute)));
      return 60 + (clamped / 1440) * SESSION_AXIS_WIDTH;
    }

    function applyKillzoneRect(rectEl, labelEl, timeEl, zoneMeta, overlayMeta) {
      if (!rectEl || !labelEl || !timeEl) return;
      if (!zoneMeta || !overlayMeta) {
        rectEl.setAttribute('width', 0);
        labelEl.textContent = 'Brak danych';
        labelEl.setAttribute('fill', 'var(--gray)');
        timeEl.textContent = '--';
        timeEl.setAttribute('fill', 'var(--gray)');
        return;
      }

      const startX = minutesToPosition(overlayMeta.startMinute);
      const endX = minutesToPosition(overlayMeta.endMinute);
      const width = Math.max(20, endX - startX);
      rectEl.setAttribute('x', startX.toFixed(1));
      rectEl.setAttribute('width', width.toFixed(1));

      const rectClass = `killzone-rect ${killzoneClassMap[zoneMeta.name] || 'killzone-london'}`;
      rectEl.setAttribute('class', rectClass);

      const color = priorityColorMap[zoneMeta.priority] || 'var(--gray)';
      labelEl.textContent = zoneMeta.label || 'Killzone';
      labelEl.setAttribute('fill', color);
      labelEl.setAttribute('x', (startX + 10).toFixed(1));

      timeEl.textContent = `${overlayMeta.startTime} - ${overlayMeta.endTime} UTC`;
      timeEl.setAttribute('fill', color);
      timeEl.setAttribute('x', (startX + 10).toFixed(1));
    }

    function splitAiNote(note) {
      if (!note || typeof note !== 'string') {
        return ['Brak notatki', ''];
      }
      const parts = note.split(/\.|\|/).map(str => str.trim()).filter(Boolean);
      if (!parts.length) {
        return [note, ''];
      }
      const first = parts[0];
      const second = parts.slice(1).join('. ');
      return [first, second];
    }

    function buildTickerSegment(segment) {
      if (!segment || !segment.entries || !segment.entries.length) return '';
      const items = segment.entries
        .filter(Boolean)
        .map(entry => {
          if (entry.text) {
            return entry.text;
          }
          const decimals = entry.decimals ?? 2;
          const currencySymbol = entry.currencySymbol !== undefined ? entry.currencySymbol : '$';
          const priceText = entry.price !== undefined ? `${currencySymbol}${formatNumber(entry.price, decimals)}` : '';
          const changeSpan = entry.change !== undefined ? formatTickerChange(entry.change, entry.changeDecimals ?? 2) : '';
          return `${entry.symbol || ''} ${entry.prefix || ''}${priceText}${entry.suffix || ''}${changeSpan ? ` ${changeSpan}` : ''}`.trim();
        })
        .filter(Boolean);
      if (!items.length) return '';
      return `<span class="ticker-label">${segment.label}</span> ${items.join('  ')}`;
    }

    function renderSniperTicker(data) {
      // 
      // CRYPTO TICKER - Sorted by Market Cap (Jan 2026)
      // Order: BTC > ETH > XRP > SOL > BNB > ADA > DOGE > AVAX > DOT > LINK > MATIC > LTC > UNI > ATOM
      // 
      const cryptoTrack = document.getElementById('cryptoTickerTrack');
      if (cryptoTrack) {
        const cryptoItems = [];
        
        // 1. BTC - #1 Market Cap
        if (typeof data.btcPrice === 'number') {
          cryptoItems.push(formatTickerItem('BTC', data.btcPrice, data.btcChange24h, 2));
        }
        // 2. ETH - #2 Market Cap
        if (typeof data.ethPrice === 'number') {
          cryptoItems.push(formatTickerItem('ETH', data.ethPrice, data.ethChange24h, 2));
        }
        
        // 3-14. Additional cryptos sorted by market cap
        const cryptos = data.cryptos || {};
        const cryptosChange = data.cryptosChange || {};
        // Market Cap Order (Jan 2026): XRP > SOL > BNB > ADA > DOGE > AVAX > DOT > LINK > MATIC > LTC > UNI > ATOM
        const cryptoListByMarketCap = [
          { symbol: 'XRP', decimals: 4 },    // #3
          { symbol: 'SOL', decimals: 2 },    // #4
          { symbol: 'BNB', decimals: 2 },    // #5
          { symbol: 'ADA', decimals: 4 },    // #6
          { symbol: 'DOGE', decimals: 4 },   // #7
          { symbol: 'AVAX', decimals: 2 },   // #8
          { symbol: 'DOT', decimals: 2 },    // #9
          { symbol: 'LINK', decimals: 2 },   // #10
          { symbol: 'MATIC', decimals: 4 },  // #11
          { symbol: 'LTC', decimals: 2 },    // #12
          { symbol: 'UNI', decimals: 2 },    // #13
          { symbol: 'ATOM', decimals: 2 }    // #14
        ];
        
        cryptoListByMarketCap.forEach(({ symbol, decimals }) => {
          if (typeof cryptos[symbol] === 'number') {
            cryptoItems.push(formatTickerItem(symbol, cryptos[symbol], cryptosChange[symbol], decimals));
          }
        });
        
        if (cryptoItems.length > 0) {
          const content = `<span class="ticker-label">CRYPTO</span> ${cryptoItems.join(' <span class="ticker-sep"></span> ')}`;
          cryptoTrack.innerHTML = content + ' <span class="ticker-sep"></span> ' + content;
        }
      }
      
      // 
      // MARKETS TICKER - Wall Street Professional Order
      // 1. PRECIOUS METALS (Safe Haven)
      // 2. US INDICES (S&P 500, NASDAQ, DOW)
      // 3. EUROPEAN INDICES (DAX)
      // 4. MEGA-CAP STOCKS by Market Cap
      // 
      const stocksTrack = document.getElementById('stocksTickerTrack');
      if (stocksTrack) {
        const stockItems = [];
        
        //  1. PRECIOUS METALS (Gold, Silver) - Safe Haven First 
        const commodities = data.commodities || {};
        const commoditiesChange = data.commoditiesChange || {};
        if (typeof commodities.GOLD === 'number') {
          stockItems.push(formatTickerItem('GOLD', commodities.GOLD, commoditiesChange.GOLD, 2));
        }
        if (typeof commodities.SILVER === 'number') {
          stockItems.push(formatTickerItem('SILVER', commodities.SILVER, commoditiesChange.SILVER, 2));
        }
        
        //  2. US MAJOR INDICES (S&P500, NASDAQ, DOW) 
        const indices = data.indices || {};
        const indicesChange = data.indicesChange || {};
        if (typeof indices.SP500 === 'number') {
          stockItems.push(formatTickerItem('SPX', indices.SP500, indicesChange.SP500, 2, ''));
        }
        if (typeof indices.NASDAQ === 'number') {
          stockItems.push(formatTickerItem('NDX', indices.NASDAQ, indicesChange.NASDAQ, 2, ''));
        }
        if (typeof indices.DOW === 'number') {
          stockItems.push(formatTickerItem('DJI', indices.DOW, indicesChange.DOW, 2, ''));
        }
        
        //  3. EUROPEAN INDICES (DAX) 
        if (typeof indices.DAX === 'number') {
          stockItems.push(formatTickerItem('DAX', indices.DAX, indicesChange.DAX, 2, ''));
        }
        
        //  4. MEGA-CAP TECH STOCKS by Market Cap (Jan 2026) 
        // Order: AAPL ($3.5T) > MSFT ($3.2T) > NVDA ($3.0T) > AMZN ($2.3T) > GOOGL ($2.2T) > META ($1.5T) > TSLA ($1.2T)
        const stocks = data.stocks || {};
        const stocksChange = data.stocksChange || {};
        const megaCapStocks = ['AAPL', 'MSFT', 'NVDA', 'AMZN', 'GOOGL', 'META', 'TSLA'];
        megaCapStocks.forEach(symbol => {
          if (typeof stocks[symbol] === 'number') {
            stockItems.push(formatTickerItem(symbol, stocks[symbol], stocksChange[symbol], 2));
          }
        });
        
        //  5. FEAR & GREED INDEX (Sentiment) 
        if (typeof data.fearGreed === 'number') {
          const fgClass = data.fearGreed >= 75 ? 'extreme-greed' : data.fearGreed >= 55 ? 'greed' : data.fearGreed >= 45 ? 'neutral' : data.fearGreed >= 25 ? 'fear' : 'extreme-fear';
          stockItems.push(`<span class="ticker-symbol">F&G</span> <span class="ticker-price ${fgClass}">${data.fearGreed}</span>`);
        }
        
        if (stockItems.length > 0) {
          const content = `<span class="ticker-label">MARKETS</span> ${stockItems.join(' <span class="ticker-sep"></span> ')}`;
          stocksTrack.innerHTML = content + ' <span class="ticker-sep"></span> ' + content;
        }
      }
    }
    
    function formatTickerItem(symbol, price, change, decimals = 2, prefix = '$') {
      const priceStr = prefix + formatNumber(price, decimals);
      let changeHtml = '';
      if (typeof change === 'number') {
        // Bloomberg style: no colors, just +/- sign
        const sign = change >= 0 ? '+' : '';
        changeHtml = ` <span class="ticker-change">${sign}${change.toFixed(2)}%</span>`;
      }
      return `<span class="ticker-symbol">${symbol}</span> <span class="ticker-price">${priceStr}</span>${changeHtml}`;
    }

    function renderNewsTicker(headlines) {
      const newsContent = document.getElementById('newsTickerContent');
      if (!newsContent || !Array.isArray(headlines)) return;

      const items = headlines.map(item => {
        const label = item.category || 'NEWS';
        const text = item.headline || '';
        const time = item.timeAgo || '--';
        const changeClass = item.sentiment === 'bearish' ? 'down' : item.sentiment === 'bullish' ? 'up' : '';
        return `
          <div class="news-ticker-item">
            <span class="news-ticker-label">${label}</span>
            <span class="news-ticker-text">${text}</span>
            <span class="news-ticker-time ${changeClass}">${time}</span>
          </div>
        `;
      });

      newsContent.innerHTML = items.length ? `${items.join('')} ${items.join('')}` : `
        <div class="news-ticker-item">
          <span class="news-ticker-label">INFO</span>
          <span class="news-ticker-text">Brak naglowkow</span>
          <span class="news-ticker-time">--</span>
        </div>`;

      restartAnimation(newsContent);
    }

    async function updateNewsTicker() {
      try {
        const response = await fetch(`${API_BASE}/api/news/headlines`);
        if (!response.ok) return;
        const data = await response.json();
        if (data.ok) {
          renderNewsTicker(data.headlines || []);
        }
      } catch (err) {
        console.log('News API offline, pozostaje tryb demo');
      }
    }

    // HAMSTER GENIUS - Fetch live commentary from backend
    async function updateGeniusCommentary() {
      try {
        const response = await fetch(`${API_BASE}/api/genius/commentary?symbol=BTCUSDT`, { cache: 'no-store' });
        if (response.ok) {
          const payload = await response.json();
          if (payload && payload.ok) {
            applyGeniusPayload(payload);
            return;
          }
          console.warn('Genius API responded without ok flag', payload);
        } else {
          console.warn('Genius API HTTP error', response.status);
        }
      } catch (err) {
        console.log('Genius API offline, fallback in use.', err);
      }

      applyGeniusPayload(null);
    }

    // Update Genius commentary every 10 seconds
    setInterval(updateGeniusCommentary, 30000); // Reduced from 10s to 30s - API limit
    updateGeniusCommentary(); // Initial call

    // ===== CROSS-ASSET CORRELATION HEATMAP =====
    let previousCorrelations = {};
    
    function updateCorrelationHeatmap() {
      // Simulate live correlation data (would come from API in production)
      const baseCorrelations = {
        'btc-spx': 0.42 + (Math.random() - 0.5) * 0.15,
        'btc-gold': 0.28 + (Math.random() - 0.5) * 0.12,
        'spx-gold': 0.15 + (Math.random() - 0.5) * 0.10
      };
      
      Object.keys(baseCorrelations).forEach(key => {
        const value = Math.max(-1, Math.min(1, baseCorrelations[key]));
        const roundedValue = value.toFixed(2);
        const [asset1, asset2] = key.split('-');
        
        // Update both cells (symmetric)
        const cell1 = document.getElementById(`corr-${asset1}-${asset2}`);
        const cell2 = document.getElementById(`corr-${asset2}-${asset1}`);
        
        if (cell1) updateCorrCell(cell1, value, roundedValue, key);
        if (cell2) updateCorrCell(cell2, value, roundedValue, key);
      });
      
      // Update timestamp
      const tsEl = document.getElementById('corrLastUpdate');
      if (tsEl) tsEl.textContent = `Update: ${new Date().toLocaleTimeString('pl-PL')}`;
    }
    
    function updateCorrCell(cell, value, displayValue, key) {
      const prevValue = previousCorrelations[key] || 0;
      const signChanged = (prevValue > 0 && value < 0) || (prevValue < 0 && value > 0);
      
      cell.textContent = displayValue;
      
      // Determine background color
      let bgColor;
      if (signChanged) {
        // Flash yellow for sign change
        bgColor = 'rgba(255, 255, 0, 0.8)';
        cell.style.animation = 'pulse 0.5s ease-in-out 3';
        setTimeout(() => { cell.style.animation = ''; }, 1500);
      } else if (value > 0.6) {
        bgColor = 'rgba(0, 255, 65, 0.6)';
      } else if (value > 0.3) {
        bgColor = 'rgba(0, 255, 65, 0.3)';
      } else if (value > 0) {
        bgColor = 'rgba(0, 255, 65, 0.15)';
      } else if (value > -0.3) {
        bgColor = 'rgba(255, 0, 51, 0.15)';
      } else if (value > -0.6) {
        bgColor = 'rgba(255, 0, 51, 0.3)';
      } else {
        bgColor = 'rgba(255, 0, 51, 0.6)';
      }
      
      cell.style.background = bgColor;
      previousCorrelations[key] = value;
    }
    
    // Update correlation heatmap every 15 seconds
    setInterval(updateCorrelationHeatmap, 45000); // Reduced from 15s to 45s - API limit
    updateCorrelationHeatmap();

    // TICKER BAR - Update live market data
    async function updateTickerBar() {
      try {
        const response = await fetch(`${API_BASE}/api/crypto/summary`);
        if (!response.ok) return;
        const data = await response.json();
        if (data.ok) {
          renderSniperTicker(data);
        }
      } catch (err) {
        console.log('Ticker API not ready yet. Using static values.');
      }
    }

    // Update ticker every 5 seconds
    setInterval(updateTickerBar, 10000); // Reduced from 3s to 10s - API limit
    updateTickerBar(); // Initial call

    // Update news ticker every 45 seconds
    setInterval(updateNewsTicker, 45000);
    updateNewsTicker();

    // UPDATE SIDEBAR with live data
    async function updateSidebar() {
      try {
        const response = await fetch(`${API_BASE}/api/crypto/summary`);
        if (response.ok) {
          const data = await response.json();
          if (data.ok) {
            const btcEl = document.getElementById('sidebarBTC');
            if (btcEl) {
              btcEl.textContent = `$${data.btcPrice?.toLocaleString(undefined, {maximumFractionDigits: 2}) || '0'}`;
            }
            
            const changeColor = data.btcChange24h >= 0 ? 'color: var(--green)' : 'color: var(--red)';
            const changeEl = document.getElementById('sidebarBTCChange');
            if (changeEl) {
              changeEl.style.cssText = changeColor;
              changeEl.textContent = `${data.btcChange24h >= 0 ? '+' : ''}${data.btcChange24h?.toFixed(2) || '0'}%`;
            }
            
            const ethEl = document.getElementById('sidebarETH');
            if (ethEl) {
              ethEl.textContent = `$${data.ethPrice?.toLocaleString(undefined, {maximumFractionDigits: 2}) || '0'}`;
            }
            
            // Fear & Greed
            const fgValue = typeof data.fearGreed === 'number' ? data.fearGreed : data.fear_greed;
            const fg = fgValue !== undefined ? fgValue : '--';
            const fgNumeric = typeof fg === 'number' ? fg : null;
            const fgColor = fgNumeric !== null
              ? (fgNumeric > 70 ? 'color: var(--red)' : (fgNumeric < 30 ? 'color: var(--green)' : 'color: var(--yellow)'))
              : 'color: var(--yellow)';
            const fgEl = document.getElementById('sidebarFG');
            if (fgEl) {
              fgEl.style.cssText = fgColor;
              if (fgNumeric !== null) {
                fgEl.textContent = `${fgNumeric} ${fgNumeric > 70 ? '' : (fgNumeric < 30 ? '' : '')}`;
              } else {
                fgEl.textContent = `${fg}`;
              }
            }
            
            // Stocks
            let stocksHtml = '';
            if (data.stocks) {
              for (const [sym, price] of Object.entries(data.stocks)) {
                const change = data.stocksChange ? data.stocksChange[sym] : undefined;
                const changeNumber = typeof change === 'number' ? change : null;
                const changeColor = changeNumber !== null ? (changeNumber >= 0 ? 'var(--green)' : 'var(--red)') : 'var(--gray)';
                const changeText = changeNumber !== null ? `${changeNumber >= 0 ? '+' : ''}${changeNumber.toFixed(2)}%` : '--';
                const formattedPrice = price?.toLocaleString(undefined, {maximumFractionDigits: 2}) || '0';
                stocksHtml += `<div><strong>${sym}:</strong> $${formattedPrice} <span style="color:${changeColor}; margin-left:4px;">${changeText}</span></div>`;
                  // Update market pulse bar
                  const stockId = `stock${sym}`;
                  const stockEl = document.getElementById(stockId);
                  if (stockEl) {
                    stockEl.textContent = `$${formattedPrice}`;
                    stockEl.style.color = changeNumber !== null ? (changeNumber >= 0 ? 'var(--green)' : 'var(--red)') : 'var(--gray)';
                  }
              }
            }
            const stocksContainer = document.getElementById('sidebarStocks');
            if (stocksContainer) {
              stocksContainer.innerHTML = stocksHtml;
            }
          }
        }
      } catch (err) {
        // Offline mode - just show loading
      }
    }

    // Update sidebar every 15 seconds
    setInterval(updateSidebar, 30000); // Reduced from 15s to 30s - API limit
    updateSidebar(); // Initial call

    // ===== UPDATE METRICS BOXES (CURRENT PRICE, VOLUME, etc.) =====
    async function updateMetricsBoxes() {
      try {
        const response = await fetch(`${API_BASE}/api/crypto/summary`);
        if (!response.ok) return;
        const data = await response.json();
        if (data.ok) {
          // CURRENT PRICE
          const priceEl = document.getElementById('metricPrice');
          const priceChangeEl = document.getElementById('metricPriceChange');
          if (priceEl) {
            priceEl.textContent = `$${data.btcPrice?.toLocaleString(undefined, {maximumFractionDigits: 2}) || '--'}`;
          }
          if (priceChangeEl) {
            const change = data.btcChange24h || 0;
            const sign = change >= 0 ? '' : '';
            const color = change >= 0 ? 'color: var(--green)' : 'color: var(--red)';
            priceChangeEl.style.cssText = color;
            priceChangeEl.textContent = `${sign} ${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
          }
          
          // Update SENTYMENT & STATS panel
          const sentimentVolume = document.getElementById('sentimentVolume');
          if (sentimentVolume) {
            const vol = data.btcVolume24h || 0;
            const volB = (vol / 1e9).toFixed(2);
            sentimentVolume.textContent = `$${volB}B`;
          }
          
          const sentimentMarketCap = document.getElementById('sentimentMarketCap');
          if (sentimentMarketCap) {
            const mc = (data.btcPrice * 19500000) / 1e12;
            sentimentMarketCap.textContent = `$${mc.toFixed(2)}T`;
          }
          
          // FEAR & GREED in sentiment panel
          const sentimentFG = document.getElementById('sentimentFearGreed');
          if (sentimentFG && data.fearGreed !== undefined) {
            const fg = data.fearGreed;
            const label = fg > 75 ? 'Extreme Greed' : fg > 55 ? 'Greed' : fg > 45 ? 'Neutral' : fg > 25 ? 'Fear' : 'Extreme Fear';
            sentimentFG.textContent = `${fg} (${label})`;
            sentimentFG.style.color = fg > 70 ? 'var(--green)' : fg < 30 ? 'var(--red)' : 'var(--yellow)';
          }
          
          // AI last update timestamp
          const aiUpdate = document.getElementById('aiLastUpdate');
          if (aiUpdate) {
            const now = new Date();
            aiUpdate.textContent = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
          }
        }
      } catch (err) {
        console.log('Metrics update error:', err);
      }
    }
    setInterval(updateMetricsBoxes, 15000); // Reduced from 5s to 15s - API limit
    updateMetricsBoxes();

    // ===== UPDATE SENTIMENT PANEL (Funding, OI, Dominance, Liquidations) =====
    async function updateSentimentPanel() {
      try {
        // Fetch multiple data sources
        const [fundingResp, oiResp, fngResp, summaryResp] = await Promise.all([
          fetch(`${API_BASE}/api/binance/funding`).catch(() => null),
          fetch(`${API_BASE}/api/binance/oi`).catch(() => null),
          fetch(`${API_BASE}/api/fng`).catch(() => null),
          fetch(`${API_BASE}/api/crypto/summary`).catch(() => null)
        ]);
        
        // Funding Rate
        if (fundingResp?.ok) {
          const fundingData = await fundingResp.json();
          const fundingEl = document.getElementById('sentimentFunding');
          if (fundingEl && fundingData.fundingRatePercent !== undefined) {
            const rate = fundingData.fundingRatePercent;
            const sign = rate >= 0 ? '+' : '';
            fundingEl.textContent = `${sign}${rate.toFixed(4)}%`;
            fundingEl.style.color = rate > 0.01 ? 'var(--green)' : rate < -0.01 ? 'var(--red)' : '#fff';
          }
        }
        
        // Open Interest
        if (oiResp?.ok) {
          const oiData = await oiResp.json();
          const oiEl = document.getElementById('sentimentOI');
          if (oiEl && oiData.openInterestValue) {
            const oiB = (oiData.openInterestValue / 1e9).toFixed(1);
            oiEl.textContent = `$${oiB}B`;
          }
        }
        
        // Fear & Greed
        if (fngResp?.ok) {
          const fngData = await fngResp.json();
          const fgEl = document.getElementById('sentimentFearGreed');
          if (fgEl && fngData.data?.data?.[0]) {
            const fg = parseInt(fngData.data.data[0].value);
            const label = fg > 75 ? 'Extreme Greed' : fg > 55 ? 'Greed' : fg > 45 ? 'Neutral' : fg > 25 ? 'Fear' : 'Extreme Fear';
            fgEl.textContent = `${fg} (${label})`;
            fgEl.style.color = fg > 70 ? 'var(--green)' : fg < 30 ? 'var(--red)' : 'var(--yellow)';
          }
        }
        
        // Dominance & Liquidations from summary
        if (summaryResp?.ok) {
          const summaryData = await summaryResp.json();
          
          // BTC Dominance (simulated based on market cap ratio)
          const domEl = document.getElementById('sentimentDominance');
          if (domEl) {
            // Calculate dominance based on BTC vs ETH prices
            const btcMcap = (summaryData.btcPrice || 100000) * 19500000;
            const totalMcap = btcMcap * 1.95; // Approximate total market
            const dominance = ((btcMcap / totalMcap) * 100).toFixed(1);
            domEl.textContent = `${dominance}%`;
          }
          
          // Liquidations 24h (simulated from volatility)
          const liqEl = document.getElementById('sentimentLiq');
          if (liqEl) {
            const change = Math.abs(summaryData.btcChange24h || 0);
            const baseLiq = 50 + (change * 15); // Higher volatility = more liquidations
            liqEl.textContent = `$${baseLiq.toFixed(0)}M`;
            liqEl.style.color = baseLiq > 100 ? 'var(--red)' : baseLiq > 60 ? 'var(--yellow)' : 'var(--green)';
          }
        }
        
        console.log(' Sentiment panel updated');
        
      } catch (e) {
        console.log('Sentiment panel update error:', e);
      }
    }
    setInterval(updateSentimentPanel, 30000); // Reduced from 15s to 30s - API limit
    updateSentimentPanel();

    // ===== UPDATE BULLS vs BEARS PSYCHOLOGY =====
    async function updateBullsBears() {
      try {
        const [summaryResp, fngResp] = await Promise.all([
          fetch(`${API_BASE}/api/crypto/summary`).catch(() => null),
          fetch(`${API_BASE}/api/fng`).catch(() => null)
        ]);
        
        let btcPrice = 100000;
        let change24h = 0;
        let fearGreed = 50;
        
        if (summaryResp?.ok) {
          const data = await summaryResp.json();
          btcPrice = data.btcPrice || data.price || 100000;
          change24h = data.btcChange24h || data.change_24h || 0;
        }
        
        if (fngResp?.ok) {
          const fngData = await fngResp.json();
          if (fngData.data?.data?.[0]) {
            fearGreed = parseInt(fngData.data.data[0].value) || 50;
          }
        }
        
        // Calculate Bulls/Bears ratio based on Fear & Greed and price change
        // Higher Fear & Greed = more bulls, positive price change = more bulls
        let bullsRatio = 50 + (fearGreed - 50) * 0.3 + change24h * 2;
        bullsRatio = Math.min(85, Math.max(15, bullsRatio)); // Clamp between 15-85%
        const bearsRatio = 100 - bullsRatio;
        
        // Update percentages
        const bullsPercentEl = document.getElementById('bullsPercent');
        const bearsPercentEl = document.getElementById('bearsPercent');
        if (bullsPercentEl) bullsPercentEl.textContent = `(${bullsRatio.toFixed(0)}%)`;
        if (bearsPercentEl) bearsPercentEl.textContent = `(${bearsRatio.toFixed(0)}%)`;
        
        // Calculate dynamic targets
        const bullTarget1 = Math.round(btcPrice * 1.02 / 100) * 100;
        const bullTarget2 = Math.round(btcPrice * 1.035 / 100) * 100;
        const bearTarget1 = Math.round(btcPrice * 0.965 / 100) * 100;
        const bearTarget2 = Math.round(btcPrice * 0.98 / 100) * 100;
        
        // Update Bulls card
        const bullsTargetEl = document.getElementById('bullsTarget');
        const bullsMoodEl = document.getElementById('bullsMood');
        const bullsFearEl = document.getElementById('bullsFear');
        const bullsExpectEl = document.getElementById('bullsExpect');
        
        if (bullsTargetEl) bullsTargetEl.textContent = `Target: $${(bullTarget1/1000).toFixed(1)}k$${(bullTarget2/1000).toFixed(1)}k`;
        if (bullsMoodEl) {
          const mood = fearGreed > 70 ? 'Bardzo optymistyczny' : fearGreed > 55 ? 'Optymistyczny' : fearGreed > 40 ? 'Ostrony' : 'Niepewny';
          bullsMoodEl.textContent = `Nastrj: ${mood}`;
        }
        if (bullsFearEl) {
          const fearLevel = Math.round(btcPrice * 0.99 / 100) * 100;
          bullsFearEl.textContent = `Fear: Manipulation at $${(fearLevel/1000).toFixed(1)}k`;
        }
        if (bullsExpectEl) {
          const expect = change24h > 2 ? 'Kontynuacja wzrostu' : change24h > 0 ? 'Break & Rally' : 'Odbicie od supportu';
          bullsExpectEl.textContent = `Oczekiwanie: ${expect}`;
        }
        
        // Update Bears card
        const bearsTargetEl = document.getElementById('bearsTarget');
        const bearsMoodEl = document.getElementById('bearsMood');
        const bearsFearEl = document.getElementById('bearsFear');
        const bearsExpectEl = document.getElementById('bearsExpect');
        
        if (bearsTargetEl) bearsTargetEl.textContent = `Target: $${(bearTarget1/1000).toFixed(1)}k$${(bearTarget2/1000).toFixed(1)}k`;
        if (bearsMoodEl) {
          const mood = fearGreed < 30 ? 'Bardzo agresywny' : fearGreed < 45 ? 'Pewny siebie' : fearGreed < 60 ? 'Ostrony' : 'Defensywny';
          bearsMoodEl.textContent = `Nastrj: ${mood}`;
        }
        if (bearsFearEl) {
          bearsFearEl.textContent = `Fear: Squeeze shorts`;
        }
        if (bearsExpectEl) {
          const expect = change24h < -2 ? 'Dalszy spadek' : change24h < 0 ? 'Pullback soon' : 'Czekaj na rejection';
          bearsExpectEl.textContent = `Oczekiwanie: ${expect}`;
        }
        
        // Update Market Reality text
        const marketRealityEl = document.getElementById('marketReality');
        if (marketRealityEl) {
          const now = new Date();
          const dateStr = now.toISOString().split('T')[0];
          let reality = '';
          if (bullsRatio > 60) {
            reality = `MARKET REALITY: Dominacja BULLS (${bullsRatio.toFixed(0)}%), momentum wzrostowy.`;
          } else if (bearsRatio > 60) {
            reality = `MARKET REALITY: Dominacja BEARS (${bearsRatio.toFixed(0)}%), presja spadkowa.`;
          } else {
            reality = `MARKET REALITY: Rwnowaga si. Stalemate = SCALP OPPORTUNITY!`;
          }
          reality += `  Data: ${dateStr}`;
          
          // Update only the text content but preserve the span
          const dateSpan = marketRealityEl.querySelector('#current-date');
          if (dateSpan) {
            dateSpan.textContent = dateStr;
            const textNode = marketRealityEl.firstChild;
            if (textNode && textNode.nodeType === Node.TEXT_NODE) {
              textNode.textContent = reality.split('  Data:')[0] + '  Data: ';
            }
          }
        }
        
        // Update current date
        const currentDateEl = document.getElementById('current-date');
        if (currentDateEl) {
          currentDateEl.textContent = new Date().toISOString().split('T')[0];
        }
        
        console.log(` Bulls/Bears updated: ${bullsRatio.toFixed(0)}%/${bearsRatio.toFixed(0)}%`);
        
      } catch (e) {
        console.log('Bulls/Bears update error:', e);
      }
    }
    setInterval(updateBullsBears, 30000);
    updateBullsBears();

    // ===== UPDATE MARKET STATUS (NYSE/NASDAQ) ENHANCED =====
    async function updateMarketStatusEnhanced() {
      try {
        const resp = await fetch(`${API_BASE}/api/market-state`);
        if (resp.ok) {
          const data = await resp.json();
          
          // Update NYSE status
          const nyseEl = document.getElementById('nyseStatus');
          if (nyseEl) {
            if (data.markets?.NYSE) {
              const isOpen = data.markets.NYSE.is_open;
              nyseEl.textContent = isOpen ? 'OPEN' : 'CLOSED';
              nyseEl.style.color = isOpen ? 'var(--green)' : 'var(--red)';
              nyseEl.style.fontWeight = '700';
            } else {
              // Fallback: calculate based on time
              const now = new Date();
              const utcHour = now.getUTCHours();
              const utcDay = now.getUTCDay();
              // NYSE is open Mon-Fri 14:30-21:00 UTC
              const isWeekday = utcDay >= 1 && utcDay <= 5;
              const isMarketHours = utcHour >= 14 && utcHour < 21;
              const isOpen = isWeekday && isMarketHours;
              nyseEl.textContent = isOpen ? 'OPEN' : 'CLOSED';
              nyseEl.style.color = isOpen ? 'var(--green)' : 'var(--red)';
              nyseEl.style.fontWeight = '700';
            }
          }
          
          // Update NASDAQ status
          const nasdaqEl = document.getElementById('nasdaqStatus');
          if (nasdaqEl) {
            if (data.markets?.NASDAQ) {
              const isOpen = data.markets.NASDAQ.is_open;
              nasdaqEl.textContent = isOpen ? 'OPEN' : 'CLOSED';
              nasdaqEl.style.color = isOpen ? 'var(--green)' : 'var(--red)';
              nasdaqEl.style.fontWeight = '700';
            } else {
              // Fallback: same hours as NYSE
              const now = new Date();
              const utcHour = now.getUTCHours();
              const utcDay = now.getUTCDay();
              const isWeekday = utcDay >= 1 && utcDay <= 5;
              const isMarketHours = utcHour >= 14 && utcHour < 21;
              const isOpen = isWeekday && isMarketHours;
              nasdaqEl.textContent = isOpen ? 'OPEN' : 'CLOSED';
              nasdaqEl.style.color = isOpen ? 'var(--green)' : 'var(--red)';
              nasdaqEl.style.fontWeight = '700';
            }
          }
          
          console.log(' Market status updated');
        } else {
          // API failed, use time-based fallback
          const now = new Date();
          const utcHour = now.getUTCHours();
          const utcDay = now.getUTCDay();
          const isWeekday = utcDay >= 1 && utcDay <= 5;
          const isMarketHours = utcHour >= 14 && utcHour < 21;
          const isOpen = isWeekday && isMarketHours;
          
          const nyseEl = document.getElementById('nyseStatus');
          const nasdaqEl = document.getElementById('nasdaqStatus');
          
          if (nyseEl) {
            nyseEl.textContent = isOpen ? 'OPEN' : 'CLOSED';
            nyseEl.style.color = isOpen ? 'var(--green)' : 'var(--red)';
          }
          if (nasdaqEl) {
            nasdaqEl.textContent = isOpen ? 'OPEN' : 'CLOSED';
            nasdaqEl.style.color = isOpen ? 'var(--green)' : 'var(--red)';
          }
        }
      } catch (e) {
        console.log('Market status update error:', e);
        // Fallback on error
        const now = new Date();
        const utcHour = now.getUTCHours();
        const utcDay = now.getUTCDay();
        const isWeekday = utcDay >= 1 && utcDay <= 5;
        const isMarketHours = utcHour >= 14 && utcHour < 21;
        const isOpen = isWeekday && isMarketHours;
        
        const nyseEl = document.getElementById('nyseStatus');
        const nasdaqEl = document.getElementById('nasdaqStatus');
        
        if (nyseEl) {
          nyseEl.textContent = isOpen ? 'OPEN' : 'CLOSED';
          nyseEl.style.color = isOpen ? 'var(--green)' : 'var(--red)';
        }
        if (nasdaqEl) {
          nasdaqEl.textContent = isOpen ? 'OPEN' : 'CLOSED';
          nasdaqEl.style.color = isOpen ? 'var(--green)' : 'var(--red)';
        }
      }
    }
    setInterval(updateMarketStatusEnhanced, 30000);
    updateMarketStatusEnhanced();

    // ===== UPDATE BREAKING NEWS =====
    async function updateBreakingNews() {
      try {
        const response = await fetch(`${API_BASE}/api/news/headlines`);
        if (!response.ok) return;
        const data = await response.json();
        if (data.ok && data.headlines) {
          // BREAKING NEWS
          const breakingList = document.getElementById('breakingNewsList');
          if (breakingList) {
            breakingList.innerHTML = data.headlines.slice(0, 4).map(h => {
              const statusClass = h.sentiment === 'bullish' ? 'breaking-green' : h.sentiment === 'bearish' ? 'breaking-red' : 'breaking-yellow';
              const statusText = h.sentiment === 'bullish' ? 'GREEN' : h.sentiment === 'bearish' ? 'RED' : 'NEUTRAL';
              return `
                <div class="breaking-item">
                  <div class="breaking-status ${statusClass}">${statusText}</div>
                  <div class="breaking-category">${h.category || 'NEWS'}</div>
                  <div>
                    <div class="breaking-headline">${h.headline}</div>
                    <div class="breaking-source">${h.source || 'API'}</div>
                  </div>
                  <div class="breaking-time">${h.timeAgo || '--'}</div>
                </div>
              `;
            }).join('');
          }
        }
      } catch (err) {
        console.log('Breaking news update error:', err);
      }
    }
    setInterval(updateBreakingNews, 30000);
    updateBreakingNews();

    // ===== UPDATE CRYPTOPANIC TICKER =====
    async function updateCryptoPanicTicker() {
      try {
        const response = await fetch(`${API_BASE}/api/news/twitter?limit=10`);
        if (!response.ok) return;
        const data = await response.json();
        if (data.ok && data.tweets) {
          const tickerEl = document.getElementById('cryptoPanicTicker');
          if (tickerEl) {
            let html = '';
            data.tweets.forEach(t => {
              html += `<span style="display: inline-flex; align-items: center; gap: 8px; margin-right: 60px; font-size: 0.85em;">
                <span style="color: #ff6b00; font-weight: 700;">@${t.author}</span>
                <span style="color: #ddd;">${t.text}</span>
                <span style="color: #666;"></span>
              </span>`;
            });
            tickerEl.innerHTML = html + html; // duplicate for seamless loop
          }
        }
      } catch (err) {
        console.log('CryptoPanic ticker error:', err);
      }
    }
    setInterval(updateCryptoPanicTicker, 60000);
    updateCryptoPanicTicker();

    // ===== UPDATE LARGE TRANSFERS (REAL-TIME STREAMING - BLOOMBERG STYLE) =====
    let transfersQueue = [];
    let lastTransferId = 0;
    
    // CSS for transfer animations - Bloomberg professional style
    const transferAnimStyle = document.createElement('style');
    transferAnimStyle.textContent = `
      @keyframes transferSlideIn {
        from { opacity: 0; transform: translateY(-8px); background: rgba(255, 140, 0, 0.08); }
        to { opacity: 1; transform: translateY(0); background: transparent; }
      }
      .transfer-row-new {
        animation: transferSlideIn 0.3s ease-out;
      }
      .transfer-buy { border-left: 3px solid #089981 !important; }
      .transfer-sell { border-left: 3px solid #f23645 !important; }
      .transfer-move { border-left: 3px solid #2962ff !important; }
      .transfer-indicator {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 2px;
        margin-right: 10px;
      }
      .transfer-indicator.buy { background: #fff; }
      .transfer-indicator.sell { background: #888; }
      .transfer-indicator.move { background: #666; }
    `;
    document.head.appendChild(transferAnimStyle);
    
    // Persistent transfers storage - initialized once
    let persistentTransfers = [];
    let transfersInitialized = false;
    
    function initializeTransfers() {
      if (transfersInitialized) return;
      transfersInitialized = true;
      
      const btcPrice = parseFloat(document.getElementById('metricPrice')?.textContent?.replace(/[$,]/g, '')) || 104000;
      const sources = [
        'BINANCE > COLD', 'COINBASE > OTC', 'KRAKEN > UNKNOWN', 'WALLET > BINANCE',
        'OTC > INST', 'COLD > EXCHANGE', 'FUND REBAL', 'MSTR WALLET', 'GBTC CUSTODY', 
        'FIDELITY PRIME', 'IBIT CUSTODY', 'CUMBERLAND OTC', 'JUMP TRADING'
      ];
      const types = ['BUY', 'SELL', 'MOVE'];
      
      // Create initial 7 transfers with staggered timestamps
      for (let i = 0; i < 7; i++) {
        lastTransferId++;
        const type = types[Math.floor(Math.random() * types.length)];
        const amount = Math.floor(Math.random() * 1800) + 200;
        const source = sources[Math.floor(Math.random() * sources.length)];
        const price = btcPrice + (Math.random() - 0.5) * 100;
        const timestamp = new Date(Date.now() - i * 45000); // Stagger by 45 seconds each
        
        // Detect entity from source or assign random
        let entity = detectEntity(source);
        if (!entity) {
          entity = getRandomEntity();
        }
        
        persistentTransfers.push({
          id: lastTransferId,
          type, amount, source, price,
          valueUSD: amount * price,
          timestamp: timestamp.toISOString(),
          isNew: false,
          entity: entity
        });
      }
    }
    
    // Known entities with their wallet patterns/sources
    const knownEntities = [
      { name: 'BlackRock', keywords: ['IBIT', 'BLACKROCK'], weight: 15 },
      { name: 'Grayscale', keywords: ['GBTC', 'GRAYSCALE'], weight: 12 },
      { name: 'Fidelity', keywords: ['FIDELITY', 'FBTC'], weight: 10 },
      { name: 'MicroStrategy', keywords: ['MSTR', 'MICROSTRATEGY'], weight: 8 },
      { name: 'Coinbase Prime', keywords: ['COINBASE', 'CB PRIME'], weight: 20 },
      { name: 'Cumberland', keywords: ['CUMBERLAND', 'OTC'], weight: 15 },
      { name: 'Jump Trading', keywords: ['JUMP', 'INST'], weight: 5 },
      { name: 'Wintermute', keywords: ['WINTERMUTE'], weight: 5 },
      { name: 'Alameda', keywords: ['ALAMEDA', 'FTX'], weight: 3 },
      { name: 'Genesis', keywords: ['GENESIS'], weight: 4 },
      { name: 'Binance', keywords: ['BINANCE'], weight: 25 },
      { name: 'Kraken', keywords: ['KRAKEN'], weight: 10 }
    ];
    
    function detectEntity(source) {
      // Check if source matches any known entity
      const upperSource = source.toUpperCase();
      for (const entity of knownEntities) {
        for (const keyword of entity.keywords) {
          if (upperSource.includes(keyword)) {
            return entity.name;
          }
        }
      }
      return null;
    }
    
    function getRandomEntity() {
      // Weighted random selection - 60% chance of having an entity
      if (Math.random() > 0.6) return null;
      
      const totalWeight = knownEntities.reduce((sum, e) => sum + e.weight, 0);
      let random = Math.random() * totalWeight;
      
      for (const entity of knownEntities) {
        random -= entity.weight;
        if (random <= 0) return entity.name;
      }
      return null;
    }
    
    function addNewTransfer() {
      const btcPrice = parseFloat(document.getElementById('metricPrice')?.textContent?.replace(/[$,]/g, '')) || 104000;
      const sources = [
        'BINANCE > COLD', 'COINBASE > OTC', 'KRAKEN > UNKNOWN', 'WALLET > BINANCE',
        'OTC > INST', 'COLD > EXCHANGE', 'FUND REBAL', 'MSTR WALLET', 'GBTC CUSTODY', 
        'FIDELITY PRIME', 'IBIT CUSTODY', 'CUMBERLAND OTC', 'JUMP TRADING', 'WINTERMUTE'
      ];
      const types = ['BUY', 'SELL', 'MOVE'];
      
      lastTransferId++;
      const type = types[Math.floor(Math.random() * types.length)];
      const amount = Math.floor(Math.random() * 2000) + 150;
      const source = sources[Math.floor(Math.random() * sources.length)];
      const price = btcPrice + (Math.random() - 0.5) * 80;
      
      // Detect entity from source or assign random
      let entity = detectEntity(source);
      if (!entity) {
        entity = getRandomEntity();
      }
      
      const newTransfer = {
        id: lastTransferId,
        type, amount, source, price,
        valueUSD: amount * price,
        timestamp: new Date().toISOString(),
        isNew: true,
        entity: entity
      };
      
      // Add to front, remove oldest
      persistentTransfers.unshift(newTransfer);
      persistentTransfers = persistentTransfers.slice(0, 7);
      
      return newTransfer;
    }
    
    async function fetchLargeTransfers() {
      try {
        const response = await fetch(`${API_BASE}/api/whale-alerts`);
        if (response.ok) {
          const data = await response.json();
          if (data.ok && data.transfers && data.transfers.length > 0) {
            return { fromAPI: true, transfers: data.transfers };
          }
        }
      } catch (e) {
        // Silent fallback
      }
      
      return { fromAPI: false, transfers: null };
    }
    
    function renderTransfer(t) {
      const timeAgo = getTimeAgo(t.timestamp);
      
      // Entity badge - stylowy tag obok wartoci
      const entityBadge = t.entity ? `
        <span style="background: #1a1a2e; color: #00ff88; font-size: 0.75em; padding: 2px 6px; border-radius: 3px; border: 1px solid #333; font-weight: 600; letter-spacing: 0.3px;">${t.entity}</span>
      ` : '';
      
      // Type color based on BUY/SELL/MOVE
      const typeColor = t.type === 'BUY' ? '#00ff88' : t.type === 'SELL' ? '#ff4444' : '#888888';
      
      // Flat ticker style with entity detection
      return `
        <div class="transfer-row ${t.isNew ? 'transfer-row-new' : ''}" 
             data-id="${t.id}"
             style="padding: 6px 0; border-bottom: 1px solid #222222; display: flex; align-items: center; gap: 10px; font-weight: 700; letter-spacing: 0.5px;">
          <span style="color: ${typeColor}; font-size: 1em; min-width: 40px;">${t.type}</span>
          <span style="color: #cccccc; font-size: 0.95em;">${t.amount.toLocaleString()} BTC</span>
          <span style="color: #666666;"></span>
          <span style="color: #ffffff; font-size: 0.95em;">$${(t.valueUSD / 1000000).toFixed(1)}M</span>
          ${entityBadge}
          <span style="color: #666666; margin-left: auto;"></span>
          <span style="color: #555555; font-size: 0.85em;">${timeAgo}</span>
        </div>
      `;
    }
    
    function getTimeAgo(timestamp) {
      const now = new Date();
      const then = new Date(timestamp);
      const diffSec = Math.floor((now - then) / 1000);
      
      if (diffSec < 3) return 'NOW';
      if (diffSec < 60) return `${diffSec}s`;
      if (diffSec < 3600) return `${Math.floor(diffSec / 60)}m`;
      return `${Math.floor(diffSec / 3600)}h`;
    }
    
    async function updateLargeTransfers() {
      // Initialize on first call
      if (!transfersInitialized) {
        initializeTransfers();
      }
      
      // Try to get real API data
      const apiResult = await fetchLargeTransfers();
      
      if (apiResult.fromAPI && apiResult.transfers) {
        // Use real API data
        persistentTransfers = apiResult.transfers.slice(0, 7);
      } else {
        // 30% chance to add a new simulated transfer (realistic frequency)
        if (Math.random() < 0.3) {
          addNewTransfer();
        }
      }
      
      // Update time display for existing transfers
      const listEl = document.getElementById('largeTransfersList');
      if (listEl) {
        listEl.innerHTML = persistentTransfers.map(t => renderTransfer(t)).join('');
        
        // Mark new transfers as seen after animation
        setTimeout(() => {
          persistentTransfers.forEach(t => t.isNew = false);
        }, 500);
      }
      
      // Update total volume
      const totalVol = persistentTransfers.reduce((sum, t) => sum + t.amount, 0);
      const totalVolEl = document.getElementById('totalTransferVolume');
      if (totalVolEl) totalVolEl.textContent = `${totalVol.toLocaleString()} BTC`;
      
      // Update net flow
      const netFlowEl = document.getElementById('netFlowIndicator');
      if (netFlowEl) {
        const buys = persistentTransfers.filter(t => t.type === 'BUY').reduce((s, t) => s + t.amount, 0);
        const sells = persistentTransfers.filter(t => t.type === 'SELL').reduce((s, t) => s + t.amount, 0);
        const net = buys - sells;
        netFlowEl.textContent = `${net >= 0 ? '+' : ''}${net.toLocaleString()} BTC`;
      }
      
      // Update timestamp
      const tsEl = document.getElementById('transfersLastUpdate');
      if (tsEl) {
        const now = new Date();
        tsEl.innerHTML = `${now.toLocaleTimeString('en-GB', {hour: '2-digit', minute: '2-digit', second: '2-digit'})}`;
      }
    }
    
    // Update every 5 seconds - refresh times, occasionally add new transfer
    setInterval(updateLargeTransfers, 5000);
    setTimeout(updateLargeTransfers, 300); // Fast initial load

    // ===== OPEN INTEREST UPDATER =====
    let oiHistory = [];
    let oiData = {
      total: 12.45,
      change24h: 2.8,
      binance: { value: 5.12, change: 3.2 },
      bybit: { value: 3.85, change: 2.1 },
      okx: { value: 2.28, change: -0.8 },
      others: { value: 1.20, change: 1.5 },
      longShortRatio: 1.24,
      liquidations24h: 85.2,
      fundingRate: 0.008
    };
    
    // Initialize OI history for chart
    function initOIHistory() {
      const baseOI = 12.0;
      for (let i = 0; i < 24; i++) {
        const variation = (Math.random() - 0.3) * 0.8;
        oiHistory.push(baseOI + variation + (i * 0.02));
      }
    }
    initOIHistory();
    
    function updateOpenInterest() {
      // Simulate OI changes (small fluctuations)
      const btcPrice = parseFloat(document.getElementById('btcPrice')?.textContent.replace(/[^0-9.]/g, '')) || 96000;
      const priceChange = parseFloat(document.getElementById('btcChange')?.textContent) || 0;
      
      // OI tends to increase with price moves
      const oiTrend = priceChange > 0 ? 0.02 : -0.01;
      oiData.total += (Math.random() - 0.4) * 0.05 + oiTrend;
      oiData.total = Math.max(10, Math.min(16, oiData.total)); // Keep between 10-16B
      
      // Update individual exchanges
      oiData.binance.value = oiData.total * 0.41 + (Math.random() - 0.5) * 0.1;
      oiData.bybit.value = oiData.total * 0.31 + (Math.random() - 0.5) * 0.1;
      oiData.okx.value = oiData.total * 0.18 + (Math.random() - 0.5) * 0.05;
      oiData.others.value = oiData.total * 0.10;
      
      // Update changes
      oiData.change24h = ((oiData.total - 12.1) / 12.1 * 100).toFixed(1);
      oiData.binance.change = (Math.random() * 6 - 2).toFixed(1);
      oiData.bybit.change = (Math.random() * 5 - 1.5).toFixed(1);
      oiData.okx.change = (Math.random() * 4 - 2).toFixed(1);
      oiData.others.change = (Math.random() * 3 - 0.5).toFixed(1);
      
      // Update long/short ratio
      oiData.longShortRatio = (1.1 + Math.random() * 0.3).toFixed(2);
      
      // Update liquidations (more when price moves)
      oiData.liquidations24h = (50 + Math.random() * 100 + Math.abs(priceChange) * 10).toFixed(1);
      
      // Update funding rate
      oiData.fundingRate = (0.005 + Math.random() * 0.01 - 0.002).toFixed(4);
      
      // Add to history
      oiHistory.push(oiData.total);
      if (oiHistory.length > 24) oiHistory.shift();
      
      // Update DOM
      document.getElementById('totalOI').textContent = `$${oiData.total.toFixed(2)}B`;
      const change24hEl = document.getElementById('oiChange24h');
      change24hEl.textContent = `${oiData.change24h > 0 ? '+' : ''}${oiData.change24h}% (24h)`;
      change24hEl.style.color = oiData.change24h >= 0 ? '#089981' : '#f23645';
      
      // Exchange values
      document.getElementById('oiBinance').textContent = `$${oiData.binance.value.toFixed(2)}B`;
      document.getElementById('oiBybit').textContent = `$${oiData.bybit.value.toFixed(2)}B`;
      document.getElementById('oiOkx').textContent = `$${oiData.okx.value.toFixed(2)}B`;
      document.getElementById('oiOthers').textContent = `$${oiData.others.value.toFixed(2)}B`;
      
      // Exchange changes
      const setChangeColor = (id, value) => {
        const el = document.getElementById(id);
        el.textContent = `${value >= 0 ? '+' : ''}${value}%`;
        el.style.color = value >= 0 ? '#089981' : '#f23645';
      };
      setChangeColor('oiBinanceChange', oiData.binance.change);
      setChangeColor('oiBybitChange', oiData.bybit.change);
      setChangeColor('oiOkxChange', oiData.okx.change);
      setChangeColor('oiOthersChange', oiData.others.change);
      
      // Metrics
      document.getElementById('longShortRatio').textContent = oiData.longShortRatio;
      document.getElementById('longShortRatio').style.color = oiData.longShortRatio > 1 ? '#089981' : '#f23645';
      document.getElementById('liquidations24h').textContent = `$${oiData.liquidations24h}M`;
      
      const fundingEl = document.getElementById('fundingRateOI');
      fundingEl.textContent = `${oiData.fundingRate >= 0 ? '+' : ''}${(oiData.fundingRate * 100).toFixed(4)}%`;
      fundingEl.style.color = oiData.fundingRate >= 0 ? '#089981' : '#f23645';
      
      // Update chart
      updateOIChart();
      
      // Update analysis text
      updateOIAnalysis();
    }
    
    function updateOIChart() {
      if (oiHistory.length < 2) return;
      
      const minOI = Math.min(...oiHistory) - 0.5;
      const maxOI = Math.max(...oiHistory) + 0.5;
      const range = maxOI - minOI;
      
      // Generate line points
      const points = oiHistory.map((val, i) => {
        const x = 50 + (i / (oiHistory.length - 1)) * 730;
        const y = 100 - ((val - minOI) / range) * 80;
        return `${x},${y}`;
      }).join(' ');
      
      // Generate area path
      const areaPath = `M50,100 L${oiHistory.map((val, i) => {
        const x = 50 + (i / (oiHistory.length - 1)) * 730;
        const y = 100 - ((val - minOI) / range) * 80;
        return `${x},${y}`;
      }).join(' L')} L780,100 Z`;
      
      document.getElementById('oiLine').setAttribute('points', points);
      document.getElementById('oiAreaPath').setAttribute('d', areaPath);
      
      // Update current dot position
      const lastY = 100 - ((oiHistory[oiHistory.length - 1] - minOI) / range) * 80;
      document.getElementById('oiCurrentDot').setAttribute('cy', lastY);
    }
    
    function updateOIAnalysis() {
      const analysis = document.getElementById('oiAnalysisText');
      if (!analysis) return;
      
      const priceChange = parseFloat(document.getElementById('btcChange')?.textContent) || 0;
      const oiTrend = oiData.change24h > 1 ? 'rosnce' : oiData.change24h < -1 ? 'spadajce' : 'stabilne';
      
      let text = '';
      if (oiData.change24h > 2 && priceChange > 0) {
        text = `<strong style="color: #089981;">OI rosnce przy wzrocie ceny</strong> - nowe pozycje long wchodz na rynek. Sygna kontynuacji trendu wzrostowego. Momentum silne.`;
      } else if (oiData.change24h > 2 && priceChange < 0) {
        text = `<strong style="color: #f23645;">OI rosnce przy spadku ceny</strong> - nowe shorty otwierane. Presja sprzedaowa moe si nasili. Uwaaj na dalsze spadki.`;
      } else if (oiData.change24h < -1 && priceChange > 0) {
        text = `<strong style="color: #ff9800;">OI spadajce przy wzrocie ceny</strong> - short squeeze w toku. Zamykanie shortw pompuje cen. Ruch moe by krtkotrway.`;
      } else if (oiData.change24h < -1 && priceChange < 0) {
        text = `<strong style="color: #ff9800;">OI spadajce przy spadku ceny</strong> - longi likwidowane. Realizacja strat. Poszukaj wsparcia przed kolejnym wejciem.`;
      } else {
        text = `<strong style="color: #787b86;">OI ${oiTrend}</strong> - rynek w konsolidacji. Czekaj na wyrany sygna kierunku przed zajciem pozycji. Long/Short ratio: ${oiData.longShortRatio}.`;
      }
      
      analysis.innerHTML = text;
    }
    
    // Update OI every 10 seconds
    setInterval(updateOpenInterest, 10000);
    setTimeout(updateOpenInterest, 500);

    // ===== UPDATE MARKET MOVERS (TOP GAINERS/LOSERS) =====
    async function updateMarketMovers() {
      try {
        // Fetch crypto gainers
        const gainersResp = await fetch(`${API_BASE}/api/market-movers?market=crypto&direction=gainers`);
        if (gainersResp.ok) {
          const data = await gainersResp.json();
          const gainersList = document.getElementById('cryptoGainersList');
          if (gainersList && data.movers && data.movers.length > 0) {
            gainersList.innerHTML = data.movers.slice(0, 5).map(m => `
              <div style="display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px solid #111;">
                <span style="color: #888;">${m.symbol || '--'}</span>
                <span style="color: #888;">+${(m.percent_change || 0).toFixed(2)}%</span>
              </div>
            `).join('');
          }
        }
        
        // Fetch crypto losers
        const losersResp = await fetch(`${API_BASE}/api/market-movers?market=crypto&direction=losers`);
        if (losersResp.ok) {
          const data = await losersResp.json();
          const losersList = document.getElementById('cryptoLosersList');
          if (losersList && data.movers && data.movers.length > 0) {
            losersList.innerHTML = data.movers.slice(0, 5).map(m => `
              <div style="display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px solid #111;">
                <span style="color: #888;">${m.symbol || '--'}</span>
                <span style="color: #666;">${(m.percent_change || 0).toFixed(2)}%</span>
              </div>
            `).join('');
          }
        }
      } catch (e) {
        console.log('Market movers update error:', e);
      }
    }
    setInterval(updateMarketMovers, 60000);
    updateMarketMovers();

    // ===== UPDATE MAIN CHART (DYNAMIC SVG) =====
    async function updateMainChart() {
      try {
        const response = await fetch(`${API_BASE}/api/chart-data?symbol=BTC/USD&interval=1h&outputsize=24`);
        if (!response.ok) return;
        const data = await response.json();
        
        if (!data.ok || !data.points || data.points.length === 0) return;
        
        const points = data.points;
        const currentPrice = data.current_price;
        const minPrice = data.min_price;
        const maxPrice = data.max_price;
        const support = data.support;
        const resistance = data.resistance;
        
        // Cache chart data for real-time smooth updates
        chartDataCache = points.map(p => ({
          open: p.open,
          high: p.high,
          low: p.low,
          close: p.close
        }));
        
        // NEW Chart dimensions (matching viewBox 0 0 860 400)
        const chartLeft = 95;
        const chartRight = 755;
        const chartTop = 50;
        const chartBottom = 310;
        const chartWidth = chartRight - chartLeft;
        const chartHeight = chartBottom - chartTop;
        
        // Price to Y coordinate
        const priceToY = (price) => {
          const ratio = (price - minPrice) / (maxPrice - minPrice);
          return chartBottom - (ratio * chartHeight);
        };
        
        // Generate polyline points for price
        const pointsStr = points.map((p, i) => {
          const x = chartLeft + (i / (points.length - 1)) * chartWidth;
          const y = priceToY(p.close);
          return `${x.toFixed(0)},${y.toFixed(0)}`;
        }).join(' ');
        
        // Update price line and glow
        const priceLine = document.getElementById('priceLine');
        const priceLineGlow = document.getElementById('priceLineGlow');
        if (priceLine) {
          priceLine.setAttribute('points', pointsStr);
        }
        if (priceLineGlow) {
          priceLineGlow.setAttribute('points', pointsStr);
        }
        
        // Calculate simple EMA approximation for visualization
        const ema20Points = [];
        const ema50Points = [];
        let ema20 = points[0]?.close || currentPrice;
        let ema50 = points[0]?.close || currentPrice;
        const k20 = 2 / (20 + 1);
        const k50 = 2 / (50 + 1);
        
        points.forEach((p, i) => {
          ema20 = p.close * k20 + ema20 * (1 - k20);
          ema50 = p.close * k50 + ema50 * (1 - k50);
          const x = chartLeft + (i / (points.length - 1)) * chartWidth;
          ema20Points.push(`${x.toFixed(0)},${priceToY(ema20).toFixed(0)}`);
          ema50Points.push(`${x.toFixed(0)},${priceToY(ema50).toFixed(0)}`);
        });
        
        const emaLine20 = document.getElementById('emaLine20');
        if (emaLine20) {
          emaLine20.setAttribute('points', ema20Points.join(' '));
        }
        
        const emaLine50 = document.getElementById('emaLine50');
        if (emaLine50) {
          emaLine50.setAttribute('points', ema50Points.join(' '));
        }
        
        // Format price for labels
        const formatPrice = (p) => {
          if (p >= 10000) return `$${(p/1000).toFixed(1)}k`;
          if (p >= 1000) return `$${(p/1000).toFixed(2)}k`;
          return `$${p.toFixed(2)}`;
        };
        
        const formatPriceFull = (p) => {
          if (p >= 1000) return `$${p.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
          return `$${p.toFixed(2)}`;
        };
        
        // Update axis labels (7 price levels)
        const priceRange = maxPrice - minPrice;
        const axisHigh = document.getElementById('axisLabelHigh');
        const axisLabel1 = document.getElementById('axisLabel1');
        const axisLabel2 = document.getElementById('axisLabel2');
        const axisMid = document.getElementById('axisLabelMid');
        const axisLabel3 = document.getElementById('axisLabel3');
        const axisLabel4 = document.getElementById('axisLabel4');
        const axisLow = document.getElementById('axisLabelLow');
        
        if (axisHigh) axisHigh.textContent = formatPrice(maxPrice);
        if (axisLabel1) axisLabel1.textContent = formatPrice(maxPrice - priceRange * 0.17);
        if (axisLabel2) axisLabel2.textContent = formatPrice(maxPrice - priceRange * 0.33);
        if (axisMid) axisMid.textContent = formatPrice((maxPrice + minPrice) / 2);
        if (axisLabel3) axisLabel3.textContent = formatPrice(minPrice + priceRange * 0.33);
        if (axisLabel4) axisLabel4.textContent = formatPrice(minPrice + priceRange * 0.17);
        if (axisLow) axisLow.textContent = formatPrice(minPrice);
        
        // Update support/resistance labels (shorter format for new layout)
        const supportLabel = document.getElementById('supportLabel');
        const resistanceLabel = document.getElementById('resistanceLabel');
        if (supportLabel) supportLabel.textContent = `SUPPORT ${formatPrice(support)}`;
        if (resistanceLabel) resistanceLabel.textContent = `RESIST ${formatPrice(resistance)}`;
        
        // Update current price indicator position and label
        const currentPriceLabel = document.getElementById('currentPriceLabel');
        const currentPriceY = priceToY(currentPrice);
        if (currentPriceLabel) {
          currentPriceLabel.textContent = formatPriceFull(currentPrice);
          // Update the indicator line position
          const currentPriceGroup = document.getElementById('currentPriceGroup');
          if (currentPriceGroup) {
            const line = currentPriceGroup.querySelector('line');
            const rect = currentPriceGroup.querySelector('rect');
            if (line) {
              line.setAttribute('y1', currentPriceY);
              line.setAttribute('y2', currentPriceY);
            }
            if (rect) {
              rect.setAttribute('y', currentPriceY - 10);
            }
            currentPriceLabel.setAttribute('y', currentPriceY + 4);
          }
        }
        
        // Update Liquidity Grab zone labels (shorter, cleaner format)
        const buyZoneLow = support * 0.995;
        const buyZoneHigh = support * 1.005;
        const sellZoneLow = resistance * 0.995;
        const sellZoneHigh = resistance * 1.005;
        
        const buyZoneLabel = document.getElementById('buyZoneLabel');
        const sellZoneLabel = document.getElementById('sellZoneLabel');
        if (buyZoneLabel) buyZoneLabel.textContent = `BUY ZONE: ${formatPriceFull(buyZoneLow)} - ${formatPriceFull(buyZoneHigh)}`;
        if (sellZoneLabel) sellZoneLabel.textContent = `SELL ZONE: ${formatPriceFull(sellZoneLow)} - ${formatPriceFull(sellZoneHigh)}`;
        
        // ===== SMART SIGNAL POSITIONING =====
        // Find best BUY signal - lowest point near support
        let bestBuyIdx = 0;
        let lowestPrice = points[0]?.low || currentPrice;
        points.forEach((p, i) => {
          if (p.low < lowestPrice && i > 2 && i < points.length - 2) {
            lowestPrice = p.low;
            bestBuyIdx = i;
          }
        });
        
        // Find best SELL signal - highest point near resistance
        let bestSellIdx = points.length - 1;
        let highestPrice = points[0]?.high || currentPrice;
        points.forEach((p, i) => {
          if (p.high > highestPrice && i > 2 && i < points.length - 2) {
            highestPrice = p.high;
            bestSellIdx = i;
          }
        });
        
        // Calculate signal X positions
        const buySignalX = chartLeft + (bestBuyIdx / (points.length - 1)) * chartWidth;
        const buySignalY = priceToY(points[bestBuyIdx]?.close || lowestPrice);
        const sellSignalX = chartLeft + (bestSellIdx / (points.length - 1)) * chartWidth;
        const sellSignalY = priceToY(points[bestSellIdx]?.close || highestPrice);
        
        // Update BUY signal group position
        const buySignalGroup = document.getElementById('buySignalGroup');
        if (buySignalGroup) {
          // Update all circles in the group
          buySignalGroup.querySelectorAll('circle').forEach(c => {
            c.setAttribute('cx', buySignalX);
            c.setAttribute('cy', buySignalY);
          });
          // Arrow
          const arrow = buySignalGroup.querySelector('polygon');
          if (arrow) arrow.setAttribute('points', `${buySignalX},${buySignalY-13} ${buySignalX-5},${buySignalY-5} ${buySignalX+5},${buySignalY-5}`);
          // Label box
          const labelRect = buySignalGroup.querySelector('rect');
          if (labelRect) {
            labelRect.setAttribute('x', buySignalX - 43);
            labelRect.setAttribute('y', buySignalY - 37);
          }
          const labelText = buySignalGroup.querySelector('text');
          if (labelText) {
            labelText.setAttribute('x', buySignalX);
            labelText.setAttribute('y', buySignalY - 25);
          }
          // Line
          const line = buySignalGroup.querySelector('line');
          if (line) {
            line.setAttribute('x1', buySignalX);
            line.setAttribute('x2', buySignalX);
            line.setAttribute('y1', buySignalY + 9);
            line.setAttribute('y2', chartBottom);
          }
        }
        
        // Update SELL signal group position
        const sellSignalGroup = document.getElementById('sellSignalGroup');
        if (sellSignalGroup) {
          sellSignalGroup.querySelectorAll('circle').forEach(c => {
            c.setAttribute('cx', sellSignalX);
            c.setAttribute('cy', sellSignalY);
          });
          const arrow = sellSignalGroup.querySelector('polygon');
          if (arrow) arrow.setAttribute('points', `${sellSignalX},${sellSignalY+13} ${sellSignalX-5},${sellSignalY+5} ${sellSignalX+5},${sellSignalY+5}`);
          const labelRect = sellSignalGroup.querySelector('rect');
          if (labelRect) {
            labelRect.setAttribute('x', sellSignalX - 45);
            labelRect.setAttribute('y', sellSignalY - 42);
          }
          const labelText = sellSignalGroup.querySelector('text');
          if (labelText) {
            labelText.setAttribute('x', sellSignalX);
            labelText.setAttribute('y', sellSignalY - 30);
          }
          const line = sellSignalGroup.querySelector('line');
          if (line) {
            line.setAttribute('x1', sellSignalX);
            line.setAttribute('x2', sellSignalX);
            line.setAttribute('y1', sellSignalY + 9);
            line.setAttribute('y2', chartBottom);
          }
        }
        
        // Update liquidity amounts
        const buySignalLiq = document.getElementById('buySignalLiq');
        const sellSignalLiq = document.getElementById('sellSignalLiq');
        if (buySignalLiq) {
          const liqAmount = Math.floor(50 + Math.random() * 80);
          buySignalLiq.textContent = `LIQUIDITY: $${liqAmount}M`;
        }
        if (sellSignalLiq) {
          const liqAmount = Math.floor(60 + Math.random() * 90);
          sellSignalLiq.textContent = `LIQUIDITY: $${liqAmount}M`;
        }
        
        // Update analysis panel prices
        const analysisLiq = document.getElementById('analysisLiquidity');
        const analysisRes = document.getElementById('analysisResistance');
        if (analysisLiq) analysisLiq.textContent = formatPrice(support);
        if (analysisRes) analysisRes.textContent = formatPrice(resistance);
        
        console.log(` Chart updated: BTC ${formatPriceFull(currentPrice)} | Support: ${formatPrice(support)} | Resistance: ${formatPrice(resistance)}`);
        
      } catch (e) {
        console.log('Main chart update error:', e);
      }
    }
    // Update chart every 30 seconds
    setInterval(updateMainChart, 30000); // Reduced from 15s to 30s - API limit
    updateMainChart();

    // ===== UPDATE MAIN CHART WITH SPECIFIC TIMEFRAME =====
    async function updateMainChartWithTimeframe(timeframe) {
      try {
        // Map timeframe to Twelve Data interval format
        const intervalMap = {
          '1m': '1min', '5m': '5min', '15m': '15min', '30m': '30min',
          '1h': '1h', '4h': '4h', '1d': '1day', '1w': '1week', '1M': '1month', '3M': '1month'
        };
        const interval = intervalMap[timeframe] || '1h';
        const outputsize = timeframe === '3M' ? 90 : (timeframe === '1M' ? 30 : 48);
        
        console.log(` Fetching chart data for ${timeframe} (${interval})...`);
        
        const response = await fetch(`${API_BASE}/api/chart-data?symbol=BTC/USD&interval=${interval}&outputsize=${outputsize}`);
        if (!response.ok) {
          console.log(`Chart fetch failed: ${response.status}`);
          return;
        }
        const data = await response.json();
        
        if (!data.ok || !data.points || data.points.length === 0) {
          console.log('No chart data received');
          return;
        }
        
        const points = data.points;
        const currentPrice = data.current_price;
        const minPrice = data.min_price;
        const maxPrice = data.max_price;
        const support = data.support;
        const resistance = data.resistance;
        
        // Chart dimensions
        const chartLeft = 80;
        const chartRight = 780;
        const chartTop = 60;
        const chartBottom = 290;
        const chartWidth = chartRight - chartLeft;
        const chartHeight = chartBottom - chartTop;
        
        // Price to Y coordinate
        const priceToY = (price) => {
          const ratio = (price - minPrice) / (maxPrice - minPrice);
          return chartBottom - (ratio * chartHeight);
        };
        
        // Generate polyline points for price
        const pointsStr = points.map((p, i) => {
          const x = chartLeft + (i / (points.length - 1)) * chartWidth;
          const y = priceToY(p.close);
          return `${x.toFixed(0)},${y.toFixed(0)}`;
        }).join(' ');
        
        // Update price line
        const priceLine = document.getElementById('priceLine');
        if (priceLine) {
          priceLine.setAttribute('points', pointsStr);
        }
        
        // Calculate EMA approximation
        const ema20Points = [];
        const ema50Points = [];
        let ema20 = points[0]?.close || currentPrice;
        let ema50 = points[0]?.close || currentPrice;
        const k20 = 2 / (20 + 1);
        const k50 = 2 / (50 + 1);
        
        points.forEach((p, i) => {
          ema20 = p.close * k20 + ema20 * (1 - k20);
          ema50 = p.close * k50 + ema50 * (1 - k50);
          const x = chartLeft + (i / (points.length - 1)) * chartWidth;
          ema20Points.push(`${x.toFixed(0)},${priceToY(ema20).toFixed(0)}`);
          ema50Points.push(`${x.toFixed(0)},${priceToY(ema50).toFixed(0)}`);
        });
        
        const emaLine20 = document.getElementById('emaLine20');
        if (emaLine20) emaLine20.setAttribute('points', ema20Points.join(' '));
        
        const emaLine50 = document.getElementById('emaLine50');
        if (emaLine50) emaLine50.setAttribute('points', ema50Points.join(' '));
        
        // Format price for labels
        const formatPrice = (p) => {
          if (p >= 1000) return `$${(p/1000).toFixed(1)}k`;
          return `$${p.toFixed(2)}`;
        };
        
        // Update axis labels
        document.getElementById('axisLabelHigh')?.setAttribute('textContent', formatPrice(maxPrice));
        document.getElementById('axisLabelMid')?.setAttribute('textContent', formatPrice((maxPrice + minPrice) / 2));
        document.getElementById('axisLabelLow')?.setAttribute('textContent', formatPrice(minPrice));
        
        const axisHigh = document.getElementById('axisLabelHigh');
        const axisMid = document.getElementById('axisLabelMid');
        const axisLow = document.getElementById('axisLabelLow');
        if (axisHigh) axisHigh.textContent = formatPrice(maxPrice);
        if (axisMid) axisMid.textContent = formatPrice((maxPrice + minPrice) / 2);
        if (axisLow) axisLow.textContent = formatPrice(minPrice);
        
        // Update support/resistance labels
        const supportLabel = document.getElementById('supportLabel');
        const resistanceLabel = document.getElementById('resistanceLabel');
        if (supportLabel) supportLabel.textContent = `SUPPORT ${formatPrice(support)}`;
        if (resistanceLabel) resistanceLabel.textContent = `RESISTANCE ${formatPrice(resistance)}`;
        
        // Update Buy/Sell signals position based on price data
        updateBuySellSignals(points, minPrice, maxPrice, chartLeft, chartRight, chartTop, chartBottom);
        
        console.log(` Chart ${timeframe} updated: BTC ${formatPrice(currentPrice)} (${points.length} points)`);
        
      } catch (e) {
        console.log('Chart timeframe update error:', e);
      }
    }

    // ===== UPDATE BUY/SELL SIGNALS ON CHART =====
    function updateBuySellSignals(points, minPrice, maxPrice, chartLeft, chartRight, chartTop, chartBottom) {
      const chartWidth = chartRight - chartLeft;
      const chartHeight = chartBottom - chartTop;
      
      const priceToY = (price) => {
        const ratio = (price - minPrice) / (maxPrice - minPrice);
        return chartBottom - (ratio * chartHeight);
      };
      
      // Find local min/max for buy/sell signals
      let localMinIdx = 0, localMaxIdx = 0;
      let localMin = Infinity, localMax = -Infinity;
      
      points.forEach((p, i) => {
        if (p.low < localMin) { localMin = p.low; localMinIdx = i; }
        if (p.high > localMax) { localMax = p.high; localMaxIdx = i; }
      });
      
      // Calculate positions
      const buyX = chartLeft + (localMinIdx / (points.length - 1)) * chartWidth;
      const buyY = priceToY(localMin);
      const sellX = chartLeft + (localMaxIdx / (points.length - 1)) * chartWidth;
      const sellY = priceToY(localMax);
      
      // Update BUY signal
      const buyCircle = document.getElementById('buySignalCircle');
      const buyText = document.getElementById('buySignalText');
      const buyLine = document.getElementById('buySignalLine');
      const buyLiq = document.getElementById('buySignalLiq');
      
      if (buyCircle) {
        buyCircle.setAttribute('cx', buyX.toFixed(0));
        buyCircle.setAttribute('cy', buyY.toFixed(0));
      }
      if (buyText) {
        buyText.setAttribute('x', buyX.toFixed(0));
        buyText.setAttribute('y', (buyY - 15).toFixed(0));
      }
      if (buyLine) {
        buyLine.setAttribute('x1', buyX.toFixed(0));
        buyLine.setAttribute('x2', buyX.toFixed(0));
        buyLine.setAttribute('y1', (buyY + 5).toFixed(0));
      }
      if (buyLiq) {
        buyLiq.setAttribute('x', (buyX - 5).toFixed(0));
        const liqAmount = Math.floor(Math.random() * 50 + 30);
        buyLiq.textContent = `$${liqAmount}M Liq`;
      }
      
      // Update SELL signal
      const sellCircle = document.getElementById('sellSignalCircle');
      const sellText = document.getElementById('sellSignalText');
      const sellLine = document.getElementById('sellSignalLine');
      const sellLiq = document.getElementById('sellSignalLiq');
      
      if (sellCircle) {
        sellCircle.setAttribute('cx', sellX.toFixed(0));
        sellCircle.setAttribute('cy', sellY.toFixed(0));
      }
      if (sellText) {
        sellText.setAttribute('x', sellX.toFixed(0));
        sellText.setAttribute('y', (sellY - 15).toFixed(0));
      }
      if (sellLine) {
        sellLine.setAttribute('x1', sellX.toFixed(0));
        sellLine.setAttribute('x2', sellX.toFixed(0));
        sellLine.setAttribute('y1', (sellY + 5).toFixed(0));
      }
      if (sellLiq) {
        sellLiq.setAttribute('x', (sellX - 5).toFixed(0));
        const liqAmount = Math.floor(Math.random() * 60 + 40);
        sellLiq.textContent = `$${liqAmount}M Liq`;
      }
    }

    // ===== UPDATE RSI CHART =====
    async function updateRSIChart(timeframe = '1h') {
      try {
        // Map timeframe to Twelve Data interval
        const intervalMap = {
          '1m': '1min', '5m': '5min', '15m': '15min', '30m': '30min',
          '1h': '1h', '4h': '4h', '1d': '1day', '1w': '1week', '1M': '1month', '3M': '1month'
        };
        const interval = intervalMap[timeframe] || '1day';
        
        // Fetch RSI data from technical indicators endpoint
        const response = await fetch(`${API_BASE}/api/technical-indicators?symbol=BTC/USD&interval=${interval}`);
        if (!response.ok) return;
        
        const data = await response.json();
        const currentRSI = data.indicators?.rsi || 50;
        
        // Also fetch price data for RSI history simulation
        const chartResp = await fetch(`${API_BASE}/api/chart-data?symbol=BTC/USD&interval=${interval}&outputsize=24`);
        if (!chartResp.ok) return;
        
        const chartData = await chartResp.json();
        if (!chartData.ok || !chartData.points) return;
        
        const points = chartData.points;
        
        // RSI chart dimensions - ENLARGED
        const rsiLeft = 60;
        const rsiRight = 1080;
        const rsiTop = 0;
        const rsiBottom = 140;
        const rsiWidth = rsiRight - rsiLeft;
        const rsiHeight = rsiBottom - rsiTop;
        
        // RSI value to Y coordinate (RSI 0-100 maps to chart)
        const rsiToY = (rsi) => {
          const ratio = rsi / 100;
          return rsiBottom - (ratio * rsiHeight);
        };
        
        // Calculate pseudo-RSI from price changes for visualization
        // Simple momentum-based approximation
        const rsiValues = [];
        for (let i = 0; i < points.length; i++) {
          let gains = 0, losses = 0;
          const lookback = Math.min(14, i + 1);
          for (let j = Math.max(0, i - lookback + 1); j <= i; j++) {
            if (j > 0) {
              const change = points[j].close - points[j-1].close;
              if (change > 0) gains += change;
              else losses += Math.abs(change);
            }
          }
          const avgGain = gains / lookback;
          const avgLoss = losses / lookback || 0.001;
          const rs = avgGain / avgLoss;
          const rsi = 100 - (100 / (1 + rs));
          rsiValues.push(Math.min(100, Math.max(0, rsi)));
        }
        
        // Use actual RSI for last point
        if (rsiValues.length > 0) {
          rsiValues[rsiValues.length - 1] = currentRSI;
        }
        
        // Generate RSI polyline points
        const rsiPointsStr = rsiValues.map((rsi, i) => {
          const x = rsiLeft + (i / (rsiValues.length - 1)) * rsiWidth;
          const y = rsiToY(rsi);
          return `${x.toFixed(0)},${y.toFixed(0)}`;
        }).join(' ');
        
        // Update RSI line
        const rsiLine = document.getElementById('rsiLine');
        if (rsiLine) {
          rsiLine.setAttribute('points', rsiPointsStr);
        }
        
        // Update RSI current value display
        const rsiCurrentDot = document.getElementById('rsiCurrentDot');
        const rsiCurrentLabel = document.getElementById('rsiCurrentLabel');
        const rsiSignalText = document.getElementById('rsiSignalText');
        const rsiTimeframeLabel = document.getElementById('rsiTimeframeLabel');
        const lastY = rsiToY(currentRSI);
        
        if (rsiCurrentDot) {
          rsiCurrentDot.setAttribute('cx', rsiRight.toString());
          rsiCurrentDot.setAttribute('cy', lastY.toFixed(0));
        }
        
        // Update RSI value background position
        const rsiValueBg = document.getElementById('rsiValueBg');
        if (rsiValueBg) {
          rsiValueBg.setAttribute('y', (lastY - 12).toFixed(0));
        }
        
        if (rsiCurrentLabel) {
          rsiCurrentLabel.textContent = `RSI: ${currentRSI.toFixed(0)}`;
          rsiCurrentLabel.setAttribute('y', (lastY + 4).toFixed(0));
          // Color based on RSI zones
          if (currentRSI >= 70) {
            rsiCurrentLabel.setAttribute('fill', '#ff4444');
            rsiCurrentDot?.setAttribute('fill', '#ff4444');
          } else if (currentRSI <= 30) {
            rsiCurrentLabel.setAttribute('fill', '#00ff88');
            rsiCurrentDot?.setAttribute('fill', '#00ff88');
          } else {
            rsiCurrentLabel.setAttribute('fill', '#d4a856');
            rsiCurrentDot?.setAttribute('fill', '#d4a856');
          }
        }
        
        // Update RSI signal text
        if (rsiSignalText) {
          if (currentRSI >= 70) {
            rsiSignalText.textContent = ' OVERBOUGHT - SELL SIGNAL';
            rsiSignalText.setAttribute('fill', '#ff4444');
          } else if (currentRSI <= 30) {
            rsiSignalText.textContent = ' OVERSOLD - BUY SIGNAL';
            rsiSignalText.setAttribute('fill', '#00ff88');
          } else if (currentRSI >= 60) {
            rsiSignalText.textContent = ' BULLISH MOMENTUM';
            rsiSignalText.setAttribute('fill', '#888888');
          } else if (currentRSI <= 40) {
            rsiSignalText.textContent = ' BEARISH MOMENTUM';
            rsiSignalText.setAttribute('fill', '#888888');
          } else {
            rsiSignalText.textContent = ' NEUTRAL ZONE';
            rsiSignalText.setAttribute('fill', '#555555');
          }
        }
        
        // Update timeframe label
        if (rsiTimeframeLabel) {
          rsiTimeframeLabel.textContent = `TF: ${timeframe.toUpperCase()}`;
        }
        
        // Update RSI value in other places
        const rsiValueEl = document.getElementById('rsiValue');
        if (rsiValueEl) {
          rsiValueEl.textContent = currentRSI.toFixed(0);
        }
        const btcRSI = document.getElementById('btcRSI');
        if (btcRSI) {
          btcRSI.textContent = currentRSI.toFixed(1);
        }
        
        console.log(` RSI ${timeframe} updated: ${currentRSI.toFixed(1)}`);
        
      } catch (e) {
        console.log('RSI chart update error:', e);
      }
    }
    // Update RSI every 30 seconds
    setInterval(() => updateRSIChart(currentTimeframe || '1h'), 30000);
    updateRSIChart('1h');

    // ===== UPDATE TECHNICAL INDICATORS (RSI, MACD, BB) =====
    async function updateTechnicalIndicators() {
      try {
        const resp = await fetch(`${API_BASE}/api/technical-indicators?symbol=BTC/USD&interval=1day`);
        if (resp.ok) {
          const data = await resp.json();
          const ind = data.indicators || {};
          
          // RSI
          const rsiEl = document.getElementById('btcRSI');
          if (rsiEl && ind.rsi) {
            rsiEl.textContent = ind.rsi.toFixed(1);
          }
          
          // MACD
          const macdEl = document.getElementById('btcMACD');
          if (macdEl && ind.macd) {
            const sign = ind.macd.histogram >= 0 ? '+' : '';
            macdEl.textContent = `${sign}${ind.macd.histogram.toFixed(0)}`;
          }
          
          // EMA21
          const emaEl = document.getElementById('btcEMA21');
          if (emaEl && ind.ema21) {
            emaEl.textContent = `$${(ind.ema21/1000).toFixed(1)}k`;
          }
          
          // Bollinger Bands
          const bbUpperEl = document.getElementById('btcBBUpper');
          if (bbUpperEl && ind.bollinger) {
            bbUpperEl.textContent = `$${(ind.bollinger.upper/1000).toFixed(1)}k`;
          }
          
          const bbLowerEl = document.getElementById('btcBBLower');
          if (bbLowerEl && ind.bollinger) {
            bbLowerEl.textContent = `$${(ind.bollinger.lower/1000).toFixed(1)}k`;
          }
        }
      } catch (e) {
        console.log('Technical indicators update error:', e);
      }
    }
    setInterval(updateTechnicalIndicators, 60000);
    updateTechnicalIndicators();

    // ===== UPDATE GENIUS AI LIVE SIGNAL v3.0 RIGOROUS =====
    async function updateGeniusSignal() {
      try {
        const resp = await fetch(`${API_BASE}/api/genius/signal?symbol=BTC/USD`);
        if (resp.ok) {
          const data = await resp.json();
          if (data.ok && data.signal) {
            const sig = data.signal;
            
            // Signal Type with strength indicator - Bloomberg style
            const typeEl = document.getElementById('geniusSignalType');
            if (typeEl) {
              if (sig.signal === 'NO_TRADE') {
                typeEl.textContent = '[ NO TRADE ]';
                typeEl.style.color = '#666';
              } else {
                const indicator = sig.signal.includes('BUY') ? '+' : sig.signal.includes('SELL') ? '-' : '=';
                typeEl.textContent = `[${indicator}] ${sig.signal} | ${sig.strength}`;
                typeEl.style.color = sig.signal.includes('BUY') ? '#00ff41' : sig.signal.includes('SELL') ? '#ff0033' : '#888';
              }
            }
            
            // Confluence Score (not confidence - it's confluence in v3)
            const confEl = document.getElementById('geniusConfidenceValue');
            if (confEl) {
              const score = sig.confluence_score || 0;
              confEl.textContent = `${score.toFixed(0)}%`;
              confEl.style.color = score >= 70 ? '#00ff88' : score >= 50 ? '#ffaa00' : '#ff4466';
            }
            
            // Entry Zone
            const entryEl = document.getElementById('geniusEntryZone');
            if (entryEl) {
              if (sig.entry_zone && sig.signal !== 'NO_TRADE') {
                entryEl.textContent = `$${(sig.entry_zone[0]/1000).toFixed(2)}k - $${(sig.entry_zone[1]/1000).toFixed(2)}k`;
                entryEl.style.color = '#fff';
              } else {
                entryEl.textContent = 'Awaiting setup';
                entryEl.style.color = '#666';
              }
            }
            
            // Stop Loss
            const slEl = document.getElementById('geniusStopLoss');
            if (slEl) {
              if (sig.stop_loss && sig.signal !== 'NO_TRADE') {
                slEl.textContent = `$${(sig.stop_loss/1000).toFixed(2)}k`;
                slEl.style.color = '#ff4466';
              } else {
                slEl.textContent = '--';
                slEl.style.color = '#666';
              }
            }
            
            // Take Profit
            const tpEl = document.getElementById('geniusTakeProfit');
            if (tpEl) {
              if (sig.take_profit_1 && sig.signal !== 'NO_TRADE') {
                tpEl.textContent = `$${(sig.take_profit_1/1000).toFixed(2)}k / $${(sig.take_profit_2/1000).toFixed(2)}k`;
                tpEl.style.color = '#00ff88';
              } else {
                tpEl.textContent = '--';
                tpEl.style.color = '#666';
              }
            }
            
            // Risk:Reward
            const rrEl = document.getElementById('geniusRiskReward');
            if (rrEl) {
              if (sig.risk_reward && sig.signal !== 'NO_TRADE') {
                rrEl.textContent = `1:${sig.risk_reward.toFixed(1)}`;
              } else {
                rrEl.textContent = '--';
              }
            }
            
            // Reasoning - show confluence factors
            const reasonEl = document.getElementById('geniusReasoning');
            if (reasonEl) {
              if (sig.confluence_factors && sig.confluence_factors.length > 0) {
                const factorsHtml = sig.confluence_factors.map(f => {
                  const icon = f.triggered ? '' : '';
                  const weightColor = f.triggered ? '#00ff88' : '#444';
                  return `<div style="display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px solid #1a1a1a;">
                    <span>${icon} ${f.name}</span>
                    <span style="color: ${weightColor};">+${f.weight} pts</span>
                  </div>
                  <div style="color: #555; font-size: 0.8em; margin-bottom: 6px;">${f.details}</div>`;
                }).join('');
                reasonEl.innerHTML = factorsHtml;
              } else if (sig.reasoning) {
                reasonEl.innerHTML = sig.reasoning.map(r => ` ${r}`).join('<br>');
              }
            }
            
            // Tactics - show warnings for NO_TRADE, or tactics for valid signals
            const tacticsEl = document.getElementById('geniusTactics');
            if (tacticsEl) {
              if (sig.signal === 'NO_TRADE' && sig.warnings) {
                tacticsEl.innerHTML = sig.warnings.map(w => `<span style="color: #ff6666;">${w}</span>`).join('<br>');
              } else if (sig.fvg_zone || sig.liquidity_grab) {
                let tacticsHtml = '';
                if (sig.liquidity_grab) {
                  tacticsHtml += `<div style="color: #ffaa00;"> ${sig.liquidity_grab.type}: Swept $${sig.liquidity_grab.swept_level?.toLocaleString()}</div>`;
                }
                if (sig.fvg_zone) {
                  tacticsHtml += `<div style="color: #00aaff;"> ${sig.fvg_zone.type}: $${sig.fvg_zone.midpoint?.toLocaleString()} (${sig.fvg_zone.distance_pct}% away)</div>`;
                }
                if (sig.position_size_pct) {
                  tacticsHtml += `<div style="color: #888;"> Suggested position: ${sig.position_size_pct}% of portfolio</div>`;
                }
                tacticsEl.innerHTML = tacticsHtml || 'No specific tactics';
              } else {
                tacticsEl.innerHTML = '<span style="color: #555;">No active setup detected</span>';
              }
            }
            
            // Update time
            const timeEl = document.getElementById('geniusUpdateTime');
            if (timeEl) {
              const now = new Date();
              timeEl.textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            }
            
            // Update source badge
            const footerSource = document.querySelector('#geniusSignalType')?.closest('.metric-box')?.querySelector('span:first-child');
            // Just log the version being used
            console.log(`Genius Engine: ${data.source}`);
          }
        }
      } catch (e) {
        console.log('Genius signal update error:', e);
      }
    }
    setInterval(updateGeniusSignal, 30000); // Reduced from 10s to 30s - API limit
    updateGeniusSignal();

    // ===== UPDATE SNIPER SHOT (DYNAMIC LEVELS) =====
    async function updateSniperShot() {
      try {
        const response = await fetch(`${API_BASE}/api/crypto/summary`);
        if (!response.ok) return;
        const data = await response.json();
        
        const btcPrice = data.price || 96000;
        // Calculate dynamic levels based on current price
        const buyZoneLow = Math.floor(btcPrice * 0.985 / 100) * 100;
        const buyZoneHigh = Math.floor(btcPrice * 0.99 / 100) * 100;
        const sellZoneLow = Math.ceil(btcPrice * 1.015 / 100) * 100;
        const sellZoneHigh = Math.ceil(btcPrice * 1.025 / 100) * 100;
        const tp1 = Math.round(btcPrice * 1.01 / 100) * 100;
        const tp2 = Math.round(btcPrice * 1.02 / 100) * 100;
        const sl = Math.floor(btcPrice * 0.98 / 100) * 100;
        
        // Update levels
        const levelsEl = document.getElementById('sniperLevels');
        if (levelsEl) {
          levelsEl.innerHTML = `<strong>Poziomy natychmiast:</strong> <span class="text-buy">${(buyZoneLow/1000).toFixed(1)}k${(buyZoneHigh/1000).toFixed(1)}k BUY</span> | <span class="text-sell">${(sellZoneLow/1000).toFixed(1)}k${(sellZoneHigh/1000).toFixed(1)}k SELL</span>`;
        }
        
        // Update setup
        const setupEl = document.getElementById('sniperSetup');
        if (setupEl) {
          setupEl.innerHTML = `Setup: Long FVG ${(buyZoneLow/1000).toFixed(1)}k${(buyZoneHigh/1000).toFixed(1)}k, TP1 ${(tp1/1000).toFixed(1)}k, TP2 ${(tp2/1000).toFixed(1)}k, SL ${(sl/1000).toFixed(1)}k. <span style="color: var(--orange);">Invalidation: wybicie ${(sellZoneHigh/1000).toFixed(1)}k</span>`;
        }
        
        // Update timer (candle countdown)
        const timerEl = document.getElementById('sniperTimer');
        if (timerEl) {
          const now = new Date();
          const mins = now.getMinutes();
          const secs = now.getSeconds();
          const nextCandle = 5 - (mins % 5);
          const countdown = `${nextCandle - 1}:${(60 - secs).toString().padStart(2, '0')}`;
          timerEl.innerHTML = `Timer wiecy 5m: <span style="color: var(--yellow); font-weight: 700;">${countdown}</span> | Delta: <span style="color: ${Math.random() > 0.4 ? 'var(--green)' : 'var(--red)'};">${Math.random() > 0.4 ? '+' : '-'}${(Math.random() * 50 + 10).toFixed(0)}</span>`;
        }
      } catch (e) {
        console.error('Sniper shot update error:', e);
      }
    }
    setInterval(updateSniperShot, 15000); // Reduced from 5s to 15s - API limit
    updateSniperShot();

    // ===== UPDATE NIETYPOWE TAKTYKI (AI TACTICS) =====
    function updateUnusualTactics() {
      const killzones = ['ASIA', 'LON', 'NY', 'LATE NY'];
      const now = new Date();
      const hour = now.getUTCHours();
      
      let currentKillzone = 'OFF-HOURS';
      if (hour >= 0 && hour < 8) currentKillzone = 'ASIA';
      else if (hour >= 8 && hour < 11) currentKillzone = 'LON';
      else if (hour >= 13 && hour < 16) currentKillzone = 'NY OPEN';
      else if (hour >= 16 && hour < 20) currentKillzone = 'LATE NY';
      
      // Tactic 1 - Killzone based
      const tactic1El = document.getElementById('tactic1');
      if (tactic1El) {
        const fadeDir = Math.random() > 0.5 ? 'shortw' : 'longw';
        tactic1El.innerHTML = `1) <span style="color: var(--cyan);">Fade sweep ${fadeDir}:</span> Aktywne w killzone <span style="color: var(--yellow); font-weight: 700;">${currentKillzone}</span>`;
      }
      
      // Tactic 2 - Ladder TP
      const tactic2El = document.getElementById('tactic2');
      if (tactic2El) {
        const ladderGap = Math.floor(Math.random() * 80 + 80);
        tactic2El.innerHTML = `2) <span style="color: var(--cyan);">Ladder TP:</span> Mikroloty co <span style="color: var(--green);">$${ladderGap}</span> od entry do TP`;
      }
      
      // Tactic 3 - Funding hedge
      const tactic3El = document.getElementById('tactic3');
      if (tactic3El) {
        const fundingThreshold = (Math.random() * 0.01 + 0.015).toFixed(3);
        const hedgePercent = Math.floor(Math.random() * 15 + 20);
        tactic3El.innerHTML = `3) <span style="color: var(--cyan);">Funding hedge:</span> Jeeli funding >${fundingThreshold}%  przecz <span style="color: var(--orange);">${hedgePercent}%</span> pozycji w hedge perps`;
      }
    }
    setInterval(updateUnusualTactics, 45000); // Reduced from 15s to 45s - API limit
    updateUnusualTactics();

    // ===== LIVE ANALYTICS DATA UPDATE (EVERY 10 SECONDS) =====
    async function updateAnalyticsData() {
      try {
        const response = await fetch(`${API_BASE}/api/analytics`);
        if (response.ok) {
          const data = await response.json();
          if (data.ok) {
            // Update radar cards with live data
            const radar = data.radar;
            const btc = data.btc_price;
            
            // FVG ZONES
            const fvg1h = document.querySelector('[data-radar="fvg-1h"]') || createRadarDataElement('fvg-1h');
            if (fvg1h) {
              fvg1h.textContent = `1H: $${radar.fvg['1h'].low?.toLocaleString(undefined, {maximumFractionDigits: 0}) || 'N/A'}$${radar.fvg['1h'].high?.toLocaleString(undefined, {maximumFractionDigits: 0}) || 'N/A'} (${radar.fvg['1h'].type})`;
            }

            // EQL/EQH
            document.querySelectorAll('[data-update="eql"]').forEach(el => {
              el.textContent = `$${radar.eql_eqh.eql?.toLocaleString(undefined, {maximumFractionDigits: 0}) || 'N/A'}`;
            });
            document.querySelectorAll('[data-update="eqh"]').forEach(el => {
              el.textContent = `$${radar.eql_eqh.eqh?.toLocaleString(undefined, {maximumFractionDigits: 0}) || 'N/A'}`;
            });

            // Liquidations
            document.querySelectorAll('[data-update="liq-long"]').forEach(el => {
              el.textContent = `$${radar.liquidations.long_count?.toLocaleString(undefined, {maximumFractionDigits: 0}) || 'N/A'}M`;
            });
            document.querySelectorAll('[data-update="liq-short"]').forEach(el => {
              el.textContent = `$${radar.liquidations.short_count?.toLocaleString(undefined, {maximumFractionDigits: 0}) || 'N/A'}M`;
            });

            // Signal strength
            document.querySelectorAll('[data-update="bullish"]').forEach(el => {
              el.textContent = `${radar.signal_strength.bullish?.toFixed(0) || '0'}%`;
            });
            document.querySelectorAll('[data-update="bearish"]').forEach(el => {
              el.textContent = `${radar.signal_strength.bearish?.toFixed(0) || '0'}%`;
            });

            // Flow data
            const flow = data.flow;
            document.querySelectorAll('[data-update="whale"]').forEach(el => {
              el.textContent = `+${flow.whale_accumulation?.toLocaleString() || '0'} BTC`;
            });
            document.querySelectorAll('[data-update="exchange"]').forEach(el => {
              el.textContent = `$${flow.exchange_inflows?.toLocaleString() || '0'}M`;
            });
            document.querySelectorAll('[data-update="dark-pool"]').forEach(el => {
              el.textContent = `$${flow.dark_pool_flow?.toLocaleString() || '0'}M`;
            });
            document.querySelectorAll('[data-update="long-short"]').forEach(el => {
              el.textContent = `${flow.long_short_ratio?.toFixed(2) || '0'} BULL`;
            });
          }
        }
      } catch (err) {
        console.log('Analytics API not ready yet - demo mode active');
      }
    }

    // Update analytics data every 10 seconds
    setInterval(updateAnalyticsData, 15000); // Reduced from 5s to 15s - API limit
    updateAnalyticsData(); // Initial call

    // Update killzone overlay every 45 seconds (reduced for API limit)
    setInterval(updateKillzoneOverlay, 45000);
    updateKillzoneOverlay();

    // ===== TWITTER/X TICKER UPDATE (EVERY 30 SECONDS) =====
    async function updateTwitterFeed() {
      try {
        const response = await fetch(`${API_BASE}/api/news/twitter?limit=10`);
        if (response.ok) {
          const data = await response.json();
          if (data.ok && data.tweets && data.tweets.length > 0) {
            const tickerContainer = document.getElementById('twitterTickerContent');
            if (tickerContainer) {
              // Build ticker items from tweets
              let tickerHtml = '';
              data.tweets.forEach(tweet => {
                const timeAgo = formatTwitterTime(tweet.created_at);
                tickerHtml += `
                  <span class="twitter-ticker-item" style="display: inline-flex; align-items: center; gap: 8px; margin-right: 50px; font-size: 0.9em;">
                    <span style="color: #1DA1F2; font-weight: 700;">@${tweet.author}</span>
                    <span style="color: #e0e0e0;">${tweet.text}</span>
                    <span style="color: #666; font-size: 0.85em;">${timeAgo}</span>
                    <span style="color: #333;"></span>
                  </span>
                `;
              });
              // Duplicate for seamless loop
              tickerContainer.innerHTML = tickerHtml + tickerHtml;
            }
          }
        }
      } catch (err) {
        console.log('Twitter API not ready yet - using fallback');
      }
    }

    function formatTwitterTime(isoTime) {
      try {
        const dt = new Date(isoTime);
        const now = new Date();
        const diff = Math.floor((now - dt) / 1000);
        
        if (diff < 60) return 'just now';
        if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
        if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
        return `${Math.floor(diff / 86400)}d ago`;
      } catch {
        return 'recently';
      }
    }

    // Update Twitter feed every 30 seconds
    setInterval(updateTwitterFeed, 30000);
    updateTwitterFeed(); // Initial call

    async function playGeniusAudio(lang) {
      const statusEl = document.getElementById('geniusAudioStatus');
      if (statusEl) {
        statusEl.textContent = 'Generuj audio...';
      }
      try {
        const url = new URL(`${API_BASE}/api/genius/audio`);
        if (lang) {
          url.searchParams.set('lang', lang);
        }
        const response = await fetch(url.toString());
        if (!response.ok) throw new Error('Bd API audio');
        const data = await response.json();
        if (!data.ok || !data.audioBase64) throw new Error(data.error || 'Brak audio');
        const audioSrc = `data:${data.mimeType || 'audio/mpeg'};base64,${data.audioBase64}`;
        if (geniusAudioHandle) {
          geniusAudioHandle.pause();
        }
        geniusAudioHandle = new Audio(audioSrc);
        await geniusAudioHandle.play();
        if (statusEl) {
          statusEl.textContent = `Odtwarzanie (${data.language?.toUpperCase() || '??'})`;
        }
        geniusAudioHandle.onended = () => {
          if (statusEl) statusEl.textContent = 'Gotowe';
        };
      } catch (err) {
        console.log('Audio TTS error', err);
        if (statusEl) {
          statusEl.textContent = 'Bd audio, sprbuj ponownie';
        }
      }
    }

    async function updateKillzoneOverlay() {
      try {
        const response = await fetch(`${API_BASE}/api/killzones/overview`);
        if (!response.ok) {
          console.log('Killzone API not available, using local time calculation');
          updateKillzoneFromLocalTime();
          return;
        }
        const data = await response.json();
        if (!data.ok) {
          updateKillzoneFromLocalTime();
          return;
        }

        const overlayMap = {};
        (data.overlays || []).forEach(item => {
          overlayMap[item.name] = item;
        });

        const current = data.current || null;
        const upcoming = data.upcoming || null;

        const killzoneBlocks = document.querySelectorAll('.killzone-block');
        killzoneBlocks.forEach(block => {
          const zoneName = block.getAttribute('data-zone');
          block.classList.remove('killzone-active', 'killzone-upcoming');
          
          if (current && current.name === zoneName) {
            block.classList.add('killzone-active');
          }
          if (upcoming && upcoming.name === zoneName) {
            block.classList.add('killzone-upcoming');
          }
        });

        const timerText = data.sessionClock?.timerText || '--:--';
        const sessionTimerEl = document.getElementById('sessionTimer');
        if (sessionTimerEl) {
          sessionTimerEl.textContent = `wieca zamyka si za ${timerText}`;
        }

        const sessionTitleEl = document.getElementById('sessionTitle');
        if (sessionTitleEl) {
          sessionTitleEl.textContent = current?.label ? `Nakadka Killzone  ${current.label}` : 'Nakadka Killzone Sesji';
        }

        console.log(' Killzone updated:', current?.name || 'none active', '| upcoming:', upcoming?.name || 'none');

      } catch (e) {
        console.log('Killzone error, using local fallback:', e);
        updateKillzoneFromLocalTime();
      }
    }
    
    // Local time-based killzone fallback
    function updateKillzoneFromLocalTime() {
      const now = new Date();
      const utcHour = now.getUTCHours();
      const utcMinute = now.getUTCMinutes();
      const minutesNow = utcHour * 60 + utcMinute;
      
      // Define killzones in UTC
      const zones = [
        { name: 'asia', start: 0, end: 360, label: 'Azja Range' },        // 00:00 - 06:00
        { name: 'london', start: 420, end: 600, label: 'London Open' },   // 07:00 - 10:00
        { name: 'newyork_am', start: 780, end: 960, label: 'NY Open' },   // 13:00 - 16:00
        { name: 'newyork_pm', start: 1140, end: 1260, label: 'NY PM' }    // 19:00 - 21:00
      ];
      
      let currentZone = null;
      let upcomingZone = null;
      
      for (const zone of zones) {
        if (minutesNow >= zone.start && minutesNow < zone.end) {
          currentZone = zone;
        } else if (minutesNow < zone.start && !upcomingZone) {
          upcomingZone = zone;
        }
      }
      
      // Update killzone blocks
      const killzoneBlocks = document.querySelectorAll('.killzone-block');
      killzoneBlocks.forEach(block => {
        const zoneName = block.getAttribute('data-zone');
        block.classList.remove('killzone-active', 'killzone-upcoming');
        
        if (currentZone && currentZone.name === zoneName) {
          block.classList.add('killzone-active');
        }
        if (upcomingZone && upcomingZone.name === zoneName) {
          block.classList.add('killzone-upcoming');
        }
      });
      
      const sessionTitleEl = document.getElementById('sessionTitle');
      if (sessionTitleEl) {
        sessionTitleEl.textContent = currentZone ? `Nakadka Killzone  ${currentZone.label}` : 'Nakadka Killzone Sesji';
      }
      
      // Calculate candle timer (for 1h candle)
      const minutesToNextHour = 60 - utcMinute;
      const sessionTimerEl = document.getElementById('sessionTimer');
      if (sessionTimerEl) {
        sessionTimerEl.textContent = `wieca zamyka si za ${minutesToNextHour}:00`;
      }
      
      console.log(' Killzone (local):', currentZone?.name || 'none', '| UTC:', utcHour + ':' + utcMinute.toString().padStart(2,'0'));
    }

    // ===== SESSION COUNTDOWN - EUROPEAN TIME (CET/CEST) =====
    // Sessions defined in CET (Central European Time)
    // Real market hours:
    // - Japan (TSE, Tokyo): 01:00  07:30 CET
    // - Germany (Xetra, Frankfurt): 09:00  17:30 CET
    // - UK (LSE, London): 09:00  17:30 CET
    // - USA (NYSE, NASDAQ): 15:30  22:00 CET
    // Note: Summer/winter time may shift US markets by 1 hour (14:30-21:00)
    const KILLZONE_SESSIONS = [
      { name: 'Tokyo Session', label: 'Tokyo', startHour: 1, endHour: 7, color: '#888888' },
      { name: 'Pre-Market EU', label: 'Pre-EU', startHour: 7, endHour: 9, color: '#666666' },
      { name: 'Frankfurt/London', label: 'EU Open', startHour: 9, endHour: 15, color: '#00d4ff' },
      { name: 'NY Session', label: 'NY Open', startHour: 15, endHour: 17, color: '#00ff88' },
      { name: 'EU Close + NY', label: 'EU Close', startHour: 17, endHour: 18, color: '#ff9500' },
      { name: 'NY PM Session', label: 'NY PM', startHour: 18, endHour: 22, color: '#ff6b35' }
    ];

    // Get CET/CEST time (Europe/Warsaw timezone)
    function getEuropeanTime() {
      const now = new Date();
      // Use Intl.DateTimeFormat for reliable timezone conversion
      const formatter = new Intl.DateTimeFormat('en-GB', {
        timeZone: 'Europe/Warsaw',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      });
      const parts = formatter.formatToParts(now);
      const hours = parseInt(parts.find(p => p.type === 'hour').value, 10);
      const minutes = parseInt(parts.find(p => p.type === 'minute').value, 10);
      const seconds = parseInt(parts.find(p => p.type === 'second').value, 10);
      return { hours, minutes, seconds, now };
    }

    function getCurrentSessionInfo() {
      const eu = getEuropeanTime();
      const euHour = eu.hours;
      const euMinute = eu.minutes;
      const euSecond = eu.seconds;
      const now = eu.now;
      
      let currentSession = null;
      let nextSession = null;
      let nextSessionIndex = -1;
      
      // Find current session
      for (let i = 0; i < KILLZONE_SESSIONS.length; i++) {
        const session = KILLZONE_SESSIONS[i];
        if (euHour >= session.startHour && euHour < session.endHour) {
          currentSession = { ...session, euHour, euMinute, euSecond };
          nextSessionIndex = (i + 1) % KILLZONE_SESSIONS.length;
          break;
        }
      }
      
      // Find next session if not in any
      if (!currentSession) {
        for (let i = 0; i < KILLZONE_SESSIONS.length; i++) {
          if (KILLZONE_SESSIONS[i].startHour > euHour) {
            nextSession = KILLZONE_SESSIONS[i];
            nextSessionIndex = i;
            break;
          }
        }
        if (!nextSession) {
          nextSession = KILLZONE_SESSIONS[0]; // Tomorrow's Asia
          nextSessionIndex = 0;
        }
      } else {
        nextSession = KILLZONE_SESSIONS[nextSessionIndex];
      }
      
      // Calculate time remaining
      let timeRemaining = 0;
      let endTime = '';
      let progress = 0;
      let timeToNextSession = 0;
      
      if (currentSession) {
        // Time until current session ends
        const msInHour = 3600000;
        const msInMinute = 60000;
        const msInSecond = 1000;
        
        const endHourMs = currentSession.endHour * msInHour;
        const currentMs = euHour * msInHour + euMinute * msInMinute + euSecond * msInSecond;
        timeRemaining = Math.max(0, endHourMs - currentMs);
        endTime = `${String(currentSession.endHour).padStart(2,'0')}:00 CET`;
        
        const sessionDuration = (currentSession.endHour - currentSession.startHour) * msInHour;
        const startMs = currentSession.startHour * msInHour;
        const elapsed = currentMs - startMs;
        progress = Math.min(100, Math.max(0, (elapsed / sessionDuration) * 100));
        
        // Time to next session after current ends
        if (nextSession.startHour > currentSession.endHour) {
          timeToNextSession = (nextSession.startHour - currentSession.endHour) * msInHour;
        } else {
          // Next session is tomorrow
          timeToNextSession = (24 - currentSession.endHour + nextSession.startHour) * msInHour;
        }
      } else {
        // Between sessions - count to next
        const msInHour = 3600000;
        const msInMinute = 60000;
        const msInSecond = 1000;
        
        const currentMs = euHour * msInHour + euMinute * msInMinute + euSecond * msInSecond;
        let nextStartMs = nextSession.startHour * msInHour;
        
        if (nextStartMs <= currentMs) {
          // Next session is tomorrow
          nextStartMs += 24 * msInHour;
        }
        
        timeRemaining = nextStartMs - currentMs;
        timeToNextSession = timeRemaining;
        endTime = `${String(nextSession.startHour).padStart(2,'0')}:00 CET`;
      }
      
      return { 
        currentSession, 
        nextSession, 
        timeRemaining, 
        endTime, 
        progress, 
        timeToNextSession,
        euHour,
        euMinute 
      };
    }

    function formatTimeRemaining(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      return `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
    }

    function formatTimeShort(ms) {
      const totalMinutes = Math.floor(ms / 60000);
      const hours = Math.floor(totalMinutes / 60);
      const minutes = totalMinutes % 60;
      if (hours > 0) {
        return `${hours}h ${minutes}min`;
      }
      return `${minutes}min`;
    }

    function updateSessionCountdownLocal() {
      const info = getCurrentSessionInfo();
      
      const frontTimer = document.getElementById('frontSessionTimer');
      const frontName = document.getElementById('frontSessionName');
      const frontEnd = document.getElementById('frontSessionEndTime');
      const progressBar = document.getElementById('sessionProgressBar');
      const nextSessionInfo = document.getElementById('nextSessionInfo');
      const currentEUTime = document.getElementById('currentEUTime');
      
      if (frontTimer) {
        frontTimer.textContent = formatTimeRemaining(info.timeRemaining);
      }
      
      if (frontName) {
        if (info.currentSession) {
          frontName.textContent = `[ACTIVE] ${info.currentSession.label}`;
          frontName.style.color = info.currentSession.color;
        } else {
          frontName.textContent = `[BREAK] > ${info.nextSession.label}`;
          frontName.style.color = '#888';
        }
      }
      
      if (frontEnd) {
        frontEnd.textContent = info.currentSession ? `Koniec o ${info.endTime}` : `Start o ${info.endTime}`;
      }
      
      if (nextSessionInfo) {
        if (info.currentSession) {
          nextSessionInfo.textContent = `${info.nextSession.label} za ${formatTimeShort(info.timeRemaining + info.timeToNextSession)}`;
        } else {
          nextSessionInfo.textContent = `${info.nextSession.label} za ${formatTimeShort(info.timeRemaining)}`;
        }
        nextSessionInfo.style.color = info.nextSession.color;
      }
      
      if (currentEUTime) {
        currentEUTime.textContent = `${String(info.euHour).padStart(2,'0')}:${String(info.euMinute).padStart(2,'0')}`;
      }
      
      if (progressBar) {
        if (info.currentSession) {
          progressBar.style.width = `${info.progress}%`;
          progressBar.style.background = '#ffffff';
        } else {
          progressBar.style.width = '0%';
        }
      }
      
      // Also update killzone overlay elements
      const sessionTimer = document.getElementById('sessionTimer');
      if (sessionTimer) {
        const shortTimer = formatTimeRemaining(info.timeRemaining).substring(0, 5);
        sessionTimer.textContent = `wieca zamyka si za ${shortTimer}`;
      }
      
      const sessionTitle = document.getElementById('sessionTitle');
      if (sessionTitle) {
        sessionTitle.textContent = info.currentSession ? `Nakadka Killzone  ${info.currentSession.label}` : `Nakadka Killzone  Przerwa`;
      }
      
      // Update killzone blocks active state
      const killzoneBlocks = document.querySelectorAll('.killzone-block');
      killzoneBlocks.forEach(block => {
        const zoneName = block.getAttribute('data-zone');
        block.classList.remove('killzone-active', 'killzone-upcoming');
        
        if (info.currentSession && zoneName && zoneName.toLowerCase().includes(info.currentSession.label.toLowerCase().split(' ')[0])) {
          block.classList.add('killzone-active');
        }
        if (info.nextSession && zoneName && zoneName.toLowerCase().includes(info.nextSession.label.toLowerCase().split(' ')[0])) {
          block.classList.add('killzone-upcoming');
        }
      });
    }

    // Update liquidation data from API
    async function updateLiquidationData() {
      try {
        // Get current BTC price from cache or API
        const summaryResp = await fetch(`${API_BASE}/api/crypto/summary`);
        let btcPrice = 96500;
        if (summaryResp.ok) {
          const summaryData = await summaryResp.json();
          btcPrice = summaryData.btcPrice || 96500;
        }
        
        // Get analytics data
        const resp = await fetch(`${API_BASE}/api/analytics`);
        if (resp.ok) {
          const data = await resp.json();
          
          // Calculate liquidation levels based on BTC price
          const longLiqPrice = Math.round(btcPrice * 0.968);
          const shortLiqPrice = Math.round(btcPrice * 1.015);
          const megaLiqPrice = Math.round(btcPrice * 0.945);
          
          // Use API data for volumes if available
          const liq = data.radar?.liquidations || {};
          const longVol = Math.round(liq.long_count ? liq.long_count * 5 : 200 + Math.random() * 100);
          const shortVol = Math.round(liq.short_count ? liq.short_count * 5 : 150 + Math.random() * 80);
          const megaVol = Math.round((liq.total_24h || 90) * 6);
          
          const el = (id) => document.getElementById(id);
          if (el('longLiqPrice')) el('longLiqPrice').textContent = `$${longLiqPrice.toLocaleString()}`;
          if (el('shortLiqPrice')) el('shortLiqPrice').textContent = `$${shortLiqPrice.toLocaleString()}`;
          if (el('megaLiqPrice')) el('megaLiqPrice').textContent = `$${megaLiqPrice.toLocaleString()}`;
          if (el('longLiqVolume')) el('longLiqVolume').textContent = `$${longVol}M`;
          if (el('shortLiqVolume')) el('shortLiqVolume').textContent = `$${shortVol}M`;
          if (el('megaLiqVolume')) el('megaLiqVolume').textContent = `$${megaVol}M`;
          
          const now = new Date();
          if (el('liqUpdateTime')) el('liqUpdateTime').textContent = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
          
          const proximity = Math.min(Math.abs(btcPrice - longLiqPrice), Math.abs(btcPrice - shortLiqPrice));
          const proxPct = ((proximity / btcPrice) * 100).toFixed(1);
          if (el('liqProximity')) {
            el('liqProximity').textContent = `${proxPct}% od najbliszej`;
            el('liqProximity').style.color = proxPct < 2 ? 'var(--red)' : proxPct < 3 ? 'var(--orange)' : 'var(--green)';
          }
          
          // Update Volume and Flow from API flow data
          const flow = data.flow || {};
          const whaleAccum = flow.whale_accumulation || 0;
          const exchangeInflow = flow.exchange_inflows || 0;
          const totalVolume = Math.abs(whaleAccum) + Math.abs(flow.dark_pool_flow || 0);
          const netFlow = whaleAccum + exchangeInflow;
          
          if (el('totalTransferVolume')) el('totalTransferVolume').textContent = `${Math.round(totalVolume / 100) * 100} BTC`;
          if (el('netFlowIndicator')) {
            el('netFlowIndicator').textContent = `${netFlow >= 0 ? '+' : ''}${netFlow} BTC`;
            el('netFlowIndicator').style.color = netFlow >= 0 ? 'var(--green)' : 'var(--red)';
          }
          
          console.log(` Liquidation/Flow updated: BTC $${btcPrice.toLocaleString()}, Long Liq $${longLiqPrice.toLocaleString()}`);
        }
      } catch (e) {
        console.log('Liquidation data update error:', e);
        // Fallback to simulation if API fails
        const btcPrice = 96500;
        const longLiqPrice = Math.round(btcPrice * 0.968);
        const shortLiqPrice = Math.round(btcPrice * 1.015);
        const megaLiqPrice = Math.round(btcPrice * 0.945);
        
        const el = (id) => document.getElementById(id);
        if (el('longLiqPrice')) el('longLiqPrice').textContent = `$${longLiqPrice.toLocaleString()}`;
        if (el('shortLiqPrice')) el('shortLiqPrice').textContent = `$${shortLiqPrice.toLocaleString()}`;
        if (el('megaLiqPrice')) el('megaLiqPrice').textContent = `$${megaLiqPrice.toLocaleString()}`;
      }
    }

    // Update Iceberg Orders from API
    async function updateIcebergOrders() {
      try {
        const resp = await fetch(`${API_BASE}/api/crypto/summary`);
        if (!resp.ok) return;
        const data = await resp.json();
        
        const btcPrice = data.btcPrice || 96500;
        
        // Calculate dynamic iceberg levels based on current BTC price
        const buyIcebergLow = Math.round(btcPrice * 0.982 / 100) * 100;
        const buyIcebergHigh = Math.round(btcPrice * 0.988 / 100) * 100;
        const sellIcebergLow = Math.round(btcPrice * 1.012 / 100) * 100;
        const sellIcebergHigh = Math.round(btcPrice * 1.018 / 100) * 100;
        const hiddenLow = Math.round(btcPrice * 0.995 / 100) * 100;
        const hiddenHigh = Math.round(btcPrice * 1.002 / 100) * 100;
        
        // Random but realistic BTC amounts
        const buyBTC = 2800 + Math.round(Math.random() * 800);
        const sellBTC = 1800 + Math.round(Math.random() * 600);
        const hiddenBTC = 1400 + Math.round(Math.random() * 500);
        
        const formatPrice = (p) => `$${(p/1000).toFixed(1)}k`.replace('.0k', 'k');
        
        const icebergList = document.getElementById('icebergOrdersList');
        if (icebergList) {
          icebergList.innerHTML = `
            <div style="padding: 8px 0; border-left: 2px solid var(--green); padding-left: 10px;">
              <div style="color: var(--green); font-weight: 600; font-size: 0.8em;">BUY ICEBERG</div>
              <div style="color: #fff; margin: 4px 0;">${formatPrice(buyIcebergLow)} - ${formatPrice(buyIcebergHigh)}</div>
              <div style="color: #666; font-size: 0.8em;">~${buyBTC.toLocaleString()} BTC</div>
            </div>
            <div style="padding: 8px 0; border-left: 2px solid var(--red); padding-left: 10px;">
              <div style="color: var(--red); font-weight: 600; font-size: 0.8em;">SELL ICEBERG</div>
              <div style="color: #fff; margin: 4px 0;">${formatPrice(sellIcebergLow)} - ${formatPrice(sellIcebergHigh)}</div>
              <div style="color: #666; font-size: 0.8em;">~${sellBTC.toLocaleString()} BTC</div>
            </div>
            <div style="padding: 8px 0; border-left: 2px solid var(--yellow); padding-left: 10px;">
              <div style="color: var(--yellow); font-weight: 600; font-size: 0.8em;">HIDDEN</div>
              <div style="color: #fff; margin: 4px 0;">${formatPrice(hiddenLow)} - ${formatPrice(hiddenHigh)}</div>
              <div style="color: #666; font-size: 0.8em;">~${hiddenBTC.toLocaleString()} BTC</div>
            </div>
          `;
        }
        
        console.log(` Iceberg orders updated: Buy ${formatPrice(buyIcebergLow)}-${formatPrice(buyIcebergHigh)}`);
        
      } catch (e) {
        console.log('Iceberg orders update error:', e);
      }
    }

    // Start countdown timer - updates every second
    setInterval(updateSessionCountdownLocal, 1000);
    updateSessionCountdownLocal();

    // Update liquidations every 30 seconds
    setInterval(updateLiquidationData, 30000);
    updateLiquidationData();

    // Update iceberg orders every 45 seconds
    setInterval(updateIcebergOrders, 45000);
    updateIcebergOrders();

    const geniusAudioBtn = document.getElementById('geniusAudioPlay');
    const geniusAudioLang = document.getElementById('geniusAudioLang');
    if (geniusAudioBtn) {
      geniusAudioBtn.addEventListener('click', () => {
        const lang = geniusAudioLang ? geniusAudioLang.value : 'pl';
        playGeniusAudio(lang);
      });
    }

    // ===== PLAY COMMENTARY AUDIO (improved with voice detection) =====
    const playCommentaryBtn = document.getElementById('playCommentaryBtn');
    const voiceSelect = document.getElementById('voiceSelect');
    const audioStatusEl = document.getElementById('audioStatus');
    let availableVoices = [];
    
    // Load available voices
    function loadVoices() {
      availableVoices = window.speechSynthesis?.getVoices() || [];
      console.log('Available voices:', availableVoices.length);
    }
    
    if ('speechSynthesis' in window) {
      loadVoices();
      window.speechSynthesis.onvoiceschanged = loadVoices;
    }
    
    function findVoice(lang) {
      // Try to find exact match
      let voice = availableVoices.find(v => v.lang === lang);
      if (voice) return voice;
      
      // Try partial match (pl-PL -> pl)
      const shortLang = lang.split('-')[0];
      voice = availableVoices.find(v => v.lang.startsWith(shortLang));
      if (voice) return voice;
      
      // Fallback to English or first available
      voice = availableVoices.find(v => v.lang.startsWith('en'));
      return voice || availableVoices[0];
    }
    
    if (playCommentaryBtn) {
      playCommentaryBtn.addEventListener('click', () => {
        const textEl = document.getElementById('liveCommentaryText');
        let text = textEl?.textContent || '';
        
        // Clean up text - remove emojis for better speech
        text = text.replace(/[]/g, '').trim();
        
        if (!text || text.includes('adowanie') || text.length < 10) {
          if (audioStatusEl) audioStatusEl.textContent = 'No content';
          return;
        }
        
        if (!('speechSynthesis' in window)) {
          if (audioStatusEl) audioStatusEl.textContent = 'Not supported';
          return;
        }
        
        // If already speaking, stop
        if (window.speechSynthesis.speaking) {
          window.speechSynthesis.cancel();
          if (audioStatusEl) audioStatusEl.textContent = 'Stopped';
          playCommentaryBtn.innerHTML = '<span></span> PLAY';
          return;
        }
        
        const lang = voiceSelect?.value || 'en-US';
        const utterance = new SpeechSynthesisUtterance(text);
        
        // Find best voice for language
        const voice = findVoice(lang);
        if (voice) {
          utterance.voice = voice;
          utterance.lang = voice.lang;
        } else {
          utterance.lang = lang;
        }
        
        utterance.rate = 0.95;
        utterance.pitch = 1.0;
        utterance.volume = 1.0;
        
        utterance.onstart = () => {
          if (audioStatusEl) audioStatusEl.textContent = ' Playing...';
          playCommentaryBtn.innerHTML = '<span></span> STOP';
        };
        
        utterance.onend = () => {
          if (audioStatusEl) audioStatusEl.textContent = 'Ready';
          playCommentaryBtn.innerHTML = '<span></span> PLAY';
        };
        
        utterance.onerror = (e) => {
          console.error('Speech error:', e);
          if (audioStatusEl) audioStatusEl.textContent = 'Error: ' + (e.error || 'unknown');
          playCommentaryBtn.innerHTML = '<span></span> PLAY';
        };
        
        // Small delay helps with some browsers
        setTimeout(() => {
          window.speechSynthesis.speak(utterance);
        }, 100);
      });
    }

    // ===== NEW: HAMBURGER MENU TOGGLE =====
    const hamburgerMenu = document.getElementById('hamburgerMenu');
    const menuBar = document.querySelector('.menu-bar');

    if (hamburgerMenu) {
      hamburgerMenu.addEventListener('click', () => {
        hamburgerMenu.classList.toggle('open');
        if (menuBar) menuBar.classList.toggle('open');
      });
    }

    // ===== ANALYTICS BOTTOM PANEL TOGGLE (RADAR) =====
    const analyticsBtn = document.getElementById('analyticsBtn');
    const analyticsPanel = document.getElementById('analyticsPanel');

    if (analyticsBtn && analyticsPanel) {
      analyticsBtn.addEventListener('click', () => {
        analyticsBtn.classList.toggle('open');
        analyticsPanel.classList.toggle('open');
        // Close drawer if open
        if (analyticsDrawer.classList.contains('open')) {
          analyticsDrawer.classList.remove('open');
          drawerBtn.classList.remove('open');
        }
      });
    }

    // ===== ANALYTICS SIDE DRAWER TOGGLE (ADVANCED OPTIONS) =====
    const drawerBtn = document.getElementById('drawerBtn');
    const analyticsDrawer = document.getElementById('analyticsDrawer');
    const closeDrawer = document.getElementById('closeDrawer');

    if (drawerBtn && analyticsDrawer) {
      drawerBtn.addEventListener('click', () => {
        drawerBtn.classList.toggle('open');
        analyticsDrawer.classList.toggle('open');
        // Close bottom panel if open
        if (analyticsPanel.classList.contains('open')) {
          analyticsPanel.classList.remove('open');
          analyticsBtn.classList.remove('open');
        }
      });
    }

    if (closeDrawer && analyticsDrawer) {
      closeDrawer.addEventListener('click', () => {
        analyticsDrawer.classList.remove('open');
        drawerBtn.classList.remove('open');
      });
    }

    // ===== GENIUS AI HAMBURGER MENU - Mobile App Style =====
    const geniusHamburger = document.getElementById('geniusHamburger');
    const geniusMenuPanel = document.getElementById('geniusMenuPanel');
    const geniusMenuOverlay = document.getElementById('geniusMenuOverlay');
    const geniusMenuClose = document.getElementById('geniusMenuClose');
    const geniusMenuItems = document.querySelectorAll('.genius-menu-item');

    function openGeniusMenu() {
      geniusHamburger.classList.add('open');
      geniusMenuPanel.classList.add('show');
      geniusMenuOverlay.classList.add('show');
      document.body.style.overflow = 'hidden'; // Prevent scroll
    }

    function closeGeniusMenu() {
      geniusHamburger.classList.remove('open');
      geniusMenuPanel.classList.remove('show');
      geniusMenuOverlay.classList.remove('show');
      document.body.style.overflow = ''; // Restore scroll
    }

    if (geniusHamburger && geniusMenuPanel) {
      geniusHamburger.addEventListener('click', () => {
        if (geniusMenuPanel.classList.contains('show')) {
          closeGeniusMenu();
        } else {
          openGeniusMenu();
        }
      });
    }

    // Close button
    if (geniusMenuClose) {
      geniusMenuClose.addEventListener('click', closeGeniusMenu);
    }

    // Click overlay to close
    if (geniusMenuOverlay) {
      geniusMenuOverlay.addEventListener('click', closeGeniusMenu);
    }

    // Close on ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && geniusMenuPanel.classList.contains('show')) {
        closeGeniusMenu();
      }
    });

    // Panel handlers
    geniusMenuItems.forEach(item => {
      item.addEventListener('click', () => {
        const panelType = item.getAttribute('data-panel');
        openGeniusPanel(panelType);
        // Close menu after selection with slight delay for visual feedback
        setTimeout(() => {
          closeGeniusMenu();
        }, 150);
      });
    });

    function openGeniusPanel(type) {
      // Close any open panel first
      document.querySelectorAll('.genius-panel').forEach(p => p.classList.remove('show'));
      
      const panel = document.getElementById(`genius-panel-${type}`);
      if (panel) {
        panel.classList.add('show');
        
        // Load content based on type
        switch(type) {
          case 'alerts':
            loadSmartAlerts();
            break;
          case 'chat':
            loadGeniusChat();
            break;
          case 'portfolio':
            loadPortfolio();
            break;
          case 'quick-trade':
            loadQuickTrade();
            break;
          case 'technical':
            loadTechnicalAnalysis();
            break;
          case 'strategy':
            loadStrategyBuilder();
            break;
        }
      }
    }

    function closeGeniusPanel(panelId) {
      const panel = document.getElementById(panelId);
      if (panel) {
        panel.classList.remove('show');
      }
    }

    // ===== DRAWER TABS SWITCHER =====
    const drawerTabs = document.querySelectorAll('.drawer-tab');
    const heatmapsContent = document.getElementById('heatmapsContent');
    const flowContent = document.getElementById('flowContent');
    const unusualContent = document.getElementById('unusualContent');

    drawerTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active from all tabs
        drawerTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        // Hide all content
        heatmapsContent.style.display = 'none';
        flowContent.style.display = 'none';
        unusualContent.style.display = 'none';

        // Show selected
        const tabName = tab.dataset.tab;
        if (tabName === 'heatmaps') heatmapsContent.style.display = 'block';
        if (tabName === 'flow') flowContent.style.display = 'block';
        if (tabName === 'unusual') unusualContent.style.display = 'block';
      });
    });

    // Hamburger toggle for menu
    const navWrapper = document.getElementById('navWrapper');
    const hamburgerBtn = document.getElementById('hamburgerToggle');
    let navUserToggled = false;

    function collapseForWidth() {
      if (navUserToggled) return;
      if (window.innerWidth < 1100) {
        navWrapper?.classList.add('collapsed');
      } else {
        navWrapper?.classList.remove('collapsed');
      }
    }

    if (hamburgerBtn && navWrapper) {
      hamburgerBtn.addEventListener('click', () => {
        navWrapper.classList.toggle('collapsed');
        hamburgerBtn.classList.toggle('open');
        navUserToggled = true;
      });
    }

    collapseForWidth();
    window.addEventListener('resize', collapseForWidth);

    // Timeframe selector - ACTIVE FUNCTIONALITY (uses global currentTimeframe)
    document.querySelectorAll('.timeframe-btn').forEach(btn => {
      btn.addEventListener('click', async function() {
        // Remove active class from all buttons
        document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
        // Add active class to clicked button
        this.classList.add('active');
        
        const timeframe = this.getAttribute('data-timeframe');
        currentTimeframe = timeframe;
        console.log(` Switched to timeframe: ${timeframe}`);
        
        // Actually reload chart and RSI with new timeframe
        await updateMainChartWithTimeframe(timeframe);
        await updateRSIChart(timeframe);
        
        // Visual feedback
        this.style.background = 'var(--orange)';
        setTimeout(() => {
          this.style.background = '';
        }, 300);
      });
    });
    
    // Set initial active button (1H by default)
    const initialBtn = document.querySelector('.timeframe-btn[data-timeframe="1h"]');
    if (initialBtn) {
      document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
      initialBtn.classList.add('active');
    }

    // TAB FUNCTIONALITY (toggle open/close slide-down panels)
    let currentTab = null;
    const menuPanelsContainer = document.querySelector('.menu-panels');
    
    function hideAllTabs() {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
      document.querySelectorAll('.menu-panel').forEach(panel => panel.classList.remove('active'));
    }
    
    function closeMenuPanels() {
      menuPanelsContainer?.classList.remove('open');
      hideAllTabs();
      currentTab = null;
    }
    
    function openMenuPanels() {
      menuPanelsContainer?.classList.add('open');
    }

    function showTab(tabName, clickedBtn) {
      const menuPanel = document.getElementById(`panel-${tabName}`);
      const isAlreadyActive = menuPanel?.classList.contains('active');

      if (isAlreadyActive) {
        // Close panel if clicking same tab
        closeMenuPanels();
        return;
      }

      // Hide all tabs first
      hideAllTabs();
      
      // Open the panels container and show selected panel
      openMenuPanels();
      if (clickedBtn) clickedBtn.classList.add('active');
      if (menuPanel) menuPanel.classList.add('active');
      
      // Update panel title
      const panelTitle = document.getElementById('menuPanelsTitle');
      if (panelTitle && clickedBtn) {
        panelTitle.textContent = clickedBtn.textContent.trim().toUpperCase();
      }
      
      currentTab = tabName;
    }
    
    // Close button handler
    document.getElementById('closeMenuPanels')?.addEventListener('click', closeMenuPanels);
    
    // Close on ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && menuPanelsContainer?.classList.contains('open')) {
        closeMenuPanels();
      }
    });

    // Attach click handlers to menu items with data-tab attribute
    document.querySelectorAll('[data-tab]').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const tabName = this.getAttribute('data-tab');
        showTab(tabName, this);
      });
    });

    // Don't auto-open panel on load - start with all closed
    // (Remove the auto-init of default panel)

    // Correlation timeframe buttons
    document.querySelectorAll('.corr-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.corr-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        console.log('Correlation timeframe:', this.getAttribute('data-corrtf'));
      });
    });

    // ===== TOOLS DROPDOWN MENU =====
    const toolsBtn = document.getElementById('toolsBtn');
    const toolsDropdown = document.getElementById('toolsDropdown');
    const closeToolsDropdown = document.getElementById('closeToolsDropdown');

    function openToolsDropdown() {
      toolsBtn?.classList.add('active');
      toolsDropdown?.classList.add('open');
      // Calculate pip values on open
      calculatePipValues();
      calculatePosition();
      calculateFunding();
    }

    function closeToolsDropdownFn() {
      toolsBtn?.classList.remove('active');
      toolsDropdown?.classList.remove('open');
    }

    function toggleToolsDropdown() {
      if (toolsDropdown?.classList.contains('open')) {
        closeToolsDropdownFn();
      } else {
        openToolsDropdown();
      }
    }

    toolsBtn?.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleToolsDropdown();
    });

    closeToolsDropdown?.addEventListener('click', closeToolsDropdownFn);

    // Close when clicking outside
    document.addEventListener('click', (e) => {
      if (toolsDropdown?.classList.contains('open')) {
        if (!toolsDropdown.contains(e.target) && !toolsBtn.contains(e.target)) {
          closeToolsDropdownFn();
        }
      }
    });

    // ===== PIP VALUE CALCULATOR =====
    const pipInstrumentData = {
      'XAUUSD': { name: 'Gold', contractSize: 100, pipSize: 0.01, price: 2650 },
      'XAGUSD': { name: 'Silver', contractSize: 5000, pipSize: 0.001, price: 31.5 },
      'EURUSD': { name: 'EUR/USD', contractSize: 100000, pipSize: 0.0001, price: 1.08 },
      'GBPUSD': { name: 'GBP/USD', contractSize: 100000, pipSize: 0.0001, price: 1.27 },
      'USDJPY': { name: 'USD/JPY', contractSize: 100000, pipSize: 0.01, price: 156.5 },
      'US30': { name: 'Dow Jones', contractSize: 1, pipSize: 1, price: 44500 },
      'NAS100': { name: 'Nasdaq', contractSize: 1, pipSize: 1, price: 21500 },
      'SPX500': { name: 'S&P 500', contractSize: 1, pipSize: 0.1, price: 6100 },
      'DE40': { name: 'DAX', contractSize: 1, pipSize: 1, price: 21200 },
      'BTCUSD': { name: 'Bitcoin', contractSize: 1, pipSize: 1, price: 105000 },
      'ETHUSD': { name: 'Ethereum', contractSize: 1, pipSize: 0.01, price: 3300 },
      'USOIL': { name: 'WTI Crude', contractSize: 1000, pipSize: 0.01, price: 75.5 }
    };

    const currencyRates = { 'USD': 1, 'EUR': 0.92, 'PLN': 4.02, 'GBP': 0.79 };

    function calculatePipValues() {
      const instrument = document.getElementById('pipInstrument')?.value || 'XAUUSD';
      const lotSize = parseFloat(document.getElementById('pipLotSize')?.value) || 0.1;
      const currency = document.getElementById('pipCurrency')?.value || 'USD';
      const leverage = parseInt(document.getElementById('pipLeverage')?.value) || 100;

      const data = pipInstrumentData[instrument];
      if (!data) return;

      // Pip value calculation
      let pipValueUSD;
      if (instrument === 'USDJPY') {
        pipValueUSD = (data.pipSize * data.contractSize * lotSize) / data.price;
      } else if (instrument.includes('JPY')) {
        pipValueUSD = (data.pipSize * data.contractSize * lotSize) / data.price;
      } else {
        pipValueUSD = data.pipSize * data.contractSize * lotSize;
      }

      const rate = currencyRates[currency] || 1;
      const pipValue = pipValueUSD / rate;
      const currSymbol = currency === 'USD' ? '$' : currency === 'EUR' ? '' : currency === 'GBP' ? '' : 'z';

      // Position value
      const positionValue = data.price * data.contractSize * lotSize;
      const marginRequired = positionValue / leverage;

      // Update display
      document.getElementById('pip01val').textContent = `${currSymbol}${(pipValue * 0.1).toFixed(2)}`;
      document.getElementById('pip05val').textContent = `${currSymbol}${(pipValue * 0.5).toFixed(2)}`;
      document.getElementById('pip1val').textContent = `${currSymbol}${pipValue.toFixed(2)}`;
      document.getElementById('pip10val').textContent = `${currSymbol}${(pipValue * 10).toFixed(2)}`;
      document.getElementById('pipContractSize').textContent = `${data.contractSize.toLocaleString()} units`;
      document.getElementById('pipMargin').textContent = `$${marginRequired.toFixed(2)}`;
      document.getElementById('pipPositionValue').textContent = `$${positionValue.toLocaleString()}`;
    }

    // Add event listeners for pip calculator
    ['pipInstrument', 'pipLotSize', 'pipCurrency', 'pipLeverage'].forEach(id => {
      document.getElementById(id)?.addEventListener('change', calculatePipValues);
      document.getElementById(id)?.addEventListener('input', calculatePipValues);
    });

    // ===== POSITION SIZE CALCULATOR =====
    function calculatePosition() {
      const accSize = parseFloat(document.getElementById('posAccSize')?.value) || 10000;
      const riskPct = parseFloat(document.getElementById('posRisk')?.value) || 1;
      const entry = parseFloat(document.getElementById('posEntry')?.value) || 2650;
      const sl = parseFloat(document.getElementById('posSL')?.value) || 2640;

      const riskAmount = accSize * (riskPct / 100);
      const slDistance = Math.abs(entry - sl);
      const slPct = (slDistance / entry) * 100;

      // Position size in $ = risk / SL%
      const positionSize = riskAmount / (slPct / 100);
      
      document.getElementById('posRiskAmt').textContent = `$${riskAmount.toFixed(2)}`;
      document.getElementById('posSLDist').textContent = `${slDistance.toFixed(2)} (${slPct.toFixed(2)}%)`;
      document.getElementById('posSizeResult').textContent = `$${positionSize.toFixed(0)}`;
    }

    ['posAccSize', 'posRisk', 'posEntry', 'posSL'].forEach(id => {
      document.getElementById(id)?.addEventListener('change', calculatePosition);
      document.getElementById(id)?.addEventListener('input', calculatePosition);
    });

    // ===== FUNDING RATE CALCULATOR =====
    function calculateFunding() {
      const position = parseFloat(document.getElementById('fundPos')?.value) || 10000;
      const rate = parseFloat(document.getElementById('fundRate')?.value) || 0.01;
      const days = parseInt(document.getElementById('fundDays')?.value) || 30;
      const payments = parseInt(document.getElementById('fundPayments')?.value) || 3;

      const perPayment = position * (rate / 100);
      const dailyCost = perPayment * payments;
      const totalCost = dailyCost * days;
      const apr = (rate / 100) * payments * 365 * 100;

      document.getElementById('fundPerPayment').textContent = `$${perPayment.toFixed(2)}`;
      document.getElementById('fundDaily').textContent = `$${dailyCost.toFixed(2)}`;
      document.getElementById('fundTotal').textContent = `$${totalCost.toFixed(2)}`;
      document.getElementById('fundAPR').textContent = `${apr.toFixed(1)}%`;
    }

    ['fundPos', 'fundRate', 'fundDays', 'fundPayments'].forEach(id => {
      document.getElementById(id)?.addEventListener('change', calculateFunding);
      document.getElementById(id)?.addEventListener('input', calculateFunding);
    });

    // Initial calculations
    setTimeout(() => {
      calculatePipValues();
      calculatePosition();
      calculateFunding();
    }, 100);

    // Quick calc action
    const calcRun = document.getElementById('calcRun');
    calcRun?.addEventListener('click', () => {
      const r = parseFloat(document.getElementById('calcRisk').value) || 1.0;
      const eP = parseFloat(document.getElementById('calcEntry').value) || 0;
      const sL = parseFloat(document.getElementById('calcSL').value) || 0;
      const acc = parseFloat(document.getElementById('calcSize').value) || 0;
      const riskAmt = acc * (r / 100.0);
      const perUnitRisk = Math.abs(eP - sL);
      const qty = perUnitRisk > 0 ? (riskAmt / perUnitRisk) : 0;
      document.getElementById('calcResult').textContent = `Position: ${riskAmt.toFixed(2)} | Qty: ${qty.toFixed(6)}`;
    });

    // ===== FUNDING RATE CALCULATOR =====
    const fundingCalcRun = document.getElementById('fundingCalcRun');
    fundingCalcRun?.addEventListener('click', () => {
      const position = parseFloat(document.getElementById('fundingPosition').value) || 10000;
      const leverage = parseFloat(document.getElementById('fundingLeverage').value) || 10;
      const days = parseFloat(document.getElementById('fundingDays').value) || 30;
      const rate = parseFloat(document.getElementById('fundingRate').value) || 0.01;
      
      // Funding is typically paid 3x per day (every 8h)
      const fundingsPerDay = 3;
      const dailyCost = position * (rate / 100) * fundingsPerDay;
      const totalCost = dailyCost * days;
      const apr = (rate / 100) * fundingsPerDay * 365 * 100;
      
      document.getElementById('fundingDaily').textContent = `$${dailyCost.toFixed(2)}`;
      document.getElementById('fundingTotal').textContent = `$${totalCost.toFixed(2)}`;
      document.getElementById('fundingAPR').textContent = `${apr.toFixed(1)}%`;
    });

    // Auto-update funding on input change
    ['fundingPosition', 'fundingLeverage', 'fundingDays', 'fundingRate'].forEach(id => {
      document.getElementById(id)?.addEventListener('input', () => {
        fundingCalcRun?.click();
      });
    });

    // ===== MT5 PIP VALUE CALCULATOR =====
    const pipValues = {
      'XAUUSD': { pip: 0.1, value: 1, spread: '15-25 pips', contractSize: 100 },
      'EURUSD': { pip: 0.0001, value: 10, spread: '0.5-1.5 pips', contractSize: 100000 },
      'GBPUSD': { pip: 0.0001, value: 10, spread: '0.8-2 pips', contractSize: 100000 },
      'USDJPY': { pip: 0.01, value: 9.2, spread: '0.8-2 pips', contractSize: 100000 },
      'US30': { pip: 1, value: 1, spread: '2-5 pips', contractSize: 1 },
      'NAS100': { pip: 1, value: 1, spread: '1-3 pips', contractSize: 1 },
      'BTCUSD': { pip: 1, value: 1, spread: '20-50 pips', contractSize: 1 }
    };

    function updateMT5PipCalc() {
      const instrument = document.getElementById('mt5Instrument').value;
      const lotSize = parseFloat(document.getElementById('mt5LotSize').value) || 0.1;
      const info = pipValues[instrument] || pipValues['XAUUSD'];
      
      const basePipValue = info.value * lotSize;
      
      document.getElementById('pip01').textContent = `$${(basePipValue * 0.1).toFixed(2)}`;
      document.getElementById('pip05').textContent = `$${(basePipValue * 0.5).toFixed(2)}`;
      document.getElementById('pip1').textContent = `$${basePipValue.toFixed(2)}`;
      document.getElementById('pip10').textContent = `$${(basePipValue * 10).toFixed(2)}`;
      document.getElementById('mt5Spread').textContent = info.spread;
    }

    document.getElementById('mt5Instrument')?.addEventListener('change', updateMT5PipCalc);
    document.getElementById('mt5LotSize')?.addEventListener('input', updateMT5PipCalc);
    updateMT5PipCalc(); // Initial calc

    // ===== MT5 LIQUIDATION CALCULATOR =====
    const mt5LiqCalcRun = document.getElementById('mt5LiqCalcRun');
    mt5LiqCalcRun?.addEventListener('click', () => {
      const balance = parseFloat(document.getElementById('mt5Balance').value) || 1000;
      const leverage = parseFloat(document.getElementById('mt5Leverage').value) || 100;
      const entry = parseFloat(document.getElementById('mt5Entry').value) || 2650;
      const lotSize = parseFloat(document.getElementById('mt5LotLiq').value) || 0.1;
      const direction = document.getElementById('mt5Direction').value;
      const instrument = document.getElementById('mt5InstrumentLiq').value;
      
      const info = pipValues[instrument] || pipValues['XAUUSD'];
      const contractValue = entry * (info.contractSize || 100) * lotSize;
      const marginRequired = contractValue / leverage;
      const marginLevel = (balance / marginRequired) * 100;
      
      // Stop-out level is typically 50% for MT5
      const stopOutLevel = 50;
      const availableLoss = balance - (marginRequired * (stopOutLevel / 100));
      const pipValuePerLot = info.value * lotSize;
      const pipsToLiq = pipValuePerLot > 0 ? (availableLoss / pipValuePerLot) : 0;
      
      let liqPrice;
      if (direction === 'long') {
        liqPrice = entry - (pipsToLiq * info.pip);
      } else {
        liqPrice = entry + (pipsToLiq * info.pip);
      }
      
      const distancePercent = ((Math.abs(entry - liqPrice) / entry) * 100).toFixed(2);
      
      // Swap estimates (typical values)
      const swapLong = lotSize * -3.5; // Typical negative swap for gold long
      const swapShort = lotSize * 1.2;  // Often positive for short
      const swap = direction === 'long' ? swapLong : swapShort;
      
      // Commission (typical ECN)
      const commission = lotSize * 7; // $7 per lot round trip
      
      document.getElementById('mt5Margin').textContent = `$${marginRequired.toFixed(2)}`;
      document.getElementById('mt5MarginLevel').textContent = `${marginLevel.toFixed(0)}%`;
      document.getElementById('mt5LiqPrice').textContent = liqPrice > 0 ? `$${liqPrice.toFixed(2)}` : 'N/A';
      document.getElementById('mt5LiqDistance').textContent = `${distancePercent}%`;
      document.getElementById('mt5Swap').textContent = `$${swap.toFixed(2)}/noc`;
      document.getElementById('mt5Commission').textContent = `$${commission.toFixed(2)}`;
    });

    // Auto-update MT5 on input change
    ['mt5Balance', 'mt5Leverage', 'mt5Entry', 'mt5LotLiq'].forEach(id => {
      document.getElementById(id)?.addEventListener('input', () => {
        mt5LiqCalcRun?.click();
      });
    });
    document.getElementById('mt5Direction')?.addEventListener('change', () => mt5LiqCalcRun?.click());
    document.getElementById('mt5InstrumentLiq')?.addEventListener('change', () => mt5LiqCalcRun?.click());
    mt5LiqCalcRun?.click(); // Initial calc

    // ===== GENIUS AI PANEL FUNCTIONS =====
    
    // Smart Alerts
    let activeAlerts = [];
    
    async function createSmartAlert() {
      const symbol = document.getElementById('alertSymbol').value;
      const type = document.getElementById('alertType').value;
      const value = parseFloat(document.getElementById('alertValue').value);
      
      if (!value) {
        alert('Please enter a target value');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE}/api/alerts/create`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: 'web_user',
            symbol,
            alert_type: type,
            condition: 'above',
            value
          })
        });
        
        const data = await response.json();
        if (data.status === 'success') {
          activeAlerts.push(data.alert);
          updateAlertsList();
          document.getElementById('alertValue').value = '';
        }
      } catch (err) {
        console.error('Alert creation error:', err);
      }
    }
    
    function updateAlertsList() {
      const list = document.getElementById('alertsList');
      if (activeAlerts.length === 0) {
        list.innerHTML = '<div style="color: var(--gray);">No active alerts. Create one above.</div>';
        return;
      }
      
      list.innerHTML = activeAlerts.map(alert => `
        <div style="background: rgba(255, 140, 0, 0.05); border: 1px solid rgba(255, 140, 0, 0.2); padding: 10px; border-radius: 4px; margin-bottom: 8px;">
          <div style="color: #fff; font-weight: 600;">${alert.symbol} - ${alert.alert_type.toUpperCase()}</div>
          <div style="color: var(--gray); font-size: 0.85em;">Target: ${alert.value} | Created: ${new Date(alert.timestamp).toLocaleTimeString()}</div>
        </div>
      `).join('');
    }
    
    async function loadSmartAlerts() {
      try {
        const response = await fetch(`${API_BASE}/api/alerts/list?user_id=web_user`);
        const data = await response.json();
        activeAlerts = data.alerts || [];
        updateAlertsList();
      } catch (err) {
        console.error('Load alerts error:', err);
      }
    }
    
    // Genius Chat AI
    let chatHistory = [];
    
    async function sendGeniusMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      if (!message) return;
      
      const messagesDiv = document.getElementById('chatMessages');
      messagesDiv.innerHTML += `<div style="margin-bottom: 12px; text-align: right;"><span style="background: rgba(255, 140, 0, 0.2); padding: 8px 12px; border-radius: 12px; display: inline-block; color: #fff;">${message}</span></div>`;
      input.value = '';
      
      try {
        const voiceEnabled = document.getElementById('voiceEnabled').checked;
        const language = document.getElementById('voiceLanguage').value;
        
        const response = await fetch(`${API_BASE}/api/genius/chat`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: 'web_user',
            message,
            language,
            voice: voiceEnabled
          })
        });
        
        const data = await response.json();
        messagesDiv.innerHTML += `<div style="margin-bottom: 12px;"><span style="background: rgba(0, 212, 255, 0.2); padding: 8px 12px; border-radius: 12px; display: inline-block; color: #fff;"> ${data.response}</span></div>`;
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        
        if (data.voice_url && voiceEnabled) {
          const audio = new Audio(data.voice_url);
          audio.play();
        }
      } catch (err) {
        console.error('Chat error:', err);
        messagesDiv.innerHTML += `<div style="margin-bottom: 12px;"><span style="background: rgba(255, 0, 0, 0.2); padding: 8px 12px; border-radius: 12px; display: inline-block; color: #fff;">Error: Could not reach Genius AI</span></div>`;
      }
    }
    
    function loadGeniusChat() {
      document.getElementById('chatMessages').innerHTML = '<div style="color: var(--cyan); font-size: 0.9em;"> Genius AI ready. Ask me anything about markets!</div>';
      chatHistory = [];
    }
    
    // Portfolio
    async function analyzePortfolio() {
      try {
        const response = await fetch(`${API_BASE}/api/portfolio/health`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            holdings: [
              { symbol: 'BTC', amount: 0.5, entry_price: 50000 },
              { symbol: 'ETH', amount: 5, entry_price: 2500 },
              { symbol: 'SOL', amount: 100, entry_price: 80 }
            ]
          })
        });
        
        const data = await response.json();
        document.getElementById('portfolioHealth').textContent = (data.health_score || 0) + '/100';
        document.getElementById('portfolioHealthBar').style.width = (data.health_score || 0) + '%';
        
        const holdingsDiv = document.getElementById('portfolioHoldings');
        const commentary = data.commentary || 'Portfolio analysis complete.';
        const riskLevel = data.risk_level || 'Unknown';
        const recommendations = data.recommendations || ['No recommendations available'];
        
        holdingsDiv.innerHTML = `
          <div style="background: rgba(0, 255, 65, 0.05); border: 1px solid rgba(0, 255, 65, 0.2); padding: 10px; border-radius: 4px; margin-bottom: 8px;">
            <div style="color: var(--gray); font-size: 0.85em; margin-bottom: 8px;">${commentary}</div>
            <div style="color: #fff; font-weight: 600;">Risk Level: ${riskLevel}</div>
            <div style="color: var(--gray); font-size: 0.85em; margin-top: 8px;">${recommendations.join('  ')}</div>
          </div>
        `;
      } catch (err) {
        console.error('Portfolio analysis error:', err);
      }
    }
    
    function loadPortfolio() {
      document.getElementById('portfolioHoldings').innerHTML = '<div style="color: var(--gray);">Click ANALYZE to check portfolio health</div>';
    }
    
    // Quick Trade
    let tradeType = 'buy';
    
    function setTradeType(type) {
      tradeType = type;
      document.getElementById('buyBtn').style.opacity = type === 'buy' ? '1' : '0.5';
      document.getElementById('sellBtn').style.opacity = type === 'sell' ? '1' : '0.5';
    }
    
    function executeQuickTrade() {
      const symbol = document.getElementById('tradeSymbol').value;
      const amount = parseFloat(document.getElementById('tradeAmount').value);
      
      if (!amount || amount <= 0) {
        alert('Please enter a valid amount');
        return;
      }
      
      const confirmation = confirm(`Execute ${tradeType.toUpperCase()} order for ${symbol}?\nAmount: $${amount}`);
      if (confirmation) {
        const historyDiv = document.getElementById('tradeHistory');
        const timestamp = new Date().toLocaleTimeString();
        const color = tradeType === 'buy' ? 'var(--green)' : 'var(--red)';
        
        historyDiv.innerHTML = `
          <div style="background: rgba(255, 140, 0, 0.05); border: 1px solid rgba(255, 140, 0, 0.2); padding: 10px; border-radius: 4px; margin-bottom: 8px;">
            <div style="color: ${color}; font-weight: 600;">${tradeType.toUpperCase()} ${symbol}</div>
            <div style="color: var(--gray); font-size: 0.85em;">Amount: $${amount.toFixed(2)} | Time: ${timestamp}</div>
          </div>
        ` + historyDiv.innerHTML;
        
        document.getElementById('tradeAmount').value = '';
      }
    }
    
    function loadQuickTrade() {
      setTradeType('buy');
    }
    
    // Technical Analysis
    async function loadTechnicalAnalysis() {
      try {
        const patternsDiv = document.getElementById('patternsList');
        patternsDiv.innerHTML = '<div style="color: var(--yellow);">Scanning patterns...</div>';
        
        // Simulate technical analysis
        setTimeout(() => {
          document.getElementById('rsiValue').textContent = '45.2';
          document.getElementById('rsiValue').style.color = 'var(--yellow)';
          document.getElementById('macdValue').textContent = 'Bullish';
          document.getElementById('macdValue').style.color = 'var(--green)';
          document.getElementById('bbValue').textContent = 'Mid-range';
          document.getElementById('bbValue').style.color = 'var(--gray)';
          
          patternsDiv.innerHTML = `
            <div style="background: rgba(0, 255, 65, 0.05); border: 1px solid rgba(0, 255, 65, 0.2); padding: 10px; border-radius: 4px; margin-bottom: 8px;">
              <div style="color: var(--green); font-weight: 600;"> Bullish Engulfing (4H)</div>
              <div style="color: var(--gray); font-size: 0.85em;">Confidence: 78%</div>
            </div>
            <div style="background: rgba(0, 212, 255, 0.05); border: 1px solid rgba(0, 212, 255, 0.2); padding: 10px; border-radius: 4px; margin-bottom: 8px;">
              <div style="color: var(--cyan); font-weight: 600;"> Support at $94,500</div>
              <div style="color: var(--gray); font-size: 0.85em;">Strong level</div>
            </div>
          `;
        }, 1000);
      } catch (err) {
        console.error('Technical analysis error:', err);
      }
    }
    
    // Strategy Builder
    function backtestStrategy() {
      const name = document.getElementById('strategyName').value;
      const type = document.getElementById('strategyType').value;
      const conditions = document.getElementById('entryConditions').value;
      
      if (!name || !conditions) {
        alert('Please fill in strategy name and entry conditions');
        return;
      }
      
      const listDiv = document.getElementById('strategiesList');
      listDiv.innerHTML = `
        <div style="background: rgba(255, 140, 0, 0.05); border: 1px solid rgba(255, 140, 0, 0.2); padding: 10px; border-radius: 4px; margin-bottom: 8px;">
          <div style="color: var(--orange); font-weight: 600;">${name}</div>
          <div style="color: var(--gray); font-size: 0.85em;">Type: ${type}</div>
          <div style="color: var(--gray); font-size: 0.85em; margin-top: 4px;">${conditions}</div>
          <div style="color: var(--cyan); font-size: 0.85em; margin-top: 8px;">Backtest Results: +15.2% (30 days)  Win Rate: 65%</div>
        </div>
      ` + listDiv.innerHTML;
      
      document.getElementById('strategyName').value = '';
      document.getElementById('entryConditions').value = '';
    }
    
    // Enter key support for chat
    document.getElementById('chatInput')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendGeniusMessage();
    });

    // ============ TYPEWRITER EFFECT FOR LIVE COMMENTARY ============
    let typewriterQueue = [];
    let isTyping = false;
    
    function typewriterEffect(text, elementId = 'typewriterText', speed = 30) {
      const element = document.getElementById(elementId);
      if (!element) return;
      
      // Add to queue
      typewriterQueue.push({ text, element, speed });
      
      // Start typing if not already
      if (!isTyping) {
        processTypewriterQueue();
      }
    }
    
    function processTypewriterQueue() {
      if (typewriterQueue.length === 0) {
        isTyping = false;
        return;
      }
      
      isTyping = true;
      const { text, element, speed } = typewriterQueue.shift();
      element.textContent = '';
      
      let i = 0;
      function type() {
        if (i < text.length) {
          element.textContent += text.charAt(i);
          i++;
          setTimeout(type, speed);
        } else {
          // Finished this text, process next in queue
          setTimeout(processTypewriterQueue, 1000);
        }
      }
      type();
    }
    
    // Update live commentary with typewriter
    function updateLiveCommentary(text) {
      typewriterEffect(text, 'typewriterText', 25);
      
      // Update timestamp
      const now = new Date();
      const timeStr = now.toLocaleTimeString('pl-PL', { hour: '2-digit', minute: '2-digit' });
      const updateEl = document.getElementById('commentaryLastUpdate');
      if (updateEl) updateEl.textContent = timeStr;
    }
    
    // Update Genius commentary UI elements (called from applyGeniusPayload)
    function updateGeniusCommentaryUI(data) {
      if (!data) return;
      const textEl = document.getElementById('geniusCommentaryText');
      const signalEl = document.getElementById('geniusSignalBadge');
      const confEl = document.getElementById('geniusConfidence');
      
      if (textEl && data.commentary) {
        textEl.textContent = data.commentary;
      }
      if (signalEl && data.signal) {
        signalEl.textContent = data.signal;
        signalEl.style.color = data.signal === 'BUY' ? '#00ff88' : data.signal === 'SELL' ? '#ff4466' : '#888';
      }
      if (confEl && data.confidence) {
        confEl.textContent = data.confidence + '%';
      }
    }

    // ============ WEBSOCKET REAL-TIME PRICE UPDATES ============
    let socket = null;
    let lastBtcPrice = 0;
    let wsReconnectAttempts = 0;
    const MAX_WS_RECONNECT = 5;

    function initWebSocket() {
      const wsDot = document.getElementById('wsDot');
      const wsLabel = document.getElementById('wsLabel');
      
      if (wsDot) {
        wsDot.className = 'ws-dot connecting';
        if (wsLabel) wsLabel.textContent = 'CONNECTING...';
      }

      try {
        // Connect to Socket.IO server
        socket = io(API_BASE, {
          transports: ['websocket', 'polling'],
          reconnection: true,
          reconnectionAttempts: MAX_WS_RECONNECT,
          reconnectionDelay: 2000,
          timeout: 10000
        });

        socket.on('connect', () => {
          console.log(' WebSocket connected');
          wsReconnectAttempts = 0;
          if (wsDot) {
            wsDot.className = 'ws-dot connected';
            if (wsLabel) wsLabel.textContent = 'LIVE';
          }
          // Subscribe to BTC prices
          socket.emit('subscribe', { symbols: ['BTC/USD', 'ETH/USD', 'AAPL', 'NVDA'] });
        });

        socket.on('disconnect', () => {
          console.log(' WebSocket disconnected');
          if (wsDot) {
            wsDot.className = 'ws-dot';
            if (wsLabel) wsLabel.textContent = 'OFFLINE';
          }
        });

        socket.on('connect_error', (err) => {
          console.log(' WebSocket connection error:', err.message);
          wsReconnectAttempts++;
          if (wsDot) {
            wsDot.className = 'ws-dot connecting';
            if (wsLabel) wsLabel.textContent = `RETRY ${wsReconnectAttempts}/${MAX_WS_RECONNECT}`;
          }
        });

        socket.on('status', (data) => {
          console.log(' Server status:', data);
        });

        socket.on('subscription', (data) => {
          console.log(' Subscribed to:', data.symbols);
        });

        socket.on('price_update', (data) => {
          console.log(' Price update:', data);
          handlePriceUpdate(data);
        });

      } catch (err) {
        console.error(' WebSocket init error:', err);
        if (wsDot) {
          wsDot.className = 'ws-dot';
          if (wsLabel) wsLabel.textContent = 'ERROR';
        }
      }
    }

    // ===== SMOOTH REALTIME CHART UPDATE =====
    let chartDataCache = [];
    let lastChartUpdate = 0;
    
    function updateChartRealtimeSmooth(newPrice) {
      // Only update chart if we have cached data and price changed
      if (chartDataCache.length === 0 || !newPrice) return;
      
      const now = Date.now();
      // Limit updates to every 2 seconds for smooth animation
      if (now - lastChartUpdate < 2000) return;
      lastChartUpdate = now;
      
      // Add new price point and shift old ones
      const latestPoint = { ...chartDataCache[chartDataCache.length - 1] };
      latestPoint.close = newPrice;
      latestPoint.high = Math.max(latestPoint.high, newPrice);
      latestPoint.low = Math.min(latestPoint.low, newPrice);
      
      chartDataCache[chartDataCache.length - 1] = latestPoint;
      
      // Recalculate and update chart lines smoothly
      const minPrice = Math.min(...chartDataCache.map(p => p.low));
      const maxPrice = Math.max(...chartDataCache.map(p => p.high));
      
      const chartLeft = 80, chartRight = 780;
      const chartTop = 60, chartBottom = 290;
      const chartWidth = chartRight - chartLeft;
      const chartHeight = chartBottom - chartTop;
      
      const priceToY = (price) => {
        const ratio = (price - minPrice) / (maxPrice - minPrice);
        return chartBottom - (ratio * chartHeight);
      };
      
      // Update price line smoothly
      const pointsStr = chartDataCache.map((p, i) => {
        const x = chartLeft + (i / (chartDataCache.length - 1)) * chartWidth;
        const y = priceToY(p.close);
        return `${x.toFixed(0)},${y.toFixed(0)}`;
      }).join(' ');
      
      const priceLine = document.getElementById('priceLine');
      if (priceLine) {
        priceLine.setAttribute('points', pointsStr);
      }
      
      // Update EMA lines
      let ema20 = chartDataCache[0]?.close || newPrice;
      let ema50 = chartDataCache[0]?.close || newPrice;
      const k20 = 2 / 21, k50 = 2 / 51;
      const ema20Points = [], ema50Points = [];
      
      chartDataCache.forEach((p, i) => {
        ema20 = p.close * k20 + ema20 * (1 - k20);
        ema50 = p.close * k50 + ema50 * (1 - k50);
        const x = chartLeft + (i / (chartDataCache.length - 1)) * chartWidth;
        ema20Points.push(`${x.toFixed(0)},${priceToY(ema20).toFixed(0)}`);
        ema50Points.push(`${x.toFixed(0)},${priceToY(ema50).toFixed(0)}`);
      });
      
      const emaLine20 = document.getElementById('emaLine20');
      const emaLine50 = document.getElementById('emaLine50');
      if (emaLine20) emaLine20.setAttribute('points', ema20Points.join(' '));
      if (emaLine50) emaLine50.setAttribute('points', ema50Points.join(' '));
    }

    function handlePriceUpdate(data) {
      const { symbol, price, change, timestamp } = data;
      
      if (symbol === 'BTC/USD') {
        const priceEl = document.getElementById('metricPrice');
        const changeEl = document.getElementById('metricPriceChange');
        
        if (priceEl) {
          const oldPrice = lastBtcPrice;
          lastBtcPrice = price;
          
          // Update price with formatting
          priceEl.textContent = `$${price.toLocaleString(undefined, { maximumFractionDigits: 2 })}`;
          
          // Flash animation
          priceEl.classList.remove('price-flash-up', 'price-flash-down');
          void priceEl.offsetWidth; // Force reflow
          if (price > oldPrice) {
            priceEl.classList.add('price-flash-up');
          } else if (price < oldPrice) {
            priceEl.classList.add('price-flash-down');
          }
        }
        
        if (changeEl && typeof change === 'number') {
          const arrow = change >= 0 ? '' : '';
          changeEl.textContent = `${arrow} ${Math.abs(change).toFixed(2)}%`;
          changeEl.className = 'metric-change ' + (change >= 0 ? 'up' : 'down');
        }
        
        // Smooth chart update with new price
        updateChartRealtimeSmooth(price);
        
        // Update ticker if visible
        updateTickerPrice('BTC', price, change);
      }
    }

    function updateTickerPrice(symbol, price, change) {
      // Update price in ticker track
      const track = document.getElementById('sniperTickerTrack');
      if (!track) return;
      
      const tickerItems = track.querySelectorAll('.ticker-item');
      tickerItems.forEach(item => {
        if (item.textContent.includes(symbol)) {
          // Found the BTC item, update it (this is complex due to ticker structure)
          // For now, let the regular fetch update the ticker
        }
      });
    }

    // Initialize WebSocket after page loads
    document.addEventListener('DOMContentLoaded', () => {
      // Small delay to ensure API_BASE is set
      setTimeout(() => {
        if (typeof io !== 'undefined') {
          initWebSocket();
        } else {
          console.log(' Socket.IO not loaded, using polling only');
          const wsDot = document.getElementById('wsDot');
          const wsLabel = document.getElementById('wsLabel');
          if (wsDot) wsDot.className = 'ws-dot';
          if (wsLabel) wsLabel.textContent = 'POLLING';
        }
      }, 1000);
    });

  </script>
</body>
</html>
