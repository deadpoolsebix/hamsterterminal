<!-- BREAKING NEWS - REAL-TIME MARKET NEWS TICKER (TWELVE DATA API) -->
<!-- 
    Professional Breaking News system with:
    - Real-time market news from Twelve Data API
    - Polish language support with English headlines
    - Smooth horizontal scrolling animation
    - News categorization (CRYPTO, STOCKS, MARKETS, ECONOMY)
    - Importance indicators
    - Hover pause functionality
-->

<style>
    @keyframes newsScroll {
        0% { transform: translateX(100%); }
        100% { transform: translateX(-100%); }
    }
    
    .breaking-news-wrapper {
        margin-top: 12px;
        margin-left: 30px;
        margin-right: 30px;
        padding: 10px 15px;
        background: linear-gradient(90deg, #1a0a00 0%, #0a0a0a 50%, #1a0a00 100%);
        border: 2px solid #ff3300;
        border-radius: 3px;
        overflow: hidden;
        position: relative;
        font-family: 'Roboto Mono', 'Courier New', monospace;
        min-height: 45px;
        display: flex;
        align-items: center;
        box-shadow: 0 0 15px rgba(255, 51, 0, 0.3), inset 0 0 10px rgba(0, 0, 0, 0.8);
    }
    
    .breaking-news-label {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        background: linear-gradient(135deg, #ff3300, #ff6600);
        color: #000;
        padding: 4px 10px;
        border-radius: 3px;
        font-weight: 900;
        font-size: 0.8em;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        white-space: nowrap;
        z-index: 10;
        box-shadow: 0 0 10px rgba(255, 51, 0, 0.6);
        animation: newsLabelPulse 2s ease-in-out infinite;
    }
    
    @keyframes newsLabelPulse {
        0%, 100% { box-shadow: 0 0 10px rgba(255, 51, 0, 0.6); }
        50% { box-shadow: 0 0 20px rgba(255, 51, 0, 0.9); }
    }
    
    .breaking-news-scroll {
        display: flex;
        align-items: center;
        gap: 30px;
        animation: newsScroll 60s linear infinite;
        white-space: nowrap;
        font-size: 0.9em;
        font-weight: 600;
        letter-spacing: 0.5px;
        margin-left: 160px;
    }
    
    .breaking-news-item {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 8px 15px;
        background: rgba(255, 51, 0, 0.05);
        border-left: 3px solid #ff3300;
        border-radius: 2px;
        flex-shrink: 0;
        transition: all 0.3s ease;
    }
    
    .breaking-news-item:hover {
        background: rgba(255, 51, 0, 0.15);
        box-shadow: 0 0 15px rgba(255, 51, 0, 0.4);
    }
    
    .news-importance {
        font-size: 0.8em;
        font-weight: 800;
        padding: 2px 6px;
        border-radius: 2px;
        text-transform: uppercase;
        flex-shrink: 0;
    }
    
    .news-importance.high {
        background: #ff0033;
        color: #fff;
    }
    
    .news-importance.medium {
        background: #ffaa00;
        color: #000;
    }
    
    .news-importance.low {
        background: #00ff41;
        color: #000;
    }
    
    .news-source {
        color: #00d4ff;
        font-weight: 700;
        font-size: 0.85em;
        flex-shrink: 0;
    }
    
    .news-headline {
        color: #fff;
        font-weight: 600;
        max-width: 500px;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .news-time {
        color: #ffaa00;
        font-size: 0.8em;
        flex-shrink: 0;
    }
    
    .breaking-news-wrapper:hover .breaking-news-scroll {
        animation-play-state: paused;
    }
    
    .news-loading {
        color: #ffaa00;
        font-weight: 700;
        text-align: center;
        width: 100%;
        margin-left: 0;
    }
    
    .news-category-tag {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 2px;
        font-size: 0.75em;
        font-weight: 800;
        text-transform: uppercase;
        margin-right: 5px;
        flex-shrink: 0;
    }
    
    .category-crypto {
        background: rgba(255, 215, 0, 0.2);
        color: #ffd700;
        border: 1px solid #ffd700;
    }
    
    .category-stocks {
        background: rgba(0, 255, 65, 0.2);
        color: #00ff41;
        border: 1px solid #00ff41;
    }
    
    .category-markets {
        background: rgba(0, 212, 255, 0.2);
        color: #00d4ff;
        border: 1px solid #00d4ff;
    }
    
    .category-economy {
        background: rgba(138, 43, 226, 0.2);
        color: #8a2be2;
        border: 1px solid #8a2be2;
    }
</style>

<div class="breaking-news-wrapper" id="breakingNewsWrapper">
    <span class="breaking-news-label">ðŸ”´ BREAKING NEWS</span>
    <div class="news-loading">Loading breaking news...</div>
</div>

<script>
    // ============================================
    // BREAKING NEWS TICKER - TWELVE DATA NEWS API
    // ============================================
    
    const TWELVE_DATA_KEY = '5203977ec0204755904ef326abe77e7c';
    
    // Polish translations for common terms
    const POLISH_TRANSLATIONS = {
        'Bitcoin': 'Bitcoin',
        'Ethereum': 'Ethereum',
        'Crypto': 'Krypto',
        'Stock': 'Akcje',
        'Market': 'Rynek',
        'Trading': 'Handel',
        'Price': 'Cena',
        'Up': 'W gÃ³rÄ™',
        'Down': 'W dÃ³Å‚',
        'Surge': 'GwaÅ‚towny wzrost',
        'Crash': 'GwaÅ‚towny spadek',
        'Bullish': 'Bycze',
        'Bearish': 'NiedÅºwiedzie',
        'Fed': 'Fed',
        'inflation': 'inflacja',
        'Interest Rate': 'Stopa procentowa',
        'Economic': 'Gospodarcze',
        'Earnings': 'Zyski',
        'Report': 'Raport',
        'Data': 'Dane',
        'Rally': 'Wzrost',
        'Decline': 'Spadek',
        'Record': 'Rekord',
        'High': 'Szczyt',
        'Low': 'Dno'
    };
    
    // News categories configuration
    const NEWS_SYMBOLS = {
        'CRYPTO': ['BTCUSD', 'ETHUSD', 'SOLUSD', 'crypto'],
        'STOCKS': ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA', 'TSLA'],
        'MARKETS': ['SPX', 'INDU', 'IXIC', 'EUR/USD'],
        'ECONOMY': ['economy', 'fed', 'inflation', 'interest']
    };
    
    // Determine importance level based on keywords
    function getImportanceLevel(headline) {
        const highImportanceKeywords = ['crash', 'surge', 'record', 'historic', 'emergency', 'halt', 'alert'];
        const mediumImportanceKeywords = ['rally', 'decline', 'forecast', 'warns', 'announces'];
        
        const lowerHeadline = headline.toLowerCase();
        
        if (highImportanceKeywords.some(kw => lowerHeadline.includes(kw))) {
            return 'high';
        } else if (mediumImportanceKeywords.some(kw => lowerHeadline.includes(kw))) {
            return 'medium';
        }
        return 'low';
    }
    
    // Categorize news based on content
    function categorizeNews(headline) {
        const lowerHeadline = headline.toLowerCase();
        
        if (lowerHeadline.includes('crypto') || lowerHeadline.includes('bitcoin') || lowerHeadline.includes('ethereum')) {
            return 'CRYPTO';
        } else if (lowerHeadline.includes('stock') || lowerHeadline.includes('apple') || lowerHeadline.includes('microsoft')) {
            return 'STOCKS';
        } else if (lowerHeadline.includes('market') || lowerHeadline.includes('index') || lowerHeadline.includes('s&p')) {
            return 'MARKETS';
        } else if (lowerHeadline.includes('fed') || lowerHeadline.includes('economy') || lowerHeadline.includes('inflation')) {
            return 'ECONOMY';
        }
        return 'MARKETS';
    }
    
    // Format time to relative (np. "5 min ago")
    function getRelativeTime(dateString) {
        try {
            const newsDate = new Date(dateString);
            const now = new Date();
            const diffMs = now - newsDate;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Teraz';
            if (diffMins < 60) return `${diffMins}m temu`;
            if (diffHours < 24) return `${diffHours}h temu`;
            if (diffDays < 7) return `${diffDays}d temu`;
            
            return newsDate.toLocaleDateString('pl-PL');
        } catch (e) {
            return 'Niedawno';
        }
    }
    
    // Polish article to English
    function translateHeadline(headline) {
        let translated = headline;
        
        Object.entries(POLISH_TRANSLATIONS).forEach(([en, pl]) => {
            const regex = new RegExp(`\\b${en}\\b`, 'gi');
            translated = translated.replace(regex, (match) => {
                return match.charAt(0).toUpperCase() === match.charAt(0) ? pl : pl.toLowerCase();
            });
        });
        
        return translated;
    }
    
    // Fetch news from Twelve Data
    async function fetchBreakingNews() {
        try {
            // Try to fetch crypto news first (usually most dynamic)
            const symbols = ['BTCUSD', 'ETHUSD', 'AAPL', 'MSFT', 'SPX'];
            const newsRequests = symbols.map(symbol =>
                fetch(`https://api.twelvedata.com/stocks/news?symbol=${symbol}&limit=5&apikey=${TWELVE_DATA_KEY}`)
                    .then(r => r.json())
                    .catch(() => ({ data: [] }))
            );
            
            const results = await Promise.all(newsRequests);
            const allNews = results
                .flatMap(r => r.data || [])
                .filter(article => article && article.title)
                .slice(0, 20);
            
            return allNews.length > 0 ? allNews : getMockNews();
        } catch (error) {
            console.error('News fetch failed:', error);
            return getMockNews();
        }
    }
    
    // Mock news for demo/offline mode
    function getMockNews() {
        return [
            {
                title: 'Bitcoin Surges Past $95,000 on Federal Reserve Rate Hints',
                description: 'Cryptocurrency market rallies following positive economic signals',
                source: 'Bloomberg',
                published_date: new Date(Date.now() - 300000).toISOString(),
                symbol: 'BTCUSD'
            },
            {
                title: 'Apple Q4 Earnings Beat Expectations - Stock Soars',
                description: 'Tech giant reports strong iPhone sales and services growth',
                source: 'Reuters',
                published_date: new Date(Date.now() - 600000).toISOString(),
                symbol: 'AAPL'
            },
            {
                title: 'Federal Reserve Signals Possible Rate Pause',
                description: 'Market reacts positively to inflation control announcements',
                source: 'Financial Times',
                published_date: new Date(Date.now() - 900000).toISOString(),
                symbol: 'INDU'
            },
            {
                title: 'Ethereum Network Upgrade Boosts Performance',
                description: 'Layer 2 scaling solutions drive increased adoption',
                source: 'CoinDesk',
                published_date: new Date(Date.now() - 1200000).toISOString(),
                symbol: 'ETHUSD'
            },
            {
                title: 'S&P 500 Reaches New All-Time High',
                description: 'Index rises on strong corporate earnings and tech sector strength',
                source: 'MarketWatch',
                published_date: new Date(Date.now() - 1500000).toISOString(),
                symbol: 'SPX'
            },
            {
                title: 'Microsoft Launches AI Investment Initiative',
                description: 'Company commits $50 billion to artificial intelligence development',
                source: 'TechCrunch',
                published_date: new Date(Date.now() - 1800000).toISOString(),
                symbol: 'MSFT'
            }
        ];
    }
    
    // Build and render breaking news ticker
    async function buildBreakingNews() {
        const newsData = await fetchBreakingNews();
        
        if (!newsData || newsData.length === 0) {
            const wrapper = document.getElementById('breakingNewsWrapper');
            wrapper.innerHTML = '<span class="breaking-news-label">ðŸ”´ BREAKING NEWS</span><div class="news-loading">Brak dostÄ™pnych wiadomoÅ›ci</div>';
            return;
        }
        
        let newsHTML = '<div class="breaking-news-scroll">';
        
        // Add all news items twice for continuous loop
        for (let loop = 0; loop < 2; loop++) {
            for (const article of newsData) {
                const importance = getImportanceLevel(article.title);
                const category = categorizeNews(article.title);
                const timeAgo = getRelativeTime(article.published_date);
                const source = article.source || 'News';
                
                const importanceIcon = importance === 'high' ? 'ðŸ”´' : importance === 'medium' ? 'ðŸŸ ' : 'ðŸŸ¡';
                
                newsHTML += `
                    <div class="breaking-news-item">
                        <span class="news-importance ${importance}">${importanceIcon} ${importance.toUpperCase()}</span>
                        <span class="news-category-tag category-${category.toLowerCase()}">${category}</span>
                        <span class="news-source">${source}</span>
                        <span class="news-headline">${article.title}</span>
                        <span class="news-time">${timeAgo}</span>
                    </div>
                `;
            }
            
            // Gap between loops
            newsHTML += '<div style="width: 50px; flex-shrink: 0;"></div>';
        }
        
        newsHTML += '</div>';
        
        const wrapper = document.getElementById('breakingNewsWrapper');
        const newsLabel = '<span class="breaking-news-label">ðŸ”´ BREAKING NEWS</span>';
        wrapper.innerHTML = newsLabel + newsHTML;
    }
    
    // Initialize and auto-refresh every 2 minutes
    buildBreakingNews();
    setInterval(buildBreakingNews, 120000);  // 2 minutes
</script>
